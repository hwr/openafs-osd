<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理解説書</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- C:\IDWB\TEMP\idwt1068\AUARF000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 21:46:04            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 21:46:02">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 21:46:02">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 21:46:02">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理解説書</H1>
<P>
<H2><A NAME="HDRKLOG" HREF="auarf002.htm#ToC_214">klog</A></H2>
<A NAME="IDX5176"></A>
<A NAME="IDX5177"></A>
<A NAME="IDX5178"></A>
<A NAME="IDX5179"></A>
<A NAME="IDX5180"></A>
<A NAME="IDX5181"></A>
<A NAME="IDX5182"></A>
<P><STRONG>目的</STRONG>
<P>認証サーバーを使用して認証を行います。
<P><STRONG>構文</STRONG>
<PRE><B>klog</B>  [<B>-x</B>]  [<B>-principal</B> &lt;<VAR>user name</VAR>>]  [<B>-password</B> &lt;<VAR>user's password</VAR>>]
      [<B>-cell</B> &lt;<VAR>cell name</VAR>>]  [<B>-servers</B> &lt;<VAR>explicit list of servers</VAR>><SUP>+</SUP>]
      [<B>-pipe</B>]  [<B>-silent</B>]  [<B>-lifetime</B> &lt;<VAR>ticket lifetime in hh[:mm[:ss]]</VAR>>]
      [<B>-setpag</B>]  [<B>-tmp</B>]  [<B>-help</B>]

<B>klog</B>  [<B>-x</B>]  [<B>-pr</B> &lt;<VAR>user name</VAR>>]  [<B>-pa</B> &lt;<VAR>user's password</VAR>>]  [<B>-c</B> &lt;<VAR>cell name</VAR>>]
      [<B>-s</B> &lt;<VAR>explicit list of servers</VAR>><SUP>+</SUP>]  [<B>-pi</B>]  [<B>-si</B>]
      [<B>-l</B> &lt;<VAR>ticket lifetime in hh[:mm[:ss]]</VAR>>]  [<B>-se</B>]  [<B>-t</B>]  [<B>-h</B>]
</PRE>
<P><STRONG>構文</STRONG>
<P><B>klog</B> コマンドは、認証サーバーから AFS トークンを取得します。ローカル・マシン上のキャッシュ・マネージャーは、カーネル・メモリーの信用証明書構造体にそのトークンを保管し、
AFS ファイル・スペースへの認証アクセスを取得するときにそれを使用します。このコマンドは、ローカル・ファイル・システムでは、発行者の ID (UNIX UID) に影響を与えません。
<P>デフォルトでは、コマンド・インタープリターは、ローカル・ファイル・システムの発行者 ID に一致する、
AFS ユーザー名のトークンを取得します。代替ユーザーを指定する場合には、
<B>-principal</B> 引き数を組み込んでください。
<B>-principal</B> 引き数に指定されたユーザーは、ローカル・パスワード・ファイル (<B>/etc/passwd</B> ファイル、または同等のファイル) に記録されている必要はありません。
<P>デフォルトでは、コマンド・インタープリターは、コマンド・シェルで設定される AFSCELL 環境変数、あるいは、ローカル・マシン上の <B>/usr/vice/etc/ThisCell</B> ファイルが定義するように、ローカル・セル用のトークンを取得します。代替セルを指定する場合には、
<B>-cell</B> 引き数を組み込んでください。コマンド・インタープリターは、ローカルな <B>/usr/afs/etc/CellServDB</B> ファイルの、セルの項目からランダムに選択した認証サーバーと交信します。ただし、<B>-servers</B> 引き数を使用して、
1 つまたは複数のデータベース・サーバー・マシンを指定する場合は、この限りではありません。
<P>ユーザーは、複数のセルで同時にトークンを持つことができますが、クライアント・マシンへの接続に関しては、1 回の接続につき、1 つのセルごとに
1 つのトークンしか使用できません。ユーザーの信用証明書構造体に、要求されたセルのトークンがすでにある場合には、このコマンドで取得されるトークンと置き換わります。
<P>AFS 認証サーバーの代わりに、標準ケルベロス認証を使用するサイトでは、すべてのクライアント・マシンで、このコマンドのケルベロス・バージョン、
<B>klog.krb</B> を使用しなければなりません。そうすると、KRBTKFILE 環境変数が指名するファイルに、発行者のケルベロス・チケットが自動的に配置されます。
<B>pagsh.krb</B> コマンドは、自動的に、この環境変数を <B>/tmp/tktp</B><I>X</I> と定義します。ここで、<I>X</I> はユーザーの PAG の数です。
<P>次のもので最短のものが、このコマンドから取得したトークンの存続時間になります。
<UL>
<LI>発行者が <B>-lifetime</B> 引き数で指定する存続時間。発行者がこの引き数を組み込んでいない場合は、デフォルト値は 720 時間 (30 日) です。
</LI><LI>認証データベースの <B>afs</B> 項目で記録される、最大チケット存続時間。デフォルトは、100 時間です。
</LI><LI>指定ユーザーの認証データベース項目に記録される最大チケット存続時間。デフォルトは、
AFS 3.1 以降を実行している認証サーバーが作成するユーザー項目で、25 時間です。
</LI><LI>認証データベースの、
<B>krbtgt.</B><VAR>CELLNAME</VAR> 項目に記録される最大チケット存続時間。この項目は、トークンの生成時に内部で使用されるチケット獲得チケットに相当します。デフォルトは、720 時間 (30 日) です。
</LI></UL>
<P><B>kas examine</B> コマンドの出力では、認証データベース項目の最大チケット存続時間は、
<TT>Max ticket lifetime</TT> と表示されます。管理者は任意の項目を検査でき、ユーザーはユーザー自身の項目を表示できます。
<P>デフォルトが変更されていなければ、トークン存続時間は、
AFS 3.1 以降を実行する認証サーバーが作成するユーザー・アカウントの場合、
25 時間になります。トークンの最大存続時間は 720 時間 (30 日) で、最小存続時間は 5 分です。
<P>最小値から最大値までの間で、認証サーバーは、以下の規則に従って一定の値のセットを設定します。
5 分から 10 時間 40 分までは、要求された存続時間は 5 分単位で許可され、端数は切り上げられます。たとえば、発行者が 12 分の存続時間を要求した場合、トークンの実際の存続時間は 15 分になります。
<P>トークン存続時間が 10 時間 40 分より長い場合は、次の表を参考にしてください。この表では、使用可能なすべての時間を、
<VAR>時</VAR><B>:</B><VAR>分</VAR><B>:</B><VAR>秒</VAR> 単位で表しています。括弧内の数値は、同じ時間を、(文字 <TT>d</TT>、および <TT>h</TT> が示すように) 日と時間による近似値で表したものです。たとえば、<TT>282:22:17</TT> は、282 時間 22 分 17 秒の意味ですが、これを変換すると、およそ 11 日 と 18 時間 (<TT>11d 18h</TT>) になります。認証サーバーは、要求された存続時間を、それに最も近い可能な存続時間へと切り上げます。
<PRE>   11:24:15 (0d 11h)    46:26:01 (1d 22h)  189:03:38 (7d 21h)
   12:11:34 (0d 12h)    49:38:40 (2d 01h)  202:08:00 (8d 10h)
   13:02:09 (0d 13h)    53:04:37 (2d 05h)  216:06:35 (9d 00h)
   13:56:14 (0d 13h)    56:44:49 (2d 08h)  231:03:09 (9d 15h)
   14:54:03 (0d 14h)    60:40:15 (2d 12h)  247:01:43 (10d 07h)
   15:55:52 (0d 15h)    64:51:57 (2d 16h)  264:06:34 (11d 00h)
   17:01:58 (0d 17h)    69:21:04 (2d 21h)  282:22:17 (11d 18h)
   18:12:38 (0d 18h)    74:08:46 (3d 02h)  301:53:45 (12d 13h)
   19:28:11 (0d 19h)    79:16:23 (3d 07h)  322:46:13 (13d 10h)
   20:48:57 (0d 20h)    84:45:16 (3d 12h)  345:05:18 (14d 09h)
   22:15:19 (0d 22h)    90:36:53 (3d 18h)  368:56:58 (15d 08h)
   23:47:38 (0d 23h)    96:52:49 (4d 00h)  394:27:37 (16d 10h)
   25:26:21 (1d 01h)   103:34:45 (4d 07h)  421:44:07 (17d 13h)
   27:11:54 (1d 03h)   110:44:28 (4d 14h)  450:53:46 (18d 18h)
   29:04:44 (1d 05h)   118:23:54 (4d 22h)  482:04:24 (20d 02h)
   31:05:22 (1d 07h)   126:35:05 (5d 06h)  515:24:22 (21d 11h)
   33:14:21 (1d 09h)   135:20:15 (5d 15h)  551:02:38 (22d 23h)
   35:32:15 (1d 11h)   144:41:44 (6d 00h)  589:08:45 (24d 13h)
   37:59:41 (1d 13h)   154:42:01 (6d 10h)  629:52:56 (26d 05h)
   40:37:19 (1d 16h)   165:23:50 (6d 21h)  673:26:07 (28d 01h)
   43:25:50 (1d 19h)   176:50:01 (7d 08h)

</PRE>
<P><STRONG>注意</STRONG>
<P>デフォルトでは、このコマンドは新規のプロセス認証グループ (PAG) を作成しません。
PAG について知りたい場合は、
<B>pagsh</B> コマンドの説明を参照してください。セルが AFS 修正ログイン・ユーティリティーを使用しない場合は、ユーザーは、このコマンドに <B>-setpag</B> オプションを組み込むか、このコマンドに先立って <B>pagsh</B> コマンドを発行して、ローカル UID ではなく PAG が識別する信用証明書構造体に、トークンを保管しなければなりません。
<P>信用証明書構造体がローカル UID によって識別される場合は、ローカル・スーパーユーザー <B>root</B> が、
UNIX の <B>su</B> コマンドを使用して、任意の他の ID を想定し、その UID に関連したトークンを自動的に継承することができるため、セキュリティーに穴が開く可能性があります。
PAG が信用証明書構造体を識別することによって、このような機密漏れを防ぐことができます。
<P><B>-password</B> 引き数が使用されている場合は、指定されたパスワードをハイフンで始めることはできません。そうすると、別のオプション名と解釈されてしまうからです。
<B>-password</B> 引き数の使用は、どのような場合でもお勧めできません。
<P>デフォルトでは、適正に構成された NFS クライアント・マシン (NFS/AFS 変換プログラム経由で、
AFS にアクセスしているもの) 上でこのコマンドを発行し、
NFS クライアント・マシンがサポートされるシステム・タイプであると想定することが可能です。ただし、変換プログラム・マシンの管理者が、
<B>-uidcheck on</B> 引き数を、
<B>fs exportafs</B> コマンドに組み込んで、
UID 検査を使用可能にした場合は、コマンドは失敗し、以下のようなエラー・メッセージが出ます。
<PRE>
   警告 : <VAR>translator_machine</VAR> へのリモート pioctl は失敗しました (err=8). . .
   pioctl が失敗したため、AFS に対する認証は利用できません。
</PRE>
<P>UID 検査を使用可能にするということは、トークンが保管されている変換プログラム・マシン上の信用証明書構造体が、そのトークンを信用証明書構造体に配置しているプロセスの、ローカル UID に一致する UID によって、識別される必要があるということです。
<B>klog</B> コマンド・インタープリターは、
NFS クライアント上でトークンを取得すると、それを、変換プログラム・マシン上のリモート実行プログラム・デーモンに渡します。するとリモート実行プログラム・デーモンはシステム呼び出しを行い、変換プログラム・マシン上の信用証明書構造体にトークンを保管します。リモート実行プログラムは一般に、ローカル・スーパーユーザー <B>root</B> として実行されます。したがって、ほとんどの場合、そのローカル UID (通常はゼロ) は、
NFS クライアント・マシン上で <B>klog</B> コマンドを発行したユーザーの、ローカル UID とは一致しません。
<P>NFS クライアント・マシンで <B>klog</B> コマンドを発行すると、機密漏れが生じます。コマンド・インタープリターは、ネットワークを経由してリモート実行プログラム・デーモンにトークンを渡す際、明白なテキスト・モードを使用するからです。
<P><STRONG>オプション </STRONG>
<DL>
<P><DT><B>-x
</B><DD>後方互換性の場合のみ表示されます。前の機能が、このコマンドのデフォルトの振る舞いになっています。
<P><DT><B>-principal
</B><DD>認証するユーザー名を指定します。この引き数を省略すると、認証サーバーは、ローカル・ファイル・システムにログインするユーザーを認証しようとします。
<P><DT><B>-password
</B><DD>発行者のパスワード (あるいは、
<B>-principal</B> 引き数で識別される代替ユーザーのパスワード) を指定します。コマンド・インタープリターにパスワードのプロンプトを出させるには、この引き数を省略してください。この場合、入力されたパスワードは、外観では判別されないようにコマンド・シェルに表示されます。
<P><DT><B>-cell
</B><DD>トークンを取得するセルを指定します。このコマンドは、そのセルの認証サーバーに対して指示されます。あるマシン上での単一ログイン・セッションの間、ユーザーは、同時に複数のセルで認証されることが可能ですが、それぞれのセルごとに、トークンは一度に 1 つしか所有することができません (つまり、
1 台のマシンにつき、1 つのセッションの 1 つのセルに対して、
1 つの ID で認証することしかできません)。セル名は、コマンドを発行するクライアント・マシンの、
<B>/usr/vice/etc/CellServDB</B> ファイルでリストされている、他のセルと区別できる最短形式に省略することが可能です。
<P>
<P>この引き数を省略すると、コマンドは、以下で定義されるローカル・セルで実行されます。
<UL>
<LI>第 1 に、環境変数 AFSCELL の値で定義されるローカル・セル
</LI><LI>第 2 に、コマンドを発行したクライアント・マシンの、
<B>/usr/vice/etc/ThisCell</B> ファイルで定義されるローカル・セル
</LI></UL>
<P><DT><B>-servers
</B><DD>指定された個々のデータベース・サーバー・マシン上で実行されている、認証サーバーとの接続を確立します。次にコマンド・インタープリターが、この 1 つをランダムに選択し、コマンドを実行します。完全修飾ホスト名を提供するのが最も望ましいのですが、コマンド発行時のセルのネーム・サーバーの状態によっては、省略形式が許容される場合もあります。このオプションは、問題発生時に特定のサーバーをテストする場合に有効です。
<P>
<P>この引き数が省略されると、コマンド・インタープリターは、
<B>/usr/vice/etc/CellServDB</B> ファイルのローカル・コピーに、指定されたセルのためにリストされた個々のマシンとの接続を確立し、次に、その 1 つをランダムに選択してコマンドを実行します。
<P><DT><B>-pipe
</B><DD>プロンプトおよびエラー・メッセージを含む、標準出力ストリームへのすべての出力を抑制します。
<B>klog</B> コマンド・インタープリターは、標準入力ストリームからのパスワードの受信を予期します。この引き数は使用しないでください。これは、ユーザーではなくアプリケーション・プログラムが使用するためのものです。
<P><DT><B>-silent
</B><DD><B>klog</B> コマンドが、デフォルトで標準出力ストリーム上に作成する、トレース・メッセージの一部を抑止します。重要な問題が発生した場合には、これまでどおり報告を行います。
<P><DT><B>-lifetime
</B><DD>トークンに特定の存続時間を要求します。
<VAR>hh</VAR>[<B>:</B><VAR>mm</VAR>[<B>:</B><VAR>ss</VAR>]] の形式で、時間数を提供し、オプションで分数、秒数を提供します。
<B>説明</B>のセクションで述べた、トークンの存続時間を計算する際に、この値を使用します。
<P><DT><B>-setpag
</B><DD>認証の要求前に、プロセス認証グループ (PAG) を作成します。トークンは、新しく作成された PAG に対応付けられます。
<P><DT><B>-tmp
</B><DD>ローカル・マシンの <B>/tmp</B> ディレクトリーに、ケルベロス・スタイルのチケット・ファイルを作成します。このファイルは <B>tkt.</B><VAR>AFS_UID</VAR> と呼ばれます。ここで <VAR>AFS_UID</VAR> は、発行者の AFS UID です。
<P><DT><B>-help
</B><DD>このコマンドのオンライン・ヘルプを出力します。これ以外の有効なオプションはすべて無視されます。
</DL>
<P><STRONG>注意</STRONG>
<P><STRONG>出力</STRONG>
<P>次のメッセージは、認証失敗の連続が限度を超えて発生したことを示しています。管理者は <B>kas unlock</B> コマンドを使用して、そのアカウントのロックを解除することができます。あるいは発行者は、アカウントのロックアウト時間が過ぎるまで待機することができます。
(時間は、<B>kas setfields</B> コマンドの、
<B>-locktime</B> 引き数を使用して設定され、
<B>kas examine</B> コマンドの出力に表示されます)。
<PRE>
   ID がロックされているため、AFS への認証が利用できません。
   システム管理者にご連絡ください。

</PRE>
<P><B>-tmp</B> フラグが組み込まれている場合は、次のメッセージで、ケルベロス・スタイルのチケット・ファイルの作成が確認されます。
<PRE>
   チケット・ファイルを /tmp に書き込みました。

</PRE>
<P><STRONG>例</STRONG>
<P>ほとんどの場合、このコマンドは引き数を伴わずに発行されます。該当するパスワードは、ローカル・ファイル・システムに現在ログインしている人のためのものです。チケットの存続時間は、<B>説明</B>セクションで述べた方法で、計算されます (デフォルトを変更していない場合、認証データベース項目を AFS 3.1 以降で作成したユーザーの場合は 25 時間です)。
<PRE>
   % <B>klog</B>
   パスワード :

</PRE>
<P>次の例では、ユーザーを、
Example Corporation のテスト・セルの<B>管理者</B>として、認証しています。
<PRE>
   % <B>klog -principal admin -cell test.example.com</B>
   パスワード :

</PRE>
<P>次の例では、発行者は、
104 時間 30 分 (4 日と 8 時間 30 分) のチケット存続時間を要求しています。この存続時間が、<B>説明</B>セクションで述べた、チケットの最大存続時間その他の要素によって許可されたとすると、トークンの存続時間は 110:44:28 です。これは、可能な値のうちでは 2 番目に大きなものです。
<PRE>   % <B>klog -lifetime 104:30</B>
   パスワード :

</PRE>
<P><STRONG>必要となる特権</STRONG>
<P>なし。
<P><STRONG>関連情報 </STRONG>
<P><A HREF="auarf139.htm#HDRFS_EXPORTAFS">fs exportafs</A>
<P><A HREF="auarf185.htm#HDRKAS_EXAMINE">kas examine</A>
<P><A HREF="auarf193.htm#HDRKAS_SETFIELDS">kas setfields</A>
<P><A HREF="auarf197.htm#HDRKAS_UNLOCK">kas unlock</A>
<P><A HREF="auarf198.htm#HDRKASERVER">kaserver</A>
<P><A HREF="auarf208.htm#HDRPAGSH">pagsh</A>
<P><A HREF="auarf235.htm#HDRTOKENS">tokens</A>
<P>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auarf199.htm">前ページ</A> &#124; <A HREF="auarf201.htm">次ページ</A> &#124; <A HREF="auarf002.htm#ToC">目次</A> &#124; <A HREF="auarf284.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
