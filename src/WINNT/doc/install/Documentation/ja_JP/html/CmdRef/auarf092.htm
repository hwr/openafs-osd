<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理解説書</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- C:\IDWB\TEMP\idwt1068\AUARF000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 21:46:04            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 21:46:02">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 21:46:02">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 21:46:02">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理解説書</H1>
<P>
<H2><A NAME="HDRBK_VOLSETRESTORE" HREF="auarf002.htm#ToC_106">backup volsetrestore</A></H2>
<A NAME="IDX4428"></A>
<A NAME="IDX4429"></A>
<A NAME="IDX4430"></A>
<A NAME="IDX4431"></A>
<A NAME="IDX4432"></A>
<A NAME="IDX4433"></A>
<A NAME="IDX4434"></A>
<P><STRONG>目的</STRONG>
<P>ボリューム・セット内のすべてのボリュームを復元します。
<P><STRONG>構文</STRONG>
<PRE><B>backup volsetrestore</B> [<B>-name</B> &lt;<VAR>volume set name</VAR>>]  [<B>-file</B> &lt;<VAR>file name</VAR>>]
                     [<B>-portoffset</B> &lt;<VAR>TC port offset</VAR>><SUP>+</SUP>]
                     [<B>-extension</B> &lt;<VAR>new volume name extension</VAR>>]
                     [<B>-n</B>]  [<B>-localauth</B>]  [<B>-cell</B> &lt;<VAR>cell name</VAR>>]  [<B>-help</B>]

<B>backup vols</B> [<B>-na</B> &lt;<VAR>volume set name</VAR>>]  [<B>-f</B> &lt;<VAR>file name</VAR>>]
            [<B>-p</B> &lt;<VAR>TC port offset</VAR>><SUP>+</SUP>]  [<B>-e</B> &lt;<VAR>new volume name extension</VAR>>]
            [<B>-n</B>]  [<B>-l</B>]  [<B>-c</B> &lt;<VAR>cell name</VAR>>]  [<B>-h</B>]
</PRE>
<P><STRONG>構文</STRONG>
<P><B>backup volsetrestore</B> コマンドは、読み取り / 書き込みボリューム・グループの完全な内容をファイル・システムに復元します。このコマンドは、各ボリュームの最後のフル・ダンプと連続したすべてのインクリメンタル・ダンプからデータを復元します。これは、定義されたボリューム・セットを異なるサイトに復元できるので、複数の区画にあるデータ が消失した場合に有効です。
<P>(指定されたポート・オフセットの <B>/usr/afs/backup/CFG_</B><VAR>device_name</VAR> ファイルに <B>FILE YES</B> 命令がある場合、
<B>backup volsetrestore</B> コマンドは、磁気テープではなく、テープ・コーディネーターの <B>/usr/afs/backup/tapeconfig</B> ファイルのポート・オフセットにリストされているバックアップ・データ・ファイルからデータを復元します。説明を分かりやすくするために、以下では磁気テープ装置の場合について説明しますが、バックアップ・データ・ファイルの取り扱いは磁気テープ装置の場合とほとんど同じです。)
<P>1 つ以上のボリュームを単一サイトのみに復元する場合には、
<B>backup volrestore</B> コマンドのほうが有効です。単一区画にあるボリュームをすべて復元する場合には、
<B>backup diskrestore</B> コマンドが有効です。
<P>次のように、<B> -name</B> 引き数または <B>-file</B> 引き数を使用して、復元するボリュームを指定してください。
<UL>
<LI><B>-name</B> 引き数には、ボリューム・セットの名前を指定します。バックアップ・システムは、ボリューム・ロケーション・データベース (VLDB) の項目で定義されているサーバー、区画、およびボリューム名の条件が一致し、ダンプが使用可能なボリュームをすべて復元します。バックアップ・システムは、ボリュームを、その現在のサイト (マシンおよび区画) に復元し、デフォルトでは、既存のボリューム内容を上書きします。
<P>
<P>ボリューム・セットがボリュームのバックアップに使用されているかどうか (<B>backup dump</B> コマンドに <B>-volumeset</B> オプションが使用されているかどうか) は関係ありません。ボリューム・セットは、このコマンドで復元される必要のあるボリュームに一致するよう、明示的に定義することができます。通常そちらを選択することをお勧めします。実際、<B>backup addvolset</B> コマンドに <B>-temporary</B> フラグを指定して作成された<I>一時</I>ボリューム・セットは、このような場合、特に便利です。一時ボリューム・セットは、バックアップ・システムには追加されず、現行のバックアップ・セッション中にのみ存在します。また、このコマンドで開始した単一の復元操作を完了するためにだけそのボリューム・セットが必要な場合に適しています。
<P>
<P>特別に定義されたボリューム・セットの方が適している理由は、ダンプ操作で使用するために以前定義されたボリューム・セットが、通常バックアップ・バージョンのボリュームに一致するためです。これに対して、復元操作に使用する場合は、基本 (読み取り / 書き込み) 名に一致するボリューム項目を定義するのが最善の方法です。その場合、バックアップ・システムは、読み取り / 書き込みまたはバックアップのいずれかのダンプがある最新のダンプ・セットをバックアップ・データベースから検索します。逆に、ボリューム項目がボリュームのバックアップまたは読み取り専用バージョンと明示的に一致していると、バックアップ・システムは、一致しているボリューム・バージョンのダンプだけを復元します。
</LI><LI><B>-file</B> 引き数には、復元するボリュームおよびサイトが指定されているファイルの名前を指定します。バックアップ・データベースのレコードと VLDB が異なる場合、このボリューム名は、バックアップ・データベースのレコードの名前と一致していなければなりません。これは、バックアップ・データベースが VLDB のボリュームを検索しないためです。指定サイトは、ボリュームの現在のサイトとは別にすることができますが、その場合は、バックア ップ・システムは、現在のバージョンのボリュームを削除し、
VLDB のボリューム・ロケーション情報を更新します。
</LI></UL>
<P>関連するボリュームのすべてのフル・ダンプおよびインクリメンタル・ダンプが、
1 つのテープ・コーディネーターで読み取り可能なタイプの磁気テープに書き込まれている場合には、
<B>-portoffset</B> 引き数を使用すると、複数のポート・オフセット番号を磁気テープが必要とされる順序で表示することができます (最初に、フル・ダンプのポート・オフセット番号が、次に、レベル 1 のインクリメンタル・ダンプのポート・オフセット番号、というように表示されます)。これは、関連するボリュームすべてのフル・ダンプが、最初にテープ・コーディネーターが読み取れる磁気テープに書かれていることを意味しています。複数の互換性のないタイプの磁気テープにダンプが作成されている場合には、
<B>backup volrestore</B> コマンドを使用して個々のボリュームを復元するか、ダンプが作成されているボリュームをまとめるボリューム・セットを互換性のある磁気テープ・タイプに定義してから、このコマンドを使用することができます。詳細については、<I>AFS 管理の手引き</I> を参照してください。
<P>デフォルトでは、バックアップ・システムは、既存のボリュームの内容を、復元したデータで上書きします。復元したバージョンを保存するために新規のボリュームを作成するには、
<B>-extension</B> 引き数を使用します。バックアップ・システムは、指定された拡張子を読み取り / 書き込みの基本名に追加して新規のボリューム名とし、新規に VLDB 項目を作成します。このコマンドが、既存のボリュームに影響を与えることは全くありません。ただし、指定された拡張子がすでに存在する場合は、このコマンドはそれを上書きします。
<P><B>-n</B> フラグを付けると、
<B>-n</B> フラグを付けずにコマンドを発行したときに復元されるボリュームのリストが生成されます。実際の操作を行われません。このコマンド出力の詳細、および <B>-file</B> と <B>-name</B> 引き数とこのフラグの効果的な組み合わせ方法については、この解説ページの [<B>出力</B>] のセクションを参照してください。
<P><B>backup volsetrestore</B> コマンドの実行時間は、復元するボリュームの数とデータの量によって異なりますが、大容量のボリュームの場合、
1 時間ほどかかる場合があります。
<B>-name</B> 引き数にボリューム・セットを 1つだけ指定するか、引き数に異なるボリュームがリストされているファイルを <B>-file</B> 指定して、このコマンドの複数のインスタンスを当時に実行すると、この実行時間を短縮することができます。これを行うには、必要な磁気テープを読み取る複数のテープ・コーディネーターが使用可能でなければなりません。復元されるボリュームによって、ダンプされている磁気テープが異なるので、ボリューム・セットを個別に指定すると、磁気テープの交換回数を減らすことができます。
<P>このコマンドを実行すると、デフォルトでは、テープ・コーディネーターは、ローカルの <B>/usr/afs/backup/CFG_</B><VAR>device_name</VAR> ファイルの <B>MOUNT</B> 命令を呼び出して、最初に必要な磁気テープにアクセスします。<B>MOUNT</B> 命令がない場合には、磁気テープの挿入をバックアップ操作員に要求します。ただし、<B> CFG_</B><VAR>device_name</VAR> ファイルに <B>AUTOQUERY NO</B> 命令があるか、あるいは <B>butc</B> コマンドが <B>-noautoquery</B> フラグ付きで発行されている場合には、テープ・コーディネーターは、磁気テープがすでに装置に挿入されているとみなします。そうでない場合、あるいは間違った磁気テープが挿入されている場合には、テープ・コーディネーターは <B>MOUNT</B> 命令を呼び出すか、操作員にプロンプトを出します。また、復元操作で別の磁気テープが必要になった場合も、
<B>MOUNT</B> 命令を呼び出すか、バックアップ操作員にプロンプトを出します。この場合、操作員は、必要な磁気テープを挿入しなければなりません。
<P><STRONG>オプション </STRONG>
<DL>
<P><DT><B>-name
</B><DD>復元するボリューム・セットの名前を指定します。バックアップ・システムは、VLDB にあるボリュームの中で、ボリューム・セットのボリューム項目が一致しているボリュームをすべて復元します。この引き数は、<B>-file</B> 引き数と一緒に使用できません。
<P><DT><B>-file
</B><DD>復元する 1 つ以上のボリュームおよびサイト (ファイル・サーバー・マシンと区画) が指定されているファイルの完全パス名を指定します。この引き数は、<B>-name</B> と一緒に使用できません。
<P>
<P>各ボリュームの項目は、ファイル内で次のように一行で記述されています。
<P>
<PRE>    <VAR>machine  partition
 volume</VAR> [<VAR>comments...</VAR>]

</PRE>
<P>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><VAR>machine</VAR>
</B><DD>ボリュームの復元先のファイル・サーバー・マシンを指定します。
<P><DT><B><VAR>partition</VAR>
</B><DD>ボリュームの復元先の区画を指定します。
<P><DT><B><VAR>volume</VAR>
</B><DD>復元するボリュームを指定します。通常は、各ボリュームの基本名 (読み取り / 書き込み) を指定してください。この場合、バックアップ・システムは、このボリュームの読み取り / 書き込みまたはバックアップ・バージョンのいずれかのダンプがある最新のダンプ・セットをバックアップ・データベースから検索します。バックアップ・システムは、最新のフル・ダンプから順番に、そのバージョンのボリューム・ダンプを復元します。逆に、この名前に <B>.backup</B> または <B> .readonly</B> という拡張子が明示的に付いていると、バックアップ・システムは、対応するボリューム・バージョンのダンプだけを復元します。
<P><DT><B><VAR>comments...</VAR>
</B><DD>任意のテキスト。バックアップ・システムは、各行でボリューム名の後にあるテキストを無視します。このフィールドは、バックアップ操作員や他の管理者への注意事項などに使用できます。
</DL>
<P>
<P>
<P><VAR>machine</VAR>、<VAR>partition</VAR>、<VAR>volume</VAR> フィールドには、ワイルドカード (たとえば <B>.*</B>) を使用しないでください。ファイルの中で同じボリューム名を複数の行に指定することができますが、バックアップ・システムは、最初のボリュームしか処理しません。
<P><DT><B>-extension
</B><DD><B>-name</B> または <B>-file</B> 引き数で指定されるボリュームごとに新規にボリュームを作成し、そのボリュームから復元したデータを保存します。バックアップ・システムは、指定された文字列を読み取り / 書き込みの基本名に追加して新規のボリューム名とし、新規の VLDB ボリューム項目を作成します。バックアップ・システムは、各既存ボリュームの内容を保存します。
<B>.readonly</B> または <B>.backup</B> 以外の文字列も使用できますが、ベース名と拡張子の組み合わせは、22 文字よりも長くすることはできません。ピリオドを名前と拡張子の区切り文字に使用するときは、それを文字列の最初の文字に指定します (たとえば、
<B>.rst</B>)。
<P><DT><B>-portoffset
</B><DD>1 つまたは複数のポート・オフセット番号 (最大 128 まで) を指定します。これらは、それぞれ操作で使用するテープ・コーディネーターに対応します。複数の値がある場合は、バックアップ・システムは、各ボリュームのフル・ダンプを回復する場合には最初の値、各ボリュームのレベル 1 のインクリメンタル・ダンプを回復する場合には 2 番目の値、というように指定値を使用します。バックアップ・システムは、ダンプ階層の対応する深さと、それよりも下位のレベルにあるすべてのダンプを回復するときにリスト内の最後の値を使用します。
<P>
<P>すべてのダンプにデフォルトの 0 (ゼロ) が必要でない限り、この引き数を指定してください。
<B>0</B> がリスト内の値の 1 つにすぎない場合は、正しい順序で明示的に指定してください。
<P><DT><B>-n
</B><DD>このフラグがない場合に復元されるボリュームのリストを表示します。実際の操作は行われません。出力の形式については、この解説ページの [<B>出力</B>] のセクションを参照してください。
<B>-name</B> 引き数と一緒に使用すると、後で <B>backup volsetrestore</B> コマンドに <B>-file</B> 引き数を指定するときに便利です。
<P><DT><B>-localauth
</B><DD>ローカルの <B>/usr/afs/etc/KeyFile</B> ファイルのキーを使用して、サーバー・チケットを構成します。相互認証の間、
<B>backup</B> コマンド・インタープリターは、バックアップ・サーバー、ボリューム・サーバーおよび VL サーバーにこのチケットを提供します。このフラグは、<B>-cell</B> 引き数と一緒に使用してはなりません。詳細については、<B>backup</B> の解説ページを参照してください。
<P><DT><B>-cell
</B><DD>コマンドを実行するセルを指定します。この引き数は、
<B>-localauth</B> フラグと一緒に使用してはなりません。詳細については、<B>backup</B> の解説ページを参照してください。
<P><DT><B>-help
</B><DD>このコマンドのオンライン・ヘルプを出力します。これ以外の有効なオプションはすべて無視されます。
</DL>
<P><STRONG>出力</STRONG>
<P><B>-n</B> フラグを使用しないと、この操作の固有のタスク ID 番号が次のウィンドウに表示されます。
<UL>
<LI>シェル・ウィンドウ。コマンド行のすぐ後に表示されます。
</LI><LI>[テープ・コーディネーター]ウィンドウ (<B>butc</B> プロセスがデバッグ・レベル 1 で開始している場合)。
</LI></UL>
<P><B>(backup) volsetrestore</B> コマンドを対話モードで発行している場合には、タスク ID 番号は、<B>(backup) jobs</B> コマンドで表示されるジョブ ID 番号と一致しません。バックアップ・システムは、復元処理が実際に開始するまで、いずれの ID 番号も割り当てません。
<P><B>-n</B> フラグを付けると、タスク ID もジョブ ID も割り当てられていないので、これらの番号は表示されません。この場合、まず、復元されるボリューム数が表示され、次に、ボリュームの各ダンプが各行に表示されます。各行では、そのボリュームの最新のフル・ダンプが表示され、次にダンプ・レベルに従ってインクリメンタル・ダンプが表示されます。ただし、特定のボリュームの行がすべて表示されるとは限りません。
<P>各行の形式は、以下のとおりです (ここで示した出力は、読みやすくするために 2 行で表示されています。)
<PRE>   <VAR>machine partition volume_dumped</VAR>  # as <VAR>volume_restored</VAR>; <VAR>tape_name</VAR> (<VAR>tape_ID</VAR>);  \
           pos <VAR>position_number</VAR>; <VAR>date</VAR>

</PRE>
<P>ここで、
<DL>
<P><DT><B><VAR>machine</VAR>
</B><DD>現在ボリュームを保存しているファイル・サーバー・マシンの名前を、
VLDB にリストされているとおりに指定します。
<P><DT><B><VAR>partition</VAR>
</B><DD>現在ボリュームを保存している区画の名前を、
VLDB にリストされているとおりに指定します。
<P><DT><B><VAR>volume_dumped</VAR>
</B><DD>ダンプされるボリュームのバージョン (読み取り / 書き込みまたはバックアップ) を、バックアップ・データベースにリストされているとおりに指定します。
<P><DT><B><VAR>volume_restored</VAR>
</B><DD>復元後のボリューム名を指定します。バックアップ・システムは、読み取り / 書き込みボリュームにだけデータを復元します。
<B>-extension</B> 引き数があると、指定された拡張子の付いた名前がこのフィールドに表示されます (たとえば、
<TT>user.pat.rst</TT>)。
<P><DT><B><VAR>tape_name</VAR>
</B><DD>バックアップ・データベースのボリュームのダンプを保存している磁気テープを指定します。磁気テープに永続名がある場合には、永続名が表示されます。永続名がない場合には、AFS 磁気テープ名が表示されます。
<P><DT><B><VAR>tape_ID</VAR>
</B><DD>ボリュームのダンプのある磁気テープの ID。この名前はバックアップ・データベースにリストされています。
<P><DT><B><VAR>position_number</VAR>
</B><DD>磁気テープ上でのダンプの位置を指定します (たとえば、
<TT>31</TT> は、磁気テープには現在のダンプの前に 30 のボリューム・ダンプがあります)。バックアップ・データ・ファイルにダンプが作成されている場合には、この数字は、そのボリューム・データが始まる位置を 16 KB オフセット単位で表しています。
<P><DT><B><VAR>date</VAR>
</B><DD>ボリュームがダンプされた日付と時刻。
</DL>
<P><B>-file</B> 引き数への入力として使用するファイルを生成する 1 つの方法は、
One way to<B>-name</B> と <B>-n</B> オプションを組み合わせてファイルに出力することです。
<I>AFS 管理の手引き</I> の、バックアップ・システムを使用してデータを復元する方法を解説したセクションでは、ファイルを <B>-file</B> 引き数の入力として使用する前に、そのファイルを編集する方法について説明しています。
<P>このコマンドの出力では、バックアップ・データベースに少なくとも 1 つのダンプが記録されているボリュームの情報だけが表示されます。
<B>-file</B> 引き数にファイルが指定されていたり、あるいは <B>-name</B> 引き数で指定されたボリューム・セットの項目が VLDB にある場合でも、ダンプ・レコードがなければ、コマンド・インタープリターは標準エラー・ストリームにメッセージを出力します。
<P><STRONG>例</STRONG>
<P>次のコマンドは、<B>data.restore</B> という名前のボリューム・セットの項目に含まれているボリュームをすべて復元しています。このコマンドは、ソフトウェア・エラーによってすべてのデータが破壊されたファイル・サーバー・マシンの対にデータを復元しています。すべてのボリュームは、VLDB の項目に記録されているサイトに復元されます。
<PRE>   % <B>backup volsetrestore -name data.restore</B>
   Starting restore
   backup: task ID of restore operation: 112
   backup: Finished doing restore

</PRE>
<P>次のコマンドは、<B>/tmp/restore</B> というファイルに項目があるボリュームをすべて復元しています。
<PRE>   % <B>backup volsetrestore -file /tmp/restore</B>
   Starting restore
   backup: task ID of restore operation: 113
   backup: Finished doing restore

</PRE>
<P><B>/tmp/restore</B> ファイルの内容は、次のとおりです。
<PRE>   fs1.example.com b user.pat
   fs1.example.com b user.terry
   fs1.example.com b user.smith
   fs2.example.com c user.jones
          .         .     .
          .         .     .

</PRE>
<P><STRONG>必要となる特権</STRONG>
<P>コマンドの発行者は、バックアップ・サーバーまたはボリューム・ロケーション (VL) サーバーが実行されている各マシン上、および関連するボリュームのあるすべてのファイル・サーバー・マシン上の <B>/usr/afs/etc/UserList</B> ファイルにリストされていなければなりません。
<B>-localauth</B> フラグを使用する場合には、コマンドの発行者が、ローカル・スーパーユーザー <B>root</B> として、サーバー・マシンにログオンする必要があります。
<P><STRONG>関連情報 </STRONG>
<P><A HREF="auarf060.htm#HDRBK_INTRO">backup</A>
<P><A HREF="auarf063.htm#HDRBK_ADDVOLENTRY">backup addvolentry</A>
<P><A HREF="auarf064.htm#HDRBK_ADDVOLSET">backup addvolset</A>
<P><A HREF="auarf072.htm#HDRBK_DISKRESTORE">backup diskrestore</A>
<P><A HREF="auarf073.htm#HDRBK_DUMP">backup dump</A>
<P><A HREF="auarf091.htm#HDRBK_VOLRESTORE">backup volrestore</A>
<P><A HREF="auarf126.htm#HDRBUTC">butc</A>
<P>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auarf091.htm">前ページ</A> &#124; <A HREF="auarf093.htm">次ページ</A> &#124; <A HREF="auarf002.htm#ToC">目次</A> &#124; <A HREF="auarf284.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
