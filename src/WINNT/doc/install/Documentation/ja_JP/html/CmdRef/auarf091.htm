<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理解説書</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- C:\IDWB\TEMP\idwt1068\AUARF000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 21:46:04            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 21:46:02">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 21:46:02">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 21:46:02">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理解説書</H1>
<P>
<H2><A NAME="HDRBK_VOLRESTORE" HREF="auarf002.htm#ToC_105">backup volrestore</A></H2>
<A NAME="IDX4422"></A>
<A NAME="IDX4423"></A>
<A NAME="IDX4424"></A>
<A NAME="IDX4425"></A>
<A NAME="IDX4426"></A>
<A NAME="IDX4427"></A>
<P><STRONG>目的</STRONG>
<P>1 つ以上のボリュームを復元します。
<P><STRONG>構文</STRONG>
<PRE><B>backup volrestore -server</B> &lt;<VAR>destination machine</VAR>>
                  <B>-partition</B> &lt;<VAR>destination partition</VAR>>
                  <B>-volume</B> &lt;<VAR>volume(s) to restore</VAR>><SUP>+</SUP>
                  [<B>-extension</B> &lt;<VAR>new volume name extension</VAR>>]
                  [<B>-date</B> &lt;<VAR>date from which to restore</VAR>><SUP>+</SUP>]
                  [<B>-portoffset</B> &lt;<VAR>TC port offsets</VAR>><SUP>+</SUP>]  [<B>-n</B>]
                  [<B>-localauth</B>]  [<B>-cell</B> &lt;<VAR>cell name</VAR>>]  [<B>-help</B>]

<B>backup volr -s</B> &lt;<VAR>destination machine</VAR>>  <B>-pa</B> &lt;<VAR>destination partition</VAR>>
            <B>-v</B> &lt;<VAR>volume(s) to restore</VAR>><SUP>+</SUP>  [<B>-e</B> &lt;<VAR>new volume name extension</VAR>>]
            [<B>-d</B> &lt;<VAR>date from which to restore</VAR>><SUP>+</SUP>]  [-<B>po</B> &lt;<VAR>TC port offsets</VAR>><SUP>+</SUP>]
            [<B>-n</B>]  [<B>-l</B>]  [<B>-c</B> &lt;<VAR>cell name</VAR>>]  [<B>-h</B>]
</PRE>
<P><STRONG>構文</STRONG>
<P><B>backup volrestore</B> コマンドは、
1 つ以上のボリュームの内容を <B>-server</B> および <B>-partition</B> 引き数で指定されたボリュームに復元します。このコマンドを使用すると、復元されたデータを持つ既存のボリュームの内容を上書きすることも、既存のボリュームを保存して新規のボリュームを作成することもできます。指定されたサイトは、このボリュームの現行サイトであってはなりません。
<P>(指定されたポート・オフセットの <B>/usr/afs/backup/CFG_</B><VAR>device_name</VAR> ファイルに <B>FILE YES</B> 命令がある場合、
<B>backup volrestore</B> コマンドは、磁気テープからではなく、テープ・コーディネーターの <B>/usr/afs/backup/tapeconfig</B> ファイルのポート・オフセットにリストされているバックアップ・データ・ファイルからデータを復元します。説明を分かりやすくするために、以下では磁気テープ装置の場合について説明しますが、バックアップ・データ・ファイルの取り扱いは磁気テープ装置の場合とほとんど同じです。)
<P>コマンドの引き数は、次のように組み合わせることができます。
<UL>
<LI>ボリュームの現在の内容を保存し、新規のボリュームを作成して復元する場合には、
<B>-extension</B> 引き数を使用してください。バックアップ・システムは、
<B>-server</B> および <B>-partition</B> 引き数に指定されたサーバーおよび区画上に新規ボリュームを作成し、それに現在のボリュームと同じ名前を割り当て、指定された拡張子を追加します。さらに、そのボリュームのボリューム・ロケーション・データベース (VLDB) 項目を新規に作成します。新しいボリュームを作成すると、管理者が 2 つのバージョンを比較できるようになります。
</LI><LI>ボリュームの既存の内容を上書きして復元する場合には、
<B>-extension</B> 引き数を省略し、次のようにサイトを指定してください。
<UL>
<LI>現在のサイトを保存する場合には、
<B>-server</B> および <B>-partition</B> 引き数を指定してください。
</LI><LI>ボリュームを上書きするときに別のサイトに移動させる場合には、
<B>-server</B> 引き数または <B> -partition</B> 引き数 (あるいはその両方) を使用して、新しいサイトを指定してください。バックアップ・システムは、指定されたサイトに新しいボリュームを作成し、既存のボリュームを削除して、そのボリュームの VLDB 項目のサイト情報を更新します。ボリュームのバックアップ・バージョンがある場合、それが元のサイトから自動的に除去されることはありません。
<B>vos remove</B> コマンドでそれを除去した後、
<B>vos backup</B> コマンドで新規サイトにバックアップ・バージョンを作成します。
</LI></UL>
</LI><LI>ファイル・システムに存在していないボリュームを復元する場合には、
<B>-volume</B> 引き数にその名前を指定し、
<B> -server</B> および <B>-partition</B> 引き数を使用して、ボリュームの復元先を指定してください。バックアップ・システムは、新しいボリュームを作成し、その VLDB 項目を作成します。
</LI></UL>
<P>いずれの場合も、ボリュームの復元日時がボリュームの作成日に設定されます。この作成日は、<B>vos examine</B> および <B>vos listvol</B> コマンドの出力の <TT>Creation</TT> フィールドに表示されます。
<P>1 つの区画にあるすべてのボリュームを復元する場合には、
<B>backup diskrestore</B> コマンドのほうが効率的です。複数のボリュームを異なるサイトに復元する場合には、
<B>backup volsetrestore</B> コマンドのほうが有効です。
<P>デフォルトでは、<B>backup volrestore</B> コマンドは、各ボリュームの最新のフル・ダンプとそれ以降のインクリメンタル・ダンプを復元するので、復元後のボリュームは、可能な限り最新の状態になります。ボリュームを最新ではない状態に復元する場合には、
<B>-date</B> 引き数を使用してください。バックアップ・システムは、ダンプに含まれるボリュームの<VAR>複製日</VAR> が、指定された日付と時刻よりも前の最新のフル・ダンプおよび連続したインクリメンタル・ダンプを復元します (複製日のタイム・スタンプは、
<B>backup volinfo</B> コマンド出力の <TT>clone date</TT> フィールドに表示されます)。バックアップおよび読み取り専用ボリュームの場合、複製日は、読み取り / 書き込みのソースからボリュームを複製した時刻です。読み取り / 書き込みボリュームの場合は、親ダンプに組み込むためにボリュームをロックした時刻を表します。指定された時刻での実際の状態と復元されるボリュームとの類似性は、最新の適格ダンプのボリューム複製日から指定された時刻までの経過時間によって異なります。
<P><B>-volume</B> 引き数にボリューム名の基本 (読み取り / 書き込み) 形式が指定されている場合、バックアップ・システムは、読み取り / 書き込みまたはバックアップのいずれかのダンプがある最新のダンプ・セットをバックアップ・データベースから検索します。バックアップ・システムは、最新のフル・ダンプから順番に、そのバージョンのボリューム・ダンプを復元します。逆に、ボリューム名に <B>.backup</B> または <B> .readonly</B> という拡張子が明示的に付いていると、バックアップ・システムは、対応するボリューム・バージョンのダンプだけを復元します。
<P>バックアップ・システムが復元操作に必要とする磁気テープのリストを、実際にその操作を実行しないで生成するには、実際のコマンドで使用されるオプションと一緒に <B> -n</B> フラグを付けてコマンドを発行してください。
<P>関連するボリュームのすべてのフル・ダンプおよびインクリメンタル・ダンプが、
1 つのテープ・コーディネーターで読み取り可能なタイプの磁気テープに書き込まれている場合には、
<B>-portoffset</B> 引き数を使用すると、複数のポート・オフセット番号を磁気テープが必要とされる順序で表示することができます (最初に、フル・ダンプのポート・オフセット番号が、次に、レベル 1 のインクリメンタル・ダンプのポート・オフセット番号、というように表示されます)。複数のボリュームを復元する場合には、すべてのボリュームに、同じポート・オフセットの順序リストを使用しなければなりません。そうでない場合には、このコマンドをボリュームごとに発行するか、互換性のある磁気テープ・タイプにダンプされたボリューム・グループを定義してから <B>vos volsetrestore</B> コマンドを発行してください。詳細については、<I>AFS 管理の手引き</I> を参照してください。
<P>このコマンドを実行すると、デフォルトでは、テープ・コーディネーターは、ローカルの <B>/usr/afs/backup/CFG_</B><VAR>device_name</VAR> ファイルの <B>MOUNT</B> 命令を呼び出して、最初に必要な磁気テープにアクセスします。<B>MOUNT</B> 命令がない場合には、磁気テープの挿入をバックアップ操作員に要求します。ただし、<B> CFG_</B><VAR>device_name</VAR> ファイルに <B>AUTOQUERY NO</B> 命令があるか、あるいは <B>butc</B> コマンドが <B>-noautoquery</B> フラグ付きで発行されている場合には、テープ・コーディネーターは、磁気テープがすでに装置に挿入されているとみなします。そうでない場合、あるいは間違った磁気テープが挿入されている場合には、テープ・コーディネーターは <B>MOUNT</B> 命令を呼び出すか、操作員にプロンプトを出します。また、復元操作で別の磁気テープが必要になった場合も、
<B>MOUNT</B> 命令を呼び出すか、バックアップ操作員にプロンプトを出します。この場合、操作員は、必要な磁気テープを挿入しなければなりません。
<P><STRONG>オプション </STRONG>
<DL>
<P><DT><B>-server
</B><DD>各ボリュームを復元するファイル・サーバー・マシンの名前を指定します。この引き数と <B>-partition</B> 引き数には、各ボリュームの現在のサイト以外のサイトを指定します。この場合、<B>-extension</B> 引き数は指定しません。バックアップ・システムは、現在のサイトから既存のボリュームを削除し、指定されたサイトにボリュームを復元し、そのボリュームの VLDB 項目のサイト情報を変更します。
<P><DT><B>-partition
</B><DD>各ボリュームを復元する区画の名前を指定します。この引き数と <B>-server</B> 引き数が、各ボリュームの現在のサイト以外のサイトを指定しており、
<B>-extension</B> 引き数が指定されていない場合、バックアップ・システムは、現在のサイトから既存のボリュームを削除し、指定されたサイトにボリュームを復元し、そのボリュームの VLDB 項目のサイト情報を変更します。
<P><DT><B>-volume
</B><DD>復元するボリュームの名前を指定します。ここには、バックアップ・データベースに登録されているボリューム名を指定します。各ボリュームの基本 (読み取り / 書き込み) 名を指定して、バックアップ・システムが、読み取り / 書き込みまたはバックアップのいずれかのダンプがあるバックアップ・データベースから最新のダンプ・セットを検索するようにします。さらに、最新のフル・ダンプから順番に、そのバージョンのボリュームのダンプを復元します。逆に、ボリューム名に <B>.backup</B> または <B> .readonly</B> という拡張子が明示的に付いていると、バックアップ・システムは、対応するボリューム・バージョンのダンプだけを復元します。
<P><DT><B>-extension
</B><DD>新規のボリュームを作成し、復元したデータを格納します。このときこのボリュームには、<B>-volume</B> 引き数で指定された各ボリュームに、指定された文字列を追加して作られた名前が付けられます。バックアップ・システムは、そのボリュームの VLDB 項目を新規に作成します。
<B>.readonly</B> または <B>.backup</B> 以外の文字列も使用できますが、既存のボリューム名と拡張子の組み合わせは、22 文字よりも長くすることはできません。ピリオドを名前と拡張子の区切り文字に使用するときは、それを文字列の最初の文字に指定します (たとえば、
<B>.rst</B>)。
<P><DT><B>-date
</B><DD>日付と時刻 (オプション) を指定します。復元後のボリュームには、この日付より前に実行されたダンプのデータだけが入ります。この値は、<VAR>mm</VAR>/<VAR>dd</VAR>/<VAR>yyyy</VAR> [<VAR>hh</VAR>:<VAR>MM</VAR>] の形式で指定してください。
<VAR>mm/dd/yyyy</VAR> は必須部分で、月 (<VAR>mm</VAR>)、日 (<VAR>dd</VAR>)、年 (<VAR>yyyy</VAR>) を指定します。<VAR>hh:MM</VAR> はオプションで、時と分を 24 時間形式で指定します。
(たとえば、午後 2 時 36 分は <B>14:36</B> と指定します。)
この値を省略すると、デフォルトで、午前 0 時 0 分 59 秒 (00:00:59) が使用されます。
<P>
<P>年に指定できる値は、
<B>1970</B> から <B>2037</B> までです。
UNIX の標準表記では 2038 年 2 月までしか表現できないので、
2037 より大きな値は無効になります。コマンド・インタープリターは、それ以降の日付を自動的に最大値に変更します。
<P>
<P>この引き数を省略すると、バックアップ・システムは、最後に作成されたダンプを含めて、可能なダンプをすべて復元します。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">コマンドの構文ステートメントは、二重引用符や他の区切り記号で囲む必要のない複数語の値を受け入れるため、その中にあるこの引き数には、正符号 (+) が付きます。このステートメントが複数日付を受け入れるからではありません。日付 (任意選択で、時刻) 定義は、1 つだけ指定してください。
</TD></TR></TABLE>
<P><DT><B>-portoffset
</B><DD>1 つまたは複数のポート・オフセット番号 (最大 128 まで) を指定します。これらは、それぞれ操作で使用するテープ・コーディネーターに対応します。複数の値がある場合は、バックアップ・システムは、各ボリュームのフル・ダンプを回復する場合には最初の値、各ボリュームのレベル 1 のインクリメンタル・ダンプを回復する場合には 2 番目の値、というように指定値を使用します。バックアップ・システムは、ダンプ階層の対応する深さと、それよりも下位のレベルにあるすべてのダンプを回復するときにリスト内の最後の値を使用します。
<P>
<P>すべてのダンプにデフォルトの 0 (ゼロ) が必要でない限り、この引き数を指定してください。
<B>0</B> がリスト内の値の 1 つにすぎない場合は、正しい順序で明示的に指定してください。
<P><DT><B>-n
</B><DD>復元操作に必要なダンプのある磁気テープのリストを表示します。実際の操作は行われません。
<P><DT><B>-localauth
</B><DD>ローカルの <B>/usr/afs/etc/KeyFile</B> ファイルのキーを使用して、サーバー・チケットを構成します。相互認証の間、
<B>backup</B> コマンド・インタープリターは、バックアップ・サーバー、ボリューム・サーバーおよび VL サーバーにこのチケットを提供します。このフラグは、<B>-cell</B> 引き数と一緒に使用してはなりません。詳細については、<B>backup</B> の解説ページを参照してください。
<P><DT><B>-cell
</B><DD>コマンドを実行するセルを指定します。この引き数は、
<B>-localauth</B> フラグと一緒に使用してはなりません。詳細については、<B>backup</B> の解説ページを参照してください。
<P><DT><B>-help
</B><DD>このコマンドのオンライン・ヘルプを出力します。これ以外の有効なオプションはすべて無視されます。
</DL>
<P><STRONG>出力</STRONG>
<P>このコマンドが <B>-n</B> フラグ付きで発行されると、まず次の文字列が表示され、次に復元操作に必要な磁気テープのリストが表示されます。
<PRE>   Tapes needed:

</PRE>
<P><STRONG>例</STRONG>
<P>次のコマンドは、マシン <B>fs5.example.com</B> の区画 <B>/vicepa</B> にボリューム <B>user.pat</B> を復元しています。
<PRE>   % <B>backup volrestore -server fs5.example.com -partition a -volume user.pat</B>

</PRE>
<P>次のコマンドは、ボリューム <B>user.smith</B> および <B>user.terry</B> をマシン <B>fs4.example.com</B> の区画 <B>/vicepb</B> に復元しています。このコマンドでは、各ボリューム名に拡張子 <B>.rst</B> を追加して、既存の <B>user.smith</B> および <B>user.terry</B> ボリュームを保存しています。ここでは、1998 年 1 月 31 日午後 5 時 00 分以前に作成されたダンプだけを復元しています。
(ここで示したコマンドは、読みやすくするために複数行で表示されています。)
<PRE>   % <B>backup volrestore -server fs4.example.com -partition b</B>  \
                       <B>-volume user.smith user.terry</B>  \
                       <B>-extension .rst -date 1/31/1998 17:00</B>

</PRE>
<P>次のコマンドは、マシン <B>fs4.example.com</B> の区画 <B>/vicepb</B> に、ボリューム <B>user.pat</B> を復元しています。ポート・オフセット 1 のテープ・コーディネーターがフル・ダンプのある磁気テープを処理し、ポート・オフセット 0 のテープ・コーディネーターがインクリメンタル・ダンプのあるすべての磁気テープを処理しています。
(ここで示したコマンドは、読みやすくするために 2 行で表示されています。)
<PRE>   % <B>backup volrestore -server fs5.example.com -partition a</B>  \
                       <B>-volume user.pat -portoffset 1 0</B>

</PRE>
<P><STRONG>必要となる特権</STRONG>
<P>コマンドの発行者は、バックアップ・サーバーまたはボリューム・ロケーション (VL) サーバーが実行されている各マシン上、および関連するボリュームのあるすべてのファイル・サーバー・マシン上の <B>/usr/afs/etc/UserList</B> ファイルにリストされていなければなりません。
<B>-localauth</B> フラグを使用する場合には、コマンドの発行者が、ローカル・スーパーユーザー <B>root</B> として、サーバー・マシンにログオンする必要があります。
<P><STRONG>関連情報 </STRONG>
<P><A HREF="auarf060.htm#HDRBK_INTRO">backup</A>
<P><A HREF="auarf073.htm#HDRBK_DUMP">backup dump</A>
<P><A HREF="auarf072.htm#HDRBK_DISKRESTORE">backup diskrestore</A>
<P><A HREF="auarf092.htm#HDRBK_VOLSETRESTORE">backup volsetrestore</A>
<P><A HREF="auarf126.htm#HDRBUTC">butc</A>
<P><A HREF="auarf255.htm#HDRVOS_BACKUP">vos backup</A>
<P><A HREF="auarf271.htm#HDRVOS_REMOVE">vos remove</A>
<P>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auarf090.htm">前ページ</A> &#124; <A HREF="auarf092.htm">次ページ</A> &#124; <A HREF="auarf002.htm#ToC">目次</A> &#124; <A HREF="auarf284.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
