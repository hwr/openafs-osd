<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<HR><H1><A NAME="HDRWQ478" HREF="auagd002.htm#ToC_409">サーバー暗号化鍵の管理</A></H1>
<P>この章では、AFS でのセキュア通信に欠かせない、所属するセルのサーバー暗号化鍵の管理方法について説明します。
<HR><H2><A NAME="HDRWQ479" HREF="auagd002.htm#ToC_410">説明の要約</A></H2>
<P>この章では、以下のタスクを、その隣に示されたコマンドを使用して実行するための方法について説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">新規サーバー暗号化鍵を追加する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos addkey</B> および <B>kas
setpassword</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">認証データベース内の鍵のチェックサムを検査する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>kas examine</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>KeyFile</B> 内の鍵のチェックサムを検査する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos listkeys</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">古いサーバー暗号化鍵を削除する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>bos removekey</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ484" HREF="auagd002.htm#ToC_411">サーバー暗号化鍵について</A></H2>
<A NAME="IDX7241"></A>
<A NAME="IDX7242"></A>
<P><I>暗号化鍵</I>は、情報のパケットを暗号化および複号するために使用する 8 進数のストリングです。AFS では、<I>サーバー暗号化鍵</I>は、AFS サーバー・プロセスとそのクライアント間で転送される情報を保護するために使用される鍵です。サーバー暗号化鍵は、本質的にサーバー・プロセスに対するパスワードであり、ユーザー・パスワードと同様に認証データベースに保管されます。
<P>AFS ファイル・スペース内の情報を権限のないユーザーのアクセスから保護する最も基本的な方法は、セルのサーバー暗号化鍵を適切に管理することです。
<P><H3><A NAME="Header_412" HREF="auagd002.htm#ToC_412">鍵および相互認証: 概要</A></H3>
<A NAME="IDX7243"></A>
<A NAME="IDX7244"></A>
<A NAME="IDX7245"></A>
<A NAME="IDX7246"></A>
<A NAME="IDX7247"></A>
<A NAME="IDX7248"></A>
<P>サーバー暗号化鍵は、
AFS 内のクライアントとサーバー・プロセスとの間の相互認証において中心的な役割を果たします。相互認証の詳細な説明については、<A HREF="auagd007.htm#HDRWQ91">相互認証の詳細</A>を参照してください。
<P>クライアントが AFS サーバーと通信する場合、クライアントはまず認証サーバーの<I>チケット付与サービス</I> (TGS) モジュールと通信します。TGS は、クライアントの確認検査 (間接的にそのクライアントが表す人物のパスワードに基づく) を行った後で、クライアントに<I>サーバー・チケット</I>を付与します。このチケットは、サーバーの暗号化鍵によって暗号化されます。
(TGS はまた、
<I>セッション鍵</I> と呼ばれる 2 番目の暗号化鍵を作成し、サーバーとクライアント間の単一の通信に使用します。サーバー・チケットおよびセッション鍵は、その他の情報も含めて、一まとまりで<I>トークン</I>として言及されます。)
<P>クライアントは、サーバー暗号化鍵を知らないため、サーバー・チケットを読み取ることができません。ただし、クライアントはサーバー・チケットと一緒にサービス要求を AFS サーバーに送信します。これは、サーバー・チケットがクライアントが既に TGS によって認証されていることを AFS サーバー・プロセスに示すからです。
AFS サーバーは、TGS が有効なクライアントのみにチケットを付与することに依存しています。クライアントがサーバーの暗号化鍵で暗号化されたチケットを持っているという事実は、そのクライアントが有効であることをサーバーに対して示します。一方、クライアントは、本物の AFS サーバーのみがチケットを複号するために必要なサーバー暗号化鍵を知っていることを前提とします。チケットを復号し、その内容を理解するサーバーの機能は、サーバーが本物であるとクライアントに証明するものです。
<P><H3><A NAME="Header_413" HREF="auagd002.htm#ToC_413">AFS サーバー暗号化鍵の保守</A></H3>
<P>セルのサーバー暗号化鍵の保守にあたっては、以下に留意してください。
<UL>
<LI>鍵は頻繁に変更して、セルのセキュリティーを向上させてください。少なくとも、
1 月に一度は鍵を変更するよう強くお勧めします。
<A NAME="IDX7249"></A>
</LI><LI>現在使用されている AFS サーバー暗号化鍵は、2 箇所に保管されます。新規に鍵を追加する場合は、両方の場所で変更を行い、かつ正しい順序で変更する必要があります
(指示については、<A HREF="#HDRWQ488">サーバー暗号化鍵の追加</A> を参照)。指示に従わないと、セルの機能を著しく損なうことになり、クライアントおよびサーバーが通信できなくなります。現在のサーバー暗号化鍵の記憶セルは、以下のとおりです。
<P>
<OL TYPE=1>
<LI>すべてのファイル・サーバー・マシンのローカル・ディスク上のファイル <B>/usr/afs/etc/KeyFile</B>。ファイルには複数の鍵がリストでき、それぞれに関連した数値識別子の <I>鍵バージョン番号</I> または <I>kvno</I> が付きます。クライアント・トークンは、その暗号化に使用したキーのバージョン番号を記録し、サーバー・プロセスは、クライアントがトークンを示す際に、このファイルから該当する鍵を検索します。
<A NAME="IDX7250"></A>
<A NAME="IDX7251"></A>
<A NAME="IDX7252"></A>
<A NAME="IDX7253"></A>
<A NAME="IDX7254"></A>
</LI><LI>認証データベース内の <B>afs</B> 項目。現行のサーバー暗号化鍵は、個々のユーザーのスクランブル・パスワードと同様、項目のパスワード・フィールドにあります。認証サーバーのチケット付与サービス (TGS) は、この鍵を使用して、クライアントに付与するトークンを暗号化します。この項目には 1 つの鍵のみが存在します。これは、TGS は既存のトークンを読み取る必要はなく、現行の鍵を使用して新規鍵を作成するためです。
<A NAME="IDX7255"></A>
<A NAME="IDX7256"></A>
<A NAME="IDX7257"></A>
</LI></OL>
<P>
<P>セルの最初のサーバー・マシンを作成する際の、初期 <B>afs</B> 項目、および <B>KeyFile</B> ファイルの作成に関する説明は、
<I>AFS インストールの手引き</I> を参照してください。
</LI><LI>いずれの特定時においても、認証サーバーのチケット付与サービスがクライアントに与えるトークンは、
1 つのサーバー暗号化鍵のみによって暗号化されます。これはつまり、認証データベースの <B>afs</B> 項目に保管される鍵です。
</LI><LI>新規のサーバー暗号化鍵を追加する場合、それぞれの AFS サーバー・マシンのローカル・ディスクの <B>/usr/afs/etc/KeyFile</B> ファイルから即時に以前の鍵を削除することはできません。新規鍵を追加するいずれの場合も、まだ有効で期限が切れていないトークン (前の鍵で暗号化した) を持つクライアントが存在する可能性があります。サーバー暗号化鍵を頻繁に変更すればするほど、そのようなチケットが存在する可能性が高くなります。このようなトークンを持つクライアントに対し適切にサービスを付与するために、
AFS サーバー・プロセスは、その暗号化に使用したサーバー暗号化鍵にアクセスが可能である必要があります。
<P>
<P>古いサーバー暗号化鍵を安全に削除できるのは、この鍵で暗号化したトークンを持つクライアントが存在しないことが確認できた場合のみです。少なくとも一般に、セル内でのトークンの最大の存続時間の間は待つようにします。デフォルトでは、最大トークン存在時間は 25 時間です
(認証データベースの項目が AFS バージョン 3.0 を使用して作成されたユーザーのデフォルトは 100 時間であり、このようなユーザーは除きます)。
<B>-lifetime</B> 引き数を
<B>kas setfields</B> コマンドで使用することにより、このデフォルトを変更することができます。
<P>
<P>古い鍵の削除に関する説明は、<A HREF="#HDRWQ494">サーバー暗号化鍵の削除</A> を参照してください。
</LI><LI>通常のユーザーがそのパスワードを変更する方法とほとんど同じように、自動的に暗号化鍵に変換される文字列を指定して新しい AFS サーバー暗号化鍵を作成します。<A HREF="#HDRWQ488">サーバー暗号化鍵の追加</A> を参照してください。
<A NAME="IDX7258"></A>
</LI><LI>クライアントとの通信の際にサーバー暗号化鍵を使用するほかにも、サーバー・プロセスはこれを他のサーバー・プロセスとの通信を保護するためにも使用します。このため、所属するセル内のすべてのサーバー・マシンは、
<B>KeyFile</B> ファイルの同じバージョンを持たねばなりません。整合性を保つ最も簡単な方法は
(AFS 米国版を実行する場合)、更新サーバーを使用して、システム制御マシンの <B>/usr/afs/etc</B> ディレクトリーの内容を、その他すべてのサーバー・マシンに配布するものです。以下の 2 点の含意があります。
<UL>
<LI>システム制御マシン上で <B>upserver</B> プロセス、システム制御マシンを参照する他のすべてのサーバー・マシンで <B>upclientetc</B> プロセスを実行する必要があります。
<I>AFS インストールの手引き</I> には、両プロセスのインストール方法が記されています。更新サーバー・プロセスが実行しているかを検証する方法については、
<A HREF="auagd009.htm#HDRWQ205">BosConfig ファイルのプロセス状況および情報の表示</A> を参照してください。
<A NAME="IDX7259"></A>
</LI><LI><B>KeyFile</B> ファイルを、システム制御マシンでのみ変更します
(<A HREF="#HDRWQ496">サーバー暗号化鍵の緊急事態の取り扱い</A> で説明する緊急時を除く)。他のサーバー・マシンで行った変更はいずれも、次に <B>upclientetc</B> プロセスがシステム制御マシンの
<B>/usr/afs/etc</B> ディレクトリーを検索する際に上書きされます。デフォルトでは、これは 5 分おきに実行されます。
<A NAME="IDX7260"></A>
</LI></UL>
<P>
<P>AFS 国際版を実行する場合は、更新サーバーを使用して <B>/usr/afs/etc</B> ディレクトリーの内容、特に <B>KeyFile</B> ファイルを変更しないでください。ファイルのデータは極めて重要であるため、暗号化されていない形式で転送することはできません。また米国政府の輸出規制により、
AFS 国際版は、必要な暗号化ルーチンを更新サーバーが使用できる形式で備えていません。代わりに、それぞれのサーバー・マシン上でファイルを個々に変更する必要があり、それぞれのサーバー・マシンで同じ鍵を入力するようにします。
</LI><LI>テキスト・エディターを使用して <B>KeyFile</B> を直接編集しないでください。代わりに、常に適当な <B>bos</B> コマンドを使用します。指示については、<A HREF="#HDRWQ488">サーバー暗号化鍵の追加</A> および <A HREF="#HDRWQ494">サーバー暗号化鍵の削除</A> を参照してください。
</LI></UL>
<HR><H2><A NAME="HDRWQ485" HREF="auagd002.htm#ToC_414">サーバー暗号化鍵の表示</A></H2>
<P>いずれかのファイル・サーバー・マシンの <B>/usr/afs/etc/KeyFile</B> ファイルにあるサーバー暗号化鍵を表示するには、<B>bos listkeys</B> コマンドを使用します。認証データベースの <B>afs</B> 項目にある鍵を表示するには、<B>kas examine</B> コマンドを使用します。
<P>コマンドはデフォルトでは、鍵を構成する 8 進数の実際の文字列を表示することはなく、鍵に定数を暗号化することにより発生する 10 進数である <I>チェックサム</I> を表示します。これにより、権限のないユーザーが実際の鍵に容易にはアクセスし、これを誤って使用したり、保護された通信から盗み出したりすることがないようにしています。
<A NAME="IDX7261"></A>
<A NAME="IDX7262"></A>
<P>
<B>bos listkeys</B> および <B>kas examine</B> コマンドにより所定の鍵の同一のチェックサムが生成されるため、一般的には実際の鍵ではなくチェックサムの表示で十分です。チェックサムによっては分からないような形で鍵が正しくないことが疑われる場合は、セル内全体で認証に問題が発生している可能性があります。最も簡単な解決法は、
<A HREF="#HDRWQ488">サーバー暗号化鍵の追加</A> または <A HREF="#HDRWQ496">サーバー暗号化鍵の緊急事態の取り扱い</A> の手順で新規にサーバー暗号化鍵を作成するものです。この他に <B>bos listkeys</B> コマンドを発行する一般的な理由としては、次の鍵を選択する準備として、現在使用している鍵バージョン番号を表示することがあげられます。この場合も、鍵そのものは関係ないので、チェックサムで十分です。
<P>実際の 8 進数を表示する必要があれば、<B>-showkey</B> 引き数を <B>bos listkeys</B> と <B>kas examine</B> コマンドの両方に組み込みます。
<A NAME="IDX7263"></A>
<A NAME="IDX7264"></A>
<A NAME="IDX7265"></A>
<A NAME="IDX7266"></A>
<A NAME="IDX7267"></A>
<A NAME="IDX7268"></A>
<P><H3><A NAME="HDRWQ486" HREF="auagd002.htm#ToC_415">KeyFile ファイルの表示</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos listkeys</B> コマンドを発行し、
1 つのマシンの <B>/usr/afs/etc/KeyFile</B> ファイルの内容を表示します。
<P>
<PRE>   % <B>bos listkeys</B> &lt;<VAR>machine name</VAR>> [<B>-showkey</B>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listk
</B><DD><B>listkeys</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ファイル・サーバー・マシン名です。通常は、セルが正しく機能するためには <B>KeyFile</B> ファイルがすべてのマシンで同一であるよう要求されるので、いずれのマシンの指定も可能です。
<P><DT><B><B>-showkey</B>
</B><DD>それぞれの鍵を構成する 8 進数を表示します。
</DL>
</LI></OL>
<P>以下の例では、出力に実際の 8 進数ではなくそれぞれのサーバー暗号化鍵のチェックサムが表示されています。最後から 2 番目の行には、管理者が最後にファイルを変更した日時が示され、最終行には出力が管理者が完了したことが示されています。
<PRE>   % <B>bos listkeys fs1.example.com</B>
   key 0 has cksum 972037177
   key 1 has cksum 2825165022
   Keys last changed on Wed Jan 13 11:20:29 1999.
   All done.
</PRE>
<A NAME="IDX7269"></A>
<A NAME="IDX7270"></A>
<A NAME="IDX7271"></A>
<A NAME="IDX7272"></A>
<A NAME="IDX7273"></A>
<A NAME="IDX7274"></A>
<P><H3><A NAME="HDRWQ487" HREF="auagd002.htm#ToC_416">認証データベースの afs 鍵の表示</A></H3>
<OL TYPE=1>
<LI><B>kas examine</B> コマンドを発行して、認証データベースの <B>afs</B> 項目を表示します。
<P>
<P>認証サーバーは、既存の AFS トークンを受け入れるのではなく、独自の認証を実行します。デフォルトでは、認証サーバーは、管理者のローカル (UNIX) 識別を認証します。この識別は AFS 特権管理者に対応しません。
<B>-admin</B> 引き数を組み込み、認証データベース項目に <TT>ADMIN</TT> フラグを持つ識別を指定します。項目にフラグがあることを確認するには、<A HREF="auagd021.htm#HDRWQ813">ADMIN フラグがオンになっていることを確認する</A>で説明するように、<B>kas  examine</B> コマンドを発行します。
<P>
<PRE>   % <B>kas examine afs</B> [<B>-showkey</B>]  \
                     <B>-admin</B> &lt;<VAR>admin principal to use for authentication</VAR>>
    Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>e</B>
</B><DD><B>examine</B> の最も短い受け入れ可能な省略形です。
<P><DT><B>afs
</B><DD><B>afs</B> 項目を指定します。
<P><DT><B><B>-showkey</B>
</B><DD>鍵を構成する 8 進数を表示します。
<P><DT><B>-admin
</B><DD>認証データベース項目に <TT>ADMIN</TT> フラグを持つ管理アカウントを指定します
(<B>admin</B> など)。password プロンプトはアカウントを <VAR>admin_user</VAR> として表示します。適切なパスワードを、<VAR>admin_password</VAR> として入力します。
</DL>
</LI></OL>
<P>以下の例では、<B>admin</B> ユーザーが
<B>-showkey</B> フラグを使用せずに <B>afs</B> 項目を表示します。2 番目の行は、括弧に囲まれた鍵のバージョン番号および鍵のチェックサムを示します。<TT>last mod</TT> 文字列で始まる行は、指示された管理者が鍵を変更した日付を示しています。この日付と、
<B>bos listkeys</B> コマンドが報告する日付には関連がなくても構いません。後者の日付は、鍵の追加だけではなく、<B>KeyFile</B> ファイルを変更すると更新されるためです。
<B>kas examine</B> コマンドの出力の他の行に関する詳細は、<I>AFS Administration Reference</I> の解説ページを参照してください。
<PRE>   % <B>kas examine afs  -admin admin</B>
   Administrator's (admin) password: <VAR>admin_password</VAR>
   User data for afs
    key (1) cksum is 2825165022, last cpw: no date
    password will never expire.
    An unlimited number of unsuccessful authentications is permitted.
    entry expires on never. Max ticket lifetime 100.00 hours.
    last mod on Wed Jan 13 11:21:36 1999 by admin
    permit password reuse
</PRE>
<HR><H2><A NAME="HDRWQ488" HREF="auagd002.htm#ToC_417">サーバー暗号化鍵の追加</A></H2>
<A NAME="IDX7275"></A>
<A NAME="IDX7276"></A>
<A NAME="IDX7277"></A>
<A NAME="IDX7278"></A>
<A NAME="IDX7279"></A>
<A NAME="IDX7280"></A>
<A NAME="IDX7281"></A>
<A NAME="IDX7282"></A>
<A NAME="IDX7283"></A>
<P>前述のとおり、AFS がサーバー暗号化鍵を 2 つの場所に記録します。
<OL TYPE=1>
<LI>各ファイル・サーバー・マシンのローカル・ディスク上のファイル
<B>/usr/afs/etc/KeyFile</B> 内に、各マシン上で実行する AFS サーバー・プロセス用として。
</LI><LI>認証データベース内の <B>afs</B> 項目に、トークン作成時にチケット付与サービス (TGS) 用として。
</LI></OL>
<P>サーバー・プロセスと TGS が同一の AFS サーバー暗号化鍵を使用するようにするために、この節に記載するすべてのステップを中断せずに実行してください。
<P>以下の説明には、すべてのデータベース・サーバー・マシンでデータベース・プロセス (認証、バックアップ、保護、およびボリューム・ロケーション・サーバー) を再始動するステップが含まれています。データベース・サーバー・プロセスが開始すると、これは <B>KeyFile</B> ファイル中、最大の鍵バージョン番号を持つサーバー暗号化鍵を読み取り、これを使用してデータベースの同期化および定数の保持のための送信メッセージを保護します。プロセスは、
<B>KeyFile</B> ファイルから鍵が除去された場合でも存続時間中は同一の鍵を使用し、これは長期におよぶことがあります。ただし、ピア・データベース・サーバーの 1 つが再始動して、他が再始動しない場合、プロセスはもはや同一の鍵を使用しないため、定数およびデータベース同期が中断されます。再始動したプロセスは、現在最大の鍵バージョン番号を持つ鍵を使用し、他のプロセスはその開始時に読み込んだ鍵を使用しています。こうした問題を避けるには、新規の鍵を追加する場合は、すべてのデータベース・プロセスを再始動するのが最も安全な方法です。
<P>新規鍵を追加したら、<B>KeyFile</B> ファイルから古い鍵を除去し、混乱しないようにします。ただし、クライアントまたはサーバー・プロセスがまだ使用している鍵を除去しないように注意してください。詳細については、<A HREF="#HDRWQ494">サーバー暗号化鍵の削除</A> を参照してください。
<P><H3><A NAME="HDRWQ489" HREF="auagd002.htm#ToC_418">新規サーバー暗号化鍵の追加方法</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><A NAME="LIWQ490"></A><B>bos listkeys</B> コマンドを発行して、新しい鍵のバージョン番号を選択する最初のステップとして、既に使用されている鍵バージョン番号を表示します。
<P>
<PRE>   % <B>bos listkeys</B> &lt;<VAR>machine name</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listk
</B><DD><B>listkeys</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>任意のファイル・サーバー・マシンを指定します。
</DL>
</LI><LI><A NAME="LIWQ491"></A><A HREF="#LIWQ490">2</A> のステップの出力、および以下の要件に基づいて、新しい鍵のバージョン番号を選択します。
<UL>
<LI>鍵バージョン番号は、0 (ゼロ) から 255 の範囲の整数で、ケルベロス標準に準拠するものとします。最も簡単な方法は、既存の鍵のバージョン番号の最大のものより 1 つ大きいバージョン番号を選択して、鍵のバージョン番号を連続したものにする方法です。
</LI><LI>現時点で <B>KeyFile</B> ファイルに存在する鍵のバージョン番号、特に認証データベースの <B>afs</B> 項目にあるものは再使用しないでください。クライアント・プロセスはまだその鍵バージョン番号を持つ鍵で暗号化されたチケットを持つ場合がありますが、サーバー・プロセスはその鍵バージョン番号でマークされた新しいキーを使い始めます。鍵が一致しないため、正しいトークンを持つクライアントからの要求をサーバー・プロセスは拒否します。
</LI></UL>
<A NAME="IDX7284"></A>
<A NAME="IDX7285"></A>
</LI><LI><A NAME="LIWQ492"></A><B>bos addkey</B> コマンドを発行し、<B>KeyFile</B> ファイルに新規の AFS サーバー暗号化鍵を作成します。
<P>
<P>米国版の AFS を実行し、更新サーバーを使用してシステム制御マシンの <B>/usr/afs/etc</B> ディレクトリーの内容を配布する場合は、<VAR>machine name</VAR> 引き数をシステム制御マシンに置き換えます。
(システム制御マシンはどれかを忘れてしまった場合には、<A HREF="auagd008.htm#HDRWQ131">システム制御マシンを特定するには</A> を参照してください。)
<P>
<P>国際版の AFS を実行する場合、あるいは更新サーバーを使用しない場合は、<VAR>machine name</VAR> 引き数を順に各サーバー・マシンに置き換えて、<B>bos addkey</B> コマンドを繰り返します。
<P>
<P>新規鍵に対応する文字列が表示されないようにするには、コマンド行から <B>-key</B> 引き数を省略します。代わりに省略した際に表示されるプロンプトで文字列を入力します。以下の構文指定を参照してください。
<P>
<PRE>   % <B>bos addkey  -server</B> &lt;<VAR>machine name</VAR>> <B>-kvno</B> &lt;<VAR>key version number</VAR>>
   input key: <VAR>afs_password</VAR>
   Retype input key: <VAR>afs_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>addk</B>
</B><DD><B>addkey</B> の受け入れ可能な省略形です。
<P><DT><B>-server
</B><DD>更新サーバーを使用している場合は、セルのシステム制御マシン、または使用していない場合は、それぞれのサーバー・マシンを指定します。
<P><DT><B>-kvno
</B><DD>新しい鍵のバージョン番号を、
0 (ゼロ) から 255 までの範囲の整数として指定します。
<P>
<P>番号を忘れないようにしてください。この番号は、
<A HREF="#LIWQ493">6</A> のステップでも再度使用します。
AFS の米国版を使用している場合は、このコマンドを発行するときには必ず同じ番号をタイプしてください。
<P><DT><B><VAR>afs_password</VAR>
</B><DD>1 文字から約 1,000 文字までの長さの、ユーザー・パスワードに類似した文字ストリングです。セキュリティーを向上させるには、アルファベット以外の文字を組み込み、文字列を実用的な範囲で長くします (これを入力する必要があるのは、このステップと <A HREF="#LIWQ493">6</A> のステップだけです)。
AFS の国際版を使用している場合は、このコマンドをタイプするときには、必ず同じストリングを使用してください。
<P>
<P>8 進数のストリングを直接入力しないでください。BOS サーバーは、その文字ストリングをスクランブルして、暗号化鍵としての使用に適した 8 進数に変換し、その後で <B>KeyFile</B> ファイルに記録します。
</DL>
</LI><LI>更新サーバーを使用している場合は、更新サーバーが新しい <B>KeyFile</B> ファイルをすべてのサーバー・マシンに配布している間、数分間待ちます。必要な最大待機期間は、任意のサーバー・マシンに対する <B>upclientetc</B> プロセスの初期化コマンドで指定する <B>-t</B> 引き数に提供する最大値です。デフォルトの時間は 5 分です。
<P>
<P>すべてのマシンが同じ
<B>KeyFile</B> ファイルを持つかどうかを確認するには、各ファイル・サーバー・マシンに対して <B>bos
listkeys</B> コマンドを発行して、新規鍵のチェックサムがすべてのマシンについて同じになるか検証します。
<P>
<PRE>   % <B>bos listkeys</B> &lt;<VAR>machine name</VAR>>
</PRE>
<P>
<P>更新サーバーを使用しない場合は、
<A HREF="#LIWQ492">4</A> のステップを 5 分以内で完了するようにしてください。
<A NAME="IDX7286"></A>
<A NAME="IDX7287"></A>
</LI><LI><A NAME="LIWQ493"></A><B>kas setpassword</B> コマンドを発行して、認証データベースの <B>afs</B> 項目に同じ鍵を入力します。
<P>
<P>認証サーバーは、既存の AFS トークンを受け入れるのではなく、独自の認証を実行します。デフォルトでは、認証サーバーは、管理者のローカル (UNIX) 識別を認証します。この識別は AFS 特権管理者に対応しません。
<B>-admin</B> 引き数を組み込み、認証データベース項目に <TT>ADMIN</TT> フラグを持つ識別を指定します。項目にフラグがあることを確認するには、<A HREF="auagd021.htm#HDRWQ813">ADMIN フラグがオンになっていることを確認する</A>で説明するように、<B>kas  examine</B> コマンドを発行します。
<P>
<PRE>   % <B>kas setpassword -name afs -kvno</B> &lt;<VAR>kvno</VAR>>  \
                     <B>-admin</B> &lt;<VAR>admin principal to use for authentication</VAR>>
   Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
   new_password: <VAR>afs_password</VAR>
   Verifying, please re-enter new_password: <VAR>afs_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>sp</B>
</B><DD><B>setpassword</B> の受け入れ可能な別名です
(<B>setp</B> は受け入れ可能な最も短い省略形です)。
<P><DT><B>-name afs
</B><DD>新規鍵を <B>afs</B> 項目に作成します。
<P><DT><B>-kvno
</B><DD><A HREF="#LIWQ492">4</A> のステップと同じ鍵バージョン番号を指定します。
<P><DT><B>-admin
</B><DD>認証データベース項目に <TT>ADMIN</TT> フラグを持つ管理アカウントを指定します
(<B>admin</B> など)。password プロンプトはアカウントを <VAR>admin_user</VAR> として表示します。適切なパスワードを、<VAR>admin_password</VAR> として入力します。
<P><DT><B><VAR>afs_password</VAR>
</B><DD><A HREF="#LIWQ492">4</A> のステップで入力したものと同じ文字列です。
</DL>
</LI><LI><B>(オプション)</B>
<B>KeyFile</B> ファイルおよび認証データベースの
<B>afs</B> 項目で作成した鍵が同一であり、同じ鍵バージョン番号を持つことを検査する場合は、
<A HREF="#HDRWQ485">サーバー暗号化鍵の表示</A> の手順に従ってください。
</LI><LI><B>bos restart</B> コマンドを発行して、すべてのデータベース・サーバー・マシンでデータベース・サーバー・プロセスを再始動します。これにより、現在最大のバージョン番号を持つ <B>KeyFile</B> ファイル中の鍵が使用されるようになります。
<P>
<P>それぞれのデータベース・サーバー・マシンについて、最下位の IP アドレスを持つものから開始して、このコマンドを連続して繰り返します。
<P>
<PRE>   % <B>bos restart</B> &lt;<VAR>machine name</VAR>> <B>buserver kaserver ptserver vlserver</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>res</B>
</B><DD><B>restart</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>それぞれのデータベース・サーバー・マシンを順に命名します。
<P><DT><B>buserver kaserver ptserver vlserver
</B><DD>それぞれ、バックアップ・サーバー、認証サーバー、保護サーバー、およびボリューム・ロケーション (VL) サーバーを指定します。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ494" HREF="auagd002.htm#ToC_419">サーバー暗号化鍵の削除</A></H2>
<A NAME="IDX7288"></A>
<A NAME="IDX7289"></A>
<A NAME="IDX7290"></A>
<P><B>/usr/afs/etc/KeyFile</B> ファイルから古い鍵を定期的に除去し、これを適切なサイズに保持することができます。セル機能を混乱させることがないよう、古い鍵の除去は、その鍵を使用して暗号化し、ユーザーまたはクライアント・プロセスが保持しているトークンがすべて期限切れになるまでは行わないようにしてください。新規鍵の追加後は、最低でもセル内で使用する最長のトークン存続時間の間は待ってから古い鍵を除去してください。
AFS バージョン 3.1 で作成された認証データベースのユーザー項目の場合、デフォルトのトークン存続時間は 25 時間、AFS バージョン 3.0 で作成された項目は、100 時間となっています。
<P>認証データベースの <B>afs</B> 項目は、鍵フィールドを空にすることができないため、この項目から鍵を削除するコマンドはありません。
<B>kas setpassword</B> コマンドを使用して、
<B>afs</B> キーを置き換えますが、これは <A HREF="#HDRWQ489">新規サーバー暗号化鍵の追加方法</A> に詳細が説明されている完全な手順の一部です。
<P>現在 認証データベースの <B>afs</B> 項目にある <B>KeyFile</B> ファイルからは鍵を削除しないでください。
AFS サーバー・プロセスは、クライアントが示すチケットの暗号化ができなくなります。
<P><H3><A NAME="HDRWQ495" HREF="auagd002.htm#ToC_420">KeyFile ファイルの鍵の除去</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>bos listkeys</B> コマンドを発行し、除去する鍵のそれぞれの鍵バージョン番号を表示します。出力には、新しい鍵が <B>KeyFile</B> ファイルに入れられてから最低 25 時間経過したかどうかが示されます。<B>bos
listkeys</B> コマンドの完全な説明については、<A HREF="#HDRWQ486">KeyFile ファイルの表示</A> を参照してください。
<P>
<PRE>   % <B>bos listkeys</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>kas examine</B> コマンドを発行し、現在認証データベース の <B>afs</B> 項目にある鍵が、
<B>KeyFile</B> ファイルから除去するいずれの鍵とも同じ鍵バージョン番号を持たないことを確認します。
<B>kas examine</B> コマンドの詳細は、
<A HREF="#HDRWQ487">認証データベースの afs 鍵の表示</A> を参照してください。
<P>
<PRE>   % <B>kas examine afs  -admin</B> &lt;<VAR>admin principal to use for authentication</VAR>>
   Administrator's (<VAR>admin_user</VAR>) password: <VAR>admin_password</VAR>
</PRE>
<A NAME="IDX7291"></A>
<A NAME="IDX7292"></A>
</LI><LI><B>bos removekey</B> コマンドを発行し、<B>KeyFile</B> ファイルから 1 つ以上のサーバー暗号化鍵を削除します。
<P>
<P>米国版の AFS を実行し、更新サーバーを使用してシステム制御マシンの <B>/usr/afs/etc</B> ディレクトリーの内容を配布する場合は、<VAR>machine name</VAR> 引き数をシステム制御マシンに置き換えます。
(システム制御マシンはどれかを忘れてしまった場合には、<A HREF="auagd008.htm#HDRWQ131">システム制御マシンを特定するには</A> を参照してください。)
<P>
<P>国際版の AFS を実行する場合、あるいは更新サーバーを使用しない場合は、<VAR>machine name</VAR> 引き数を順に各サーバー・マシンに置き換えて、<B>bos removekey</B> コマンドを繰り返します。
<P>
<PRE>   % <B>bos removekey</B> &lt;<VAR>machine name</VAR>> &lt;<VAR>key version number</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>removek</B>
</B><DD><B>removekey</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>更新サーバーを使用している場合は、セルのシステム制御マシン、または使用していない場合は、それぞれのサーバー・マシンを指定します。
<P><DT><B><VAR>key version number</VAR>
</B><DD>削除する各鍵のバージョン番号を指定します。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ496" HREF="auagd002.htm#ToC_421">サーバー暗号化鍵の緊急事態の取り扱い</A></H2>
<A NAME="IDX7293"></A>
<A NAME="IDX7294"></A>
<A NAME="IDX7295"></A>
<A NAME="IDX7296"></A>
<A NAME="IDX7297"></A>
<P>まれに、クライアントあるいはピア・サーバー・プロセスが提供するサーバー・チケットを、AFS サーバー・プロセスが復号できなくなることがあります。サーバー・プロセスが、それらのチケットが偽造されたものであるか、または有効期限切れのものであると判断し、任意のアクションの実行を拒絶するため、セル内の活動は停止します。このような事態は 1 つまたはいくつかのマシンで発生する可能性がありますが、より多くのマシンがかかわる場合は影響がより深刻になります。
<P>サーバー暗号化鍵問題の 1 つの一般的な原因は、クライアントのチケットがサーバー・プロセスが認識しない鍵を使用して暗号化される場合です。通常これは、サーバー・マシン上の <B>/usr/afs/etc/KeyFile</B> に、認証サーバーのチケット付与サービス (TGS) モジュールがサーバー・チケットを暗号化するのに使用する <B>afs</B> 認証データベース項目の鍵が含まれていないことを意味します。
<P>別の可能性は、異なるマシン上の <B>KeyFile</B> ファイルが同じ鍵を持たない場合です。この場合、サーバー・プロセス間の通信は不可能になります。たとえば、異なるデータベース・サーバー・マシン上のデータベース・サーバー・プロセスのインスタンスが同じサーバー暗号化鍵を使用しない場合は、
AFS の複製データベース機構 (Ubik) は中断します。
<P><B>bos</B> コマンドをローカル・セル内のファイル・サーバー・マシンに送信したときに、次のメッセージを送信することがあると、これはサーバー暗号化化鍵のミスマッチの兆候です。
(ただし、<B>bos</B> コマンドを外部セル内のファイル・サーバー・マシンに送信したときに
<B>-cell</B> 引き数を指定しなかった場合も、このメッセージを受信することに注意してください。)
<PRE>   bos: failed to contact host's bosserver (security object was passed a bad ticket).
</PRE>
<P>サーバー暗号化鍵の緊急事態の解決方法は、すべてのファイル・サーバー・マシン上の認証データベースおよび <B>KeyFile</B> の両方に新しい AFS サーバー暗号化鍵を入れることです。これにより、TGS およびすべてのサーバー・プロセスが再度同じ鍵を共有するようになります。
<P>鍵の緊急事態の処理では、特別なアクションが要求されます。これらのアクションを使用する理由が以下の機能グループに説明されています。実際の手順は、後続の説明に記載されています。
<P><H3><A NAME="HDRWQ497" HREF="auagd002.htm#ToC_422">相互認証が行えない</A></H3>
<P>鍵の緊急事態を取り扱っているときには、サーバー・プロセスがユーザーとの間で相互認証を行おうとすることを避ける必要があります。なぜなら、ユーザーのトークンをサーバー・プロセスが解読できない可能性があるからです。相互認証を行わない場合は、サーバー・プロセスはユーザーに一致<B> anonymous</B> を割り当てます。相互認証を行わないようにするには、<B>unlog</B> コマンドを使用してトークンを破棄し、
<B>-noauth</B> フラグが使用可能なコマンドにこれを組み込みます。
<P><H3><A NAME="Header_423" HREF="auagd002.htm#ToC_423">手動で許可検査を使用不可にする</A></H3>
<P>相互認証を行わない場合は、サーバー・プロセスがユーザーを <B>anonymous</B> であると認識するため、許可検査をオフにする必要があります。サーバー・プロセスは、許可検査を使用不可にした場合のみ
<B>anonymous</B> が鍵の作成などの特権が必要なアクションを実行することを許可します。
<P>緊急事態では、手動でファイル <B>/usr/afs/local/NoAuth</B> を作成して許可検査を使用不可にします。通常は、代わりに <B>bos setauth</B> コマンドを使用します。
<P><H3><A NAME="Header_424" HREF="auagd002.htm#ToC_424">各マシン上で迅速に作業する</A></H3>
<P>許可検査を使用不可にすると、その影響を受けるマシン上のサーバー・プロセスがどのユーザーに対してもアクションを取るため、セキュリティーが重大な危機にさらされます。許可検査を使用不可にする際には、中断しないセッションですべてのステップをできる限り迅速に完了し、必要な期間のみ実行する必要があります。
<P><H3><A NAME="Header_425" HREF="auagd002.htm#ToC_425">コンソールで作業する</A></H3>
<P>認可検査を使用不可にするそれぞれのサーバー・マシンのコンソールで作業をすることにより、ユーザーがそこで作業をしている間は、他のユーザーは誰もそのコンソールにログオンすることはありません。他のユーザーがそのマシンにリモートに接続
(たとえば <B>telnet</B> プログラムを使用するなど) することを防ぐわけではないため、迅速に作業することが重要です。完全なセキュリティーを確保するためには、ネットワーク通信を使用不可にしますが、これは多くの環境では実行可能な選択ではありません。
<A HREF="auagd007.htm#HDRWQ90">セル内のセキュリティー改善</A> で推奨しているように、サーバー・マシンに常時リモート接続できる人数を制限すると、全般的なセキュリティーを向上させることができます。
<P><H3><A NAME="HDRWQ498" HREF="auagd002.htm#ToC_426">個々の KeyFile ファイルを変更する</A></H3>
<P>更新サーバーを使用して <B>/usr/afs/etc</B> ディレクトリーの内容を配布すると、緊急事態になるのは、個々のマシン上の <B>KeyFile</B> ファイルを変更するころ合いになった場合のみになります。各マシンのファイルを更新する必要があるのは、不一致となったキーにより、システム制御マシンの <B>upserver</B> プロセスが、他のサーバー・マシン上の <B>upclientetc</B> プロセスと相互認証できなくなり、<B>upserver</B> プロセスがその <B>KeyFile</B> ファイルを upclientetc プロセスに配布するのを拒否するからです。
<P>更新サーバーが正常に作動しているように見えても、それを確認する唯一の方法は、システム制御マシン上の鍵を変更して、標準遅延時間を待って <B>upclientetc</B> プロセスがそのキーを取り出すかどうかを確認することです。緊急事態では、標準遅延時間の間待機することは普通意味がありません。単に各サーバー・マシン上のファイルを別々に更新するほうがより効果的です。また、更新サーバーがファイルを正しく配布する場合でも、キーの不一致のために他のプロセスに問題が発生する可能性もあります。以下の説明では、最初にシステム制御マシンに新規の鍵ファイルを追加しています。更新サーバーが作動していれば、それぞれのサーバー上で個々に行った変更と同じ変更を配布することになります。
<P>所属するセルが更新サーバーを使用しない、または AFS 国際版を使用する場合は、常にサーバー・マシン上の鍵を個別に変更します。以下の説明もまた役立ちます。
<P><H3><A NAME="Header_427" HREF="auagd002.htm#ToC_427">2 つのコンポーネント・プロシージャー</A></H3>
<P>以下の説明では、頻繁に使用される 2 つのサブプロシージャー、許可検査の使用不可および許可検査の再使用可能化を記載します。分かりやすいように、ここではプロシージャーを詳細に説明します。必要である場合は、プロシージャーを参照します。
<P><H4><A NAME="HDRWQ499">緊急事態において許可検査を使用不可にする</A></H4>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
<A NAME="IDX7298"></A>
</LI><LI><A NAME="LIWQ500"></A>ファイル <B>/usr/afs/local/NoAuth</B> を作成して、許可検査を使用不可にします。
<P>
<PRE>   # <B>touch /usr/afs/local/NoAuth</B>
</PRE>
<A NAME="IDX7299"></A>
</LI><LI>トークンが互換性のない鍵で暗号化された場合、いくつかのコマンドが実行されない可能性があるため、トークンを破棄します。
<P>
<PRE>   # <B>unlog</B>
</PRE>
</LI></OL>
<P><H4><A NAME="HDRWQ501">緊急事態において許可検査を再度使用可能にする</A></H4>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>/usr/afs/local/NoAuth</B> ファイルを除去します。
<P>
<PRE>   # <B>rm /usr/afs/local/NoAuth</B>
</PRE>
<A NAME="IDX7300"></A>
</LI><LI><B>system:administrators</B> グループに含まれ、
<B>/usr/afs/etc/UserList</B> ファイルにリストされる管理 ID として認証をする。
<P>
<PRE>   # <B>klog</B> &lt;<VAR>admin_user</VAR>>
   Password: &lt;<VAR>admin_password</VAR>>
</PRE>
</LI><LI>問題がなければ、
<B>unlog</B> コマンドを発行してユーザーのトークンを破棄した後で、マシンのコンソールからログアウトします (または使用するリモート接続をクローズします)。
</LI></OL>
<P><H3><A NAME="Header_430" HREF="auagd002.htm#ToC_430">緊急事態における新規サーバー暗号化鍵の作成方法</A></H3>
<OL TYPE=1>
<LI><A NAME="LIWQ502"></A><B>システム制御マシン上で</B>、
<A HREF="#HDRWQ499">緊急事態において許可検査を使用不可にする</A> の説明に従い、許可検査を使用不可にします。
</LI><LI><A NAME="LIWQ503"></A><B>bos listkeys</B> コマンドを発行して、新しい鍵のバージョン番号を選択する最初のステップとして、<B>KeyFile</B> ファイルで使用されている鍵バージョン番号を表示します。
<P>
<PRE>   #<B> bos listkeys</B> &lt;<VAR>machine name</VAR>> <B>-noauth</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>listk</B>
</B><DD><B>listkeys</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD>ファイル・サーバー・マシンを指定します。
<P><DT><B><B>-noauth</B>
</B><DD>BOS サーバーとの相互認証をバイパスします。鍵の緊急事態により、相互認証が正常に行われない場合に、これを組み込みます。
</DL>
</LI><LI><A NAME="LIWQ504"></A><A HREF="#LIWQ503">2</A> のステップで調べた事柄、および以下の要件に基づいて、新しい鍵のバージョン番号を選択します。
<UL>
<LI>既存の鍵のバージョン番号の最大のものより 1 つ大きいバージョン番号を選択して、鍵のバージョン番号を連続したものにすることが望まれる。
</LI><LI>鍵のバージョン番号は 0 から 255 までの整数とし、ケルベロス標準に適合するものとします。
</LI><LI><B>KeyFile</B> ファイルに現在リストされている鍵バージョン番号を再使用しないでください。
</LI></UL>
<A NAME="IDX7301"></A>
</LI><LI><A NAME="LIWQ505"></A><B>システム制御マシン上で</B>、
<B>bos addkey</B> コマンドを発行し、
<B>KeyFile</B> ファイルに新しい AFS サーバー暗号化鍵を作成します。
<P>
<PRE>   # <B>bos addkey</B> &lt;<VAR>machine name</VAR>> <B>-kvno</B> &lt;<VAR>key version number</VAR>> <B>-noauth</B>
   input key: <VAR>afs_password</VAR>
   Retype input key: <VAR>afs_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>addk</B>
</B><DD><B>addkey</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>machine name</VAR>
</B><DD><B>KeyFile</B> ファイルに新しい鍵を定義するファイル・サーバー・マシンの名前です。
<P><DT><B>-kvno
</B><DD><A HREF="#LIWQ504">3</A> のステップで選択した鍵のバージョン番号を選択します。
0 (ゼロ) から 255 までの範囲の整数です。
<A HREF="#LIWQ508">7</A>、<A HREF="#LIWQ509">8</A>、および <A HREF="#LIWQ512">13</A> のステップでは、同じ数を指定する必要があります。
<P><DT><B><B>-noauth</B>
</B><DD>BOS サーバーとの相互認証をバイパスします。鍵の緊急事態により、相互認証が正常に行われない場合に、これを組み込みます。
<P><DT><B><VAR>afs_password</VAR>
</B><DD>1 文字から約 1,000 文字までの長さの、ユーザー・パスワードに類似した文字ストリングです。セキュリティー向上のため、実用的である範囲で文字列を長くし、アルファベット以外の文字を含めます。
<P>
<P>8 進数のストリングを直接タイプしないでください。
BOS サーバーは、その文字ストリングをスクランブルして、暗号化鍵としての使用に適した 8 進数に変換し、その後で <B>KeyFile</B> ファイルに記録します。
<P>
<P>ストリングを忘れないようにしてください。これを再度、<A HREF="#LIWQ508">7</A>、<A HREF="#LIWQ509">8</A>、および <A HREF="#LIWQ512">13</A> のステップで使用します。
</DL>
</LI><LI><A NAME="LIWQ506"></A><B>所属するセル内のすべてのデータベース・サーバー・マシン上で</B> (システム制御マシン以外)、
<A HREF="#HDRWQ499">緊急事態において許可検査を使用不可にする</A> の指示に従い許可検査を使用不可にします。システム制御マシンがデータベース・サーバー・マシンの場合は、既に <A HREF="#LIWQ502">1</A> のステップで許可検査を使用不可にしているので、手順を繰り返さないでください。
(どのマシンがデータベース・サーバー・マシンであるかを確認する必要がある場合は、
<A HREF="auagd008.htm#HDRWQ130">データベース・サーバー・マシンを特定するには</A> で説明している <B>bos listhosts</B> コマンドを使用してください。)
</LI><LI><A NAME="LIWQ507"></A><A HREF="#LIWQ506">5</A> のステップを終了した後で最低 90 秒待ち、それぞれのデータベース・サーバーのプロセス (認証サーバー、バックアップ・サーバー、保護サーバー、およびボリューム配置サーバー) が新規の同期サイトの選択を完了するようにします。その上で <B>udebug</B> コマンドを発行し、選択が正しく行われたかを確認します。以下のコマンドを発行します。
<VAR>server machine</VAR> のそれぞれのデータベース・サーバー・マシン名を順に置換します。システム制御マシンがデータベース・サーバー・マシンであれば、これを組み込みます。
<P>
<PRE>   # <B>udebug</B> &lt;<VAR>server machine</VAR>> <B>buserver</B>
   # <B>udebug</B> &lt;<VAR>server machine</VAR>> <B>kaserver</B>
   # <B>udebug</B> &lt;<VAR>server machine</VAR>> <B>ptserver</B>
   # <B>udebug</B> &lt;<VAR>server machine</VAR>> <B>vlserver</B>
</PRE>
<P>
<P>それぞれのプロセスについて、すべてのデータベース・サーバー・マシンからの出力は、そのサイトがプロセスに対する同期サイトかという点において一致している必要があります。ただし、同じマシンをそれぞれ 4 つのプロセスの同期サイトにする必要はありません。それぞれのプロセスにつき、
1 つのマシンのみの出力が以下の文字列を含むようにします。
<P>
<PRE>   I am sync site ...
</PRE>
<P>
<P>他のマシンの出力は、代わりに以下の行を含みます。
<P>
<PRE>   I am not sync site
</PRE>
<P>
<P>および以降の行 (文字列 <TT>Sync host</TT> に始まり、同期サイトであると表示されるマシンの IP アドレスを指定)
を含む必要があります。
<P>
<P>出力がこれらの要件と一致しない場合、またはその他の点で問題があると思われる場合は、
AFS プロダクト・サポートに連絡してサポートを受けてください。
</LI><LI><A NAME="LIWQ508"></A><B>所属するセル内のすべてのデータベース・サーバー・マシン上で</B>
(システム制御マシン以外)、
<A HREF="#LIWQ505">4</A> のステップで説明している <B>bos addkey</B> コマンドを実行します。必ずそのステップで使用したものと同じ値を、<VAR>afs_password</VAR> および <VAR>kvno</VAR> で使用してください
<A NAME="IDX7302"></A>
</LI><LI><A NAME="LIWQ509"></A><B>kas setpassword</B> コマンドを発行して、認証データベースの <B>afs</B> 項目に新規の鍵を定義します。これは、<A HREF="#LIWQ505">4</A>
および <A HREF="#LIWQ508">7</A> のステップで作成したキーに一致しなくてはなりません。
<P>
<PRE>   # <B>kas setpassword  -name afs</B>  <B>-kvno</B> &lt;<VAR>key version number</VAR>> <B>-noauth</B>
   new_password: <VAR>afs_password</VAR>
   Verifying, please re-enter new_password: <VAR>afs_password</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><B>sp</B>
</B><DD><B>setpassword</B> の受け入れ可能な別名です
(<B>setp</B> は受け入れ可能な最も短い省略形です)。
<P><DT><B>-kvno
</B><DD><A HREF="#LIWQ505">4</A> のステップで指定したものと同じ鍵バージョン番号です。
<P><DT><B><VAR>afs_password</VAR>
</B><DD><A HREF="#LIWQ505">4</A> のステップで <VAR>afs_password</VAR> として指定したものと同じ文字列です。文字ストリングは画面にそのまま表示されません。
</DL>
</LI><LI><A NAME="LIWQ510"></A><B>所属するセル内のすべてのデータベース・サーバー・マシン上で</B> (システム制御マシンがデータベース・サーバー・マシンであればこれも含む)、
<A HREF="#HDRWQ501">緊急事態において許可検査を再度使用可能にする</A> の説明に従い許可検査を再度使用可能にします。システム制御マシンがデータベース・サーバー・マシンでない場合、この手順は <A HREF="#LIWQ511">11</A> のステップまで実行しないでください。
</LI><LI><A HREF="#LIWQ507">6</A> のステップを繰り返し、
<A HREF="#LIWQ510">9</A> のステップで再始動してから各データベース・サーバー・プロセスが適切に同期サイトを選択したかどうかを検査します。
</LI><LI><A NAME="LIWQ511"></A><B>システム制御マシン上で</B> (これがデータベース・サーバー・マシンでない場合)、
<A HREF="#HDRWQ501">緊急事態において許可検査を再度使用可能にする</A> の指示に従い許可検査を再度使用可能にします。これがデータベース・サーバー・マシンであれば、既に <A HREF="#LIWQ510">9</A> のステップで手順を実行しています。
</LI><LI><B>すべて残りの (単純) ファイル・サーバー・マシンで</B>、
<A HREF="#HDRWQ499">緊急事態において許可検査を使用不可にする</A> の手順に従い許可検査を使用不可にします。
</LI><LI><A NAME="LIWQ512"></A><B>すべての残りの (単純) ファイル・サーバー・マシンで</B>、<B>bos addkey</B> コマンドを発行します。
<A HREF="#LIWQ505">4</A> のステップを参照してください。必ずそのステップで使用したものと同じ値を、<VAR>afs_password</VAR> および <VAR>kvno</VAR> で使用してください
</LI><LI><B>すべての残りの (単純) ファイル・サーバー・マシンで</B>、
<A HREF="#HDRWQ501">緊急事態において許可検査を再度使用可能にする</A> の指示に従い許可検査を再度使用可能にします。
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd013.htm">前ページ</A> &#124; <A HREF="auagd015.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 -->
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
