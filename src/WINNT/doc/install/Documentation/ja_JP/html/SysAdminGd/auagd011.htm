<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<HR><H1><A NAME="HDRWQ334" HREF="auagd002.htm#ToC_270">AFS バックアップ・システムの構成</A></H1>
<P>AFS バックアップ・システムは、AFS ボリュームからデータのバックアップ・コピーを作成し、ファイル・システムが消失したり、破壊された場合にはファイル・システムにデータを復元します。この章では、バックアップ・システムの構成方法について説明します。データのバックアップおよび復元方法、ダンプ・レコードの表示方法については、<A HREF="auagd012.htm#HDRWQ383">AFS データのバックアップと復元</A> を参照してください。
<HR><H2><A NAME="HDRWQ335" HREF="auagd002.htm#ToC_271">手順の概要</A></H2>
<P>この章では、指示されたコマンドを使って以下のタスクを実行する手順について説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">テープ容量およびファイル・マーク・サイズの判別
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fms</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">バックアップ・データベース内のテープ・コーディネーターの定義
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup addhost</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">テープ・コーディネーターのバックアップ・データベースからの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup delhost</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">バックアップ・データベースのテープ・コーディネーター項目の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup listhosts</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ボリューム・セットの作成
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup addvolset</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ボリューム項目のボリューム・セットへの追加
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup addvolentry</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ボリューム・セットおよび項目のリスト
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup listvolsets</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ボリュームのバックアップ・データベースからの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup delvolset</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ボリューム項目のボリューム・セットからの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup delvolentry</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ダンプ・レベルの定義
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup adddump</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">既存のダンプ・レベルの有効期限の変更
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup setexp</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ダンプ階層のダンプ・レベルの削除
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup deldump</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ダンプ階層の表示
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup listdumps</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">テープのラベル付け
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup labeltape</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">テープのラベルの読み取り
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>backup readlabel</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ351" HREF="auagd002.htm#ToC_272">バックアップ・システム機能の紹介</A></H2>
<A NAME="IDX6800"></A>
<P>AFS バックアップ・システムは非常に柔軟なシステムで、これにより、ボリューム・バックアップされる頻度、ボリューム内のすべてのデータをダンプするのか、最後のダンプ操作の後で変更されたデータだけをダンプするのか、などほとんどのバックアップ・プロセスを制御することができます。また、バックアップ・プロセスの多くを自動化する機能を利用することができます。
<P>バックアップ・システムを有効に管理および使用するには、以降の機能グループで説明する内容についてよく理解する必要があります。ユーザーのセルにバックアップ・システムを構成し、機能をインプリメントする方法については、
<A HREF="#HDRWQ357">バックアップ・システム構成の概説</A> を参照してください。
<P><H3><A NAME="HDRWQ352" HREF="auagd002.htm#ToC_273">ボリューム・セットおよびボリューム項目</A></H3>
<A NAME="IDX6801"></A>
<A NAME="IDX6802"></A>
<A NAME="IDX6803"></A>
<A NAME="IDX6804"></A>
<A NAME="IDX6805"></A>
<P>AFS データをバックアップする場合、どのファイルを組み込むのかを個々のファイルについてではなく、ボリューム全体について指定します。より正確にいうと、<I>ボリューム・セット</I> というボリュームのグループを定義し、この中の 1 つまたは複数のボリュームを 1 回の操作でバックアップすることになります。データのバックアップ・コマンド
(<B>backup dump</B> コマンド) では個々のボリューム名は指定できないので、ボリュームはバックアップするボリューム・セットに組み込む必要があります。
<P>ボリューム・セットは、1 つまたは複数の <I>ボリューム項目</I> から構成されています。この項目には、その位置 (ファイル・サーバー・マシンおよび区画) に基づいてバックアップされるボリューム、およびボリューム名が指定されています。ワイルドカードを使用すると、位置を許容しているボリュームまたは名前に共通の文字列を含むボリューム (あるいはその両方) をまとめて指定することができます。
<P>ボリューム・セットおよびボリューム項目の作成および削除方法については、
<A HREF="#HDRWQ365">ボリューム・セットおよびボリューム項目の定義および表示</A> を参照してください。
<P><H3><A NAME="Header_274" HREF="auagd002.htm#ToC_274">ダンプおよびダンプ・セット</A></H3>
<A NAME="IDX6806"></A>
<A NAME="IDX6807"></A>
<A NAME="IDX6808"></A>
<A NAME="IDX6809"></A>
<A NAME="IDX6810"></A>
<A NAME="IDX6811"></A>
<A NAME="IDX6812"></A>
<A NAME="IDX6813"></A>
<A NAME="IDX6814"></A>
<A NAME="IDX6815"></A>
<P><I>dump</I> は、ボリューム・セットのバックアップで生成されたデータのコレクションです。
<I>フル・ダンプ</I> には、ダンプ操作時に存在しているボリューム・セットのボリューム・データがすべて書き込まれます。
<I>増分ダンプ</I> には、ボリューム・セットのボリューム・データの一部 (指定されたダンプ操作の後に変更されたファイルおよびディレクトリー構造) が書き込まれます。前のダンプは、増分ダンプの <I>親ダンプ</I> になります。これは、フル・ダンプの場合も増分ダンプの場合もあります。
<P><I>ダンプ・セット</I> は、1 つまたは複数の磁気テープに格納されているダンプのコレクションです。ダンプ・セットの最初のダンプは <I>初期ダンプ</I> といい、既存のダンプの最後に追加されるダンプを <I>付加ダンプ</I> といいます。付加ダンプはオプションですが、磁気テープの容量を最大限に利用することができます。逆に、初期ダンプだけにすると、一部しか使用していない磁気テープが数多くできてしまいます。初期ダンプは必ず磁気テープの先頭から開始しますが、磁気テープの最後まで書き込まれるとは限りません。付加ダンプを初期ダンプや別の付加ダンプに関連させる必要はありませんが
(同じまたは関連するボリュームのダンプにする必要はありませんが)、よく計画して付加ダンプを作成すると、復元操作での磁気テープの交換回数を減らすことができます。たとえば、ボリューム・セットの増分ダンプを 1 つのダンプ・セットにまとめると効果的です。
<P>バックアップ・データベースでは、初期ダンプを基準に、ダンプ・セットのすべてのレコードに索引が付いています
(バックアップ・データベースの詳細については、<A HREF="#HDRWQ356">バックアップ・データベースおよびバックアップ・サーバー・プロセス</A> を参照してください)。付加ダンプのレコードをデータベースから削除する場合には、初期ダンプのレコードも削除しなければなりません。これを行うと、ダンプ・セットのすべてのダンプのレコードが削除されます。また、1 つの磁気テープを再利用するには、ダンプ・セットのすべての磁気テープのレコードをデータベースから削除しなければなりません。
<P>初期ダンプの作成方法については <A HREF="auagd012.htm#HDRWQ412">データのバックアップ</A> を、付加ダンプについては <A HREF="auagd012.htm#HDRWQ415">ダンプを既存のダンプ・セットに追加するには</A> をそれぞれ参照してください。
<P><H3><A NAME="Header_275" HREF="auagd002.htm#ToC_275">ダンプ階層、ダンプ・レベルおよび有効期限</A></H3>
<A NAME="IDX6816"></A>
<A NAME="IDX6817"></A>
<A NAME="IDX6818"></A>
<A NAME="IDX6819"></A>
<A NAME="IDX6820"></A>
<A NAME="IDX6821"></A>
<P><I>ダンプ階層</I> は、フル・ダンプと増分ダンプの関係を定義している論理構造です。ここでは、増分ダンプの親となるダンプを定義しています。階層内の個々のコンポーネントを <I>ダンプ・レベル</I>
といいます。
<B>backup dump</B> コマンドでダンプを作成するときには、ボリューム・セットの名前とダンプ・レベルを指定します。バックアップ・システムは、ダンプ・レベルを使用して、このダンプがフル・ダンプなのか増分ダンプなのかを判別します。また、増分ダンプの場合には、どのダンプ・レベルが親になるのかも判別します。
<P>ダンプ・レベルには <I>有効期限</I> を設定して、このレベルで作成されたダンプの有効期限を定義することができます。磁気テープが属しているダンプ・セットのダンプがすべて有効期限切れになるまで、バックアップ・システムは磁気テープの上書き要求を拒否します。したがって、有効期限を割り当てると、磁気テープの再利用方法が自動的に決まります。有効期限は、絶対値 (たとえば、2000 年 1月 13 日) で設定することも、相対値 (たとえば、ダンプ作成後 30 日) で設定することもできます。また、ダンプ・レベルに関連する有効期限を変更することもできます
(ただし、そのレベルですでに作成された、実際のダンプの有効期限は変更できません)。
<P>ダンプ階層の作成方法、有効期限の設定方法、および磁気テープの再利用方法については、
<A HREF="#HDRWQ367">ダンプ階層の定義および表示</A> を参照してください。
<A NAME="IDX6822"></A>
<A NAME="IDX6823"></A>
<A NAME="IDX6824"></A>
<A NAME="IDX6825"></A>
<A NAME="IDX6826"></A>
<A NAME="IDX6827"></A>
<P><H3><A NAME="HDRWQ353" HREF="auagd002.htm#ToC_276">ダンプ名および磁気テープ名</A></H3>
<P>ダンプを作成すると、バックアップ・システムは、そのダンプのレコードをバックアップ・データベースに作成します。このレコードには、ボリューム・セットの名前とダンプ・レベルのパス名の最後の要素を組み合わせた名前が割り当てられます。名前の形式は次のとおりです。
<PRE>      <VAR>volume_set_name</VAR><B>.</B><VAR>dump_level_name</VAR>
</PRE>
<P>たとえば、ボリューム・セット <B>user</B> をダンプ・レベル <B>/sunday/friday</B> で作成すると、
<B>user.friday</B> という名前になります。また、バックアップ・システムは、固有の <I>ダンプ
ID</I> 番号をダンプに割り当て、同じ名前のダンプと区別できるようにします。
<P>また、バックアップ・システムは、ダンプ・セットのある磁気テープに <I>AFS 磁気テープ名</I> を割り当てます。この名前は、ダンプ・セットの初期ダンプのボリューム・セットおよびダンプ・レベル、ダンプ・セット内での磁気テープの位置、および固有のダンプ ID 番号から構成されます。名前の形式は、次のとおりです。
<PRE>   <VAR>volume_set_name</VAR><B>.</B><VAR>dump_level_name</VAR><B>.</B><VAR>tape_index</VAR> (<VAR>dump ID</VAR>)
</PRE>
<P>たとえば、初期ダンプがダンプ・レベル <B>/sunday/friday</B> のボリューム・セット <B>uservol</B> であるダンプ・セットの 2 番目のテープは、<B>uservol.friday.2</B> (<B>914382400</B>) のようになります。
<P>その AFS 磁気テープ名に加えて、磁気テープは任意でユーザーが指定した
<I>永続名</I> をもつことができます。AFS 磁気テープ名とは異なり、永続名は、最初の(またはほかの)ダンプのボリューム・セットやダンプ・レベルを示す必要がないので、磁気テープの内容に従って変わることはありません。バックアップ・システムでは永続名に特定の形式を必要としないため、テープ名がそれぞれ固有のものであることを確認しなくてはなりません。磁気テープに永続名が付いていると、バックアップ・システムは、プロンプトや <B>backup</B> コマンドの出力で AFS 磁気テープ名ではなく永続名を使用しますが、この場合でも AFS 磁気テープ名を内部に記録します。
<P><H3><A NAME="HDRWQ354" HREF="auagd002.htm#ToC_277">磁気テープ・ラベル、ダンプ・ラベル、および EOF マーカー</A></H3>
<A NAME="IDX6828"></A>
<A NAME="IDX6829"></A>
<A NAME="IDX6830"></A>
<A NAME="IDX6831"></A>
<P>バックアップ・システムで使用される磁気テープはどれも、先頭に、磁気テープ名、容量、およびその他の情報を記録するための磁気ラベルが付いています。
<B>backup labeltape</B> コマンドを使用すると、ラベルを自分で作成することができたり、<B>backup
dump</B> コマンドを使用すれば、ラベルなしの磁気テープを使用する場合には自動的にラベルが作成されます。ラベルは、以下のような情報をレコードします。
<UL>
<LI>磁気テープの永続名は、<B>-pname</B> 引き数を
<B>backup labeltape</B> コマンドに使用することで割り当てられます。これは、32 文字までの任意の文字列になります。永続名を割り当てないと、
<B>backup dump</B> コマンドを使用して AFS テープ名を割り当てたりするときや、
<B>backup labeltape</B> コマンドを使用してダンプをテープに書き出すときに、バックアップ・システムが値 <TT>&lt;NULL></TT> を記録します。
</LI><LI>テープの AFS <I>テープ名</I> は、
3 種類の値のうちの 1 つになります。
<UL>
<LI>ダンプ・セットの初期ダンプのボリューム・セットおよびダンプ・レベル、ならびにそのダンプ・セットの一連の磁気テープ内における磁気テープの位置を表す名前。
<A HREF="#HDRWQ353">ダンプ名および磁気テープ名</A> に説明があります。磁気テープが永続名を指定されていない場合には、<B>-name</B> 引き数を <B>backup labeltape</B> コマンドに使用して、
AFS 磁気テープ名を割り当てることができます。
</LI><LI><TT>&lt;NULL></TT> 値。これは、永続名を割り当てる、または <B>backup labeltape</B> コマンドの <B>-name</B> 引き数へ値が与えられない時の結果です。
</LI><LI>AFS 磁気テープ名がまったくない。これは、テープにラベルを付けていなかったり、そこにダンプを書き込んでいないことを示しています。
</LI></UL>
<P>
<P>ダンプを書き込む時に磁気テープにまだ実際の AFS 磁気テープ名が付けられていない場合、バックアップ・システムは、適切な AFS 磁気テープ名を調べてレコードします。磁気テープに AFS 磁気テープ名を付けずに、初期ダンプを書き込む場合、ダンプのボリューム・セットおよびダンプ・レベルを正確に反映しなければなりません。
</LI><LI>テープの容量または <I>サイズ</I> に計測単位
(キロバイトの場合 <TT>k</TT>
または <TT>K</TT>、メガバイトの場合 <TT>m</TT> または <TT>M</TT>、ギガバイトの場合 <TT>g</TT> または <TT>G</TT>、またはテラバイトの場合 <TT>t</TT> または <TT>T</TT>) を示す文字を続けます。磁気テープの製造元が磁気テープの容量を決定します。バックアップ・システムの容量フィールドの値の使用方法の詳細については、
<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
</LI></UL>
<P>ラベル付きテープに関する情報については、<A HREF="#HDRWQ372">テープ・ラベルの書き込みおよび読み取り</A> を参照してください。
<P>磁気テープ・ラベルに加えて、バックアップ・システムは追加されたダンプ (磁気テープ・ラベルとダンプ・ラベルは最初のダンプの場合には同じです) ごとに、テープの<I>ダンプ・ラベル</I> を書き込みます。ダンプ・ラベルは、以下のような情報をレコードします。
<UL>
<LI>ダンプが書き込まれた磁気テープの名前。
</LI><LI>ダンプ操作が開始した日時。
</LI><LI>ダンプ内のボリュームが属するセル。
</LI><LI>キロバイトによるダンプ・サイズ。
</LI><LI>ダンプのダンプ・レベル。
</LI><LI>ダンプのダンプ ID。
</LI></UL>
<P>バックアップ・システムは、<I>ファイル・マーク</I> (ファイル終わりまたは EOF マーカーとも呼ばれています)
をダンプの各ボリュームからのデータ間に書き込みます。磁気テープ装置の製造者がファイル・マークのサイズを決めています。これは一般に 2 KB および 2 MB で、装置が使用する磁気テープの普段の容量よりも大きく、ファイル・マーク・サイズよりも大きく設定されています。ダンプの中に、たくさんのボリュームのそれぞれからのデータが少量ずつ入っている場合には、増分ダンプがしばしば行うように、ファイル・マーク・サイズによって、磁気テープにボリューム・データが収まる量に大きな影響を与えることがあります。バックアップ・システムがダンプを書き込むときにファイル・マーク・サイズを計算できるように、構成ファイルにファイル・マークのサイズを記録しておくことができます。詳細については、<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
<P><H3><A NAME="HDRWQ355" HREF="auagd002.htm#ToC_278">テープ・コーディネーター・マシン、ポート・オフセット、およびバックアップ・データ・ファイル</A></H3>
<A NAME="IDX6832"></A>
<A NAME="IDX6833"></A>
<A NAME="IDX6834"></A>
<A NAME="IDX6835"></A>
<P><I>磁気テープ・コーディネーター</I> は、バックアップ操作で使用された 1 つ以上付加された磁気テープ装置を動かすマシンです。これは、AFS クライアント・ソフトウェア (キャッシュ・マネージャー) を実行しますが、コンソールへの認証されていないアクセスを防止する物理的セキュア・ロケーションに常に配置するようにします。バックアップ操作が磁気テープ・コーディネーター・マシンで実行できるようにするためには、その前に、マシン上の各磁気テープ装置をバックアップ・データベースに登録して、いくつかのファイルとディレクトリーをマシンのローカル・ディスクに作成しなければなりません。方法については、<A HREF="#HDRWQ362">磁気テープ・コーディネーター・マシンを構成するには</A> を参照してください。
<P>テープ・コーディネーター・マシンの各磁気テープ装置は、異なる UNIX ポートでのバックアップ要求を確認します。<I>ポート・オフセット番号</I> を磁気テープ装置に割り当てることで間接的にポートを選出します。バックアップ・システムは、ポート・オフセットから内部的に判別するための基本ポート番号を加算することで装置の実際のポートを設定します。ポート・オフセット番号の割り当て命令については、<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
<P>磁気テープ装置がバックアップ操作を実行するためには、装置専用のバックアップ磁気テープ・コーディネーター (<B>butc</B>)処理が、磁気テープ・コーディネーター・マシン上で実行していなければなりません。それから、そのポート・オフセット番号を <B>backup</B> コマンドの<B>-portoffset</B> 引き数で指定することによって、バックアップ要求を装置の磁気テープ・コーディネーターに送ります。
<P>バックアップ・データの書き込みはテープだけではなく、テープ・コーディネーター・マシンのローカル・ディスクにある<I>バックアップ・データ・テープ</I>に行うことができます。それからユーザーは、データを階層記憶管理 (HSM) システムなどのデータ保存システムに転送することができます。このシステムは AFS およびバックアップ・システムと一緒に使用します。バックアップ・データ・ファイルは、磁気テープ装置と同様にポート・オフセットがあります。バックアップ・データ・ファイルの構成についての説明は、
<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください。
<P><H3><A NAME="HDRWQ356" HREF="auagd002.htm#ToC_279">バックアップ・データベースおよびバックアップ・サーバー・プロセス</A></H3>
<A NAME="IDX6836"></A>
<A NAME="IDX6837"></A>
<P><I>バックアップ・データベース</I> は、セルのデータベース・サーバー・マシンの <I>Backup Server</I> プロセスで保守を行う複写された管理データベースです。ほかの AFS データベース・サーバー処理と同様に、バックアップ・サーバーは Ubik ユーティリティーを使用して、同期化されるデータベースのさまざまなコピーを保持することができます。
(Ubik の説明については、<A HREF="auagd007.htm#HDRWQ68">AFS 管理データベースの複写</A> を参照してください。)
<P>バックアップ・データベースは、次のような情報を記録します。
<UL>
<LI>バックアップ操作で使用される各磁気テープ装置の磁気テープ・コーディネーター・マシンのホスト名およびポート・オフセット番号。
</LI><LI>ダンプ階層 (このコンポーネント・ダンプ・レベル、およびこれらに関連した有効期限から構成)。
</LI><LI>ボリューム・セットおよびこれらのコンポーネント・ボリューム項目。
</LI><LI>各ダンプのレコード。各磁気テープの名前、データが含まれているボリュームの名前、ダンプ・レベル、有効期限、ダンプに関連付けられている初期ダンプのダンプ ID、などの情報が記録されています。
</LI><LI>ダンプ・データを収納する各磁気テープのレコード。
</LI></UL>
<P><H3><A NAME="Header_280" HREF="auagd002.htm#ToC_280">バックアップ・システムへのインターフェース</A></H3>
<P>コマンドの <B>backup</B> セットは、バックアップ・システムへの管理インターフェースです。任意の AFS クライアントまたはサーバーのコマンド・シェルで、アクセス可能な <B>backup</B>
バイナリーからのコマンドを発行できます (または、シェル・スクリプトでこれらを呼び出せます)。一般的な構成では、バイナリーは常にローカル・ディスクにあります。
<P><B>backup</B> コマンド・スイートは、バックアップ・サーバーおよびボリューム・ロケーション (VL) サーバーへの持続接続に関する複数のコマンドを発行できる、
<I>対話モード</I> を提供します。対話モードでは、次のように便利な機能が用意されています。
<UL>
<LI>操作コードを入力するだけで、最初の <B>backup</B> という文字は入力する必要はありません。
</LI><LI>対話モードに入るときに指定した AFS ID または外部セルが、後続のすべてのコマンドに適用されます。
</LI><LI>シェルのメタ文字を二重引用符で囲む必要がありません。
</LI><LI><B>(backup) jobs</B> コマンドを使用して、現在の操作および保留中の操作を記録することができます。このコマンドは、対話モードでのみ使用することができます。
</LI><LI><B>(backup) kill</B> コマンドを使用して、現在の操作および保留中の操作を終了することができます。このコマンドは、対話モードでのみ使用することができます。
</LI></UL>
<P>磁気テープ (またはバックアップ・データ・ファイル) の読み取りまたは書き込みを必要とするコマンドを発行する前に、関連する磁気テープ装置 (またはローカル・ディスクにあるバックアップ・データ・ファイル) が接続している磁気テープ・コーディネーターとの接続をオープンし、
<B>butc</B> コマンドを発行して、磁気テープ・コーディネーター・プロセスを開始する必要があります。バックアップ操作で磁気テープ装置またはファイルを使用している間は、このプロセスの実行を継続し、接続をオープンにしておく必要があります。
<P>詳細については、<A HREF="auagd012.htm#HDRWQ402">バックアップ・システムのインターフェースの使用</A> を参照してください。
<HR><H2><A NAME="HDRWQ357" HREF="auagd002.htm#ToC_281">バックアップ・システム構成の概説</A></H2>
<A NAME="IDX6838"></A>
<P>バックアップ・システムを使用してデータをバックアップしたり、復元したりする前に、基本的なコンポーネントをいくつか構成しなければなりません。この章の機能グループでは、この構成作業について説明します。この章の内容は、次のとおりです。
<UL>
<LI>テープ容量およびテープ装置のファイル・マーク・サイズの判別、および <B>/usr/afs/backup/tapeconfig</B> ファイルへのこれらの記録
(<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照)
</LI><LI>バックアップ操作員に対する管理特権の許可 (<A HREF="#HDRWQ360">バックアップ操作への管理特権の許可</A> を参照)
</LI><LI>磁気テープ・コーディネーター・マシン、バックアップ、およびバックアップ・データ・ファイルの構成 (<A HREF="#HDRWQ361">テープ・コーディネーター・マシンおよびテープ装置の構成</A> を参照)
</LI><LI>ボリューム・セットおよびボリューム項目の定義 (<A HREF="#HDRWQ365">ボリューム・セットおよびボリューム項目の定義および表示</A>を参照)
</LI><LI>ダンプ階層を作成するダンプ・レベルの定義 (<A HREF="#HDRWQ367">ダンプ階層の定義および表示</A> を参照)
</LI><LI>磁気テープのラベル付け (<A HREF="#HDRWQ372">テープ・ラベルの書き込みおよび読み取り</A> を参照)
</LI><LI>バックアップ・プロセスを自動化する装置構成ファイルの作成
(<A HREF="#HDRWQ375">バックアップ処理の自動化およびその効率化</A> を参照)
</LI></UL>
<P>バックアップ・ダンプ、または復元操作の実行に必要なコンポーネントの構成がすべて終了している場合には、
<A HREF="auagd012.htm#HDRWQ412">データのバックアップ</A> および <A HREF="auagd012.htm#HDRWQ422">データの復元と回復</A> の指示に進んでください。
<HR><H2><A NAME="HDRWQ358" HREF="auagd002.htm#ToC_282">tapeconfig ファイルの構成</A></H2>
<A NAME="IDX6839"></A>
<A NAME="IDX6840"></A>
<A NAME="IDX6841"></A>
<A NAME="IDX6842"></A>
<A NAME="IDX6843"></A>
<P>テープ・コーディネーターがテープに書き込むデータ量を決定するには、いくつかの要因が関連しています。
<UL>
<LI>磁気テープの容量 (サイズ)、磁気テープ製造元で設定します。
</LI><LI>磁気テープ装置のファイル・マーク・サイズ、磁気テープ装置製造元で設定します。
<A HREF="#HDRWQ354">磁気テープ・ラベル、ダンプ・ラベル、および EOF マーカー</A> で説明したように、磁気テープ・コーディネーターは、ダンプの各ボリューム・データの境界にファイル・マークを書き込みます。ダンプの中に、たくさんのボリュームのそれぞれからのデータが少量ずつ入っている場合には、増分ダンプがしばしば行うように、ファイル・マーク・サイズによって、磁気テープにボリューム・データが収まる量に大きな影響を与えることがあります。
</LI><LI>磁気テープ装置の圧縮方式を使用するかどうか。
</LI></UL>
<P>(バックアップ・データ・ファイルに書き込まれるデータの量、区画で使用可能なスペースの量とオペレーティング・システムでの最大ファイル・サイズから判別することができます。磁気テープ・コーディネーターは、バックアップ・データ・ファイルへ書き込む時はファイル・マークを書き込みません。バックアップ・データ・ファイルを書き込む場合のテープ・コーディネーターの構成方法については、
<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください。)
<P>磁気テープ・コーディネーター (<B>butc</B>) プロセスが初期化されると、ローカル・ディスクにある <B>/usr/afs/backup/tapeconfig</B> ファイルから、ダンプ操作に使用する磁気テープの容量およびファイル・マークのサイズ (磁気テープの場合)
またはファイル・サイズ (バックアップ・データ・ファイルの場合) が読み取られます。また、ダンプ操作を始めると、磁気テープ・コーディネーターは、磁気テープまたはバックアップ・データ・ファイルのラベルを読み取り、磁気テープの容量またはファイル・サイズが一致しているかどうか確認します。値が異なる場合には、ラベルの値が <B>tapeconfig</B> ファイルにあるデフォルト値で上書きされます。
<P>ダンプ操作時で、磁気テープ・コーディネーターが磁気テープにデータを書き込むときに、この容量とファイル・マークの情報を使用して、テープの使用量とテープの終わりまでの物理的な残量を計算します。
EOT に達する直前に、磁気テープ・コーディネーターは書き込み操作を停止し、新しい磁気テープを要求します。同様に、バックアップ・データ・ファイルのサイズを使用して、ファイルの占有しているスペースを計算します。テープ・コーディネーターが EOT に予想外の到達をしたら、新規のテープを手に入れて、EOT を検出したボリュームの内容をすべて書き込みます。中断されたボリュームは最初のボリュームに残りますが、使用することはできません。
<P>多くのテープ装置では、特に装置の圧縮モードを使用する場合、複数ギガバイト、または複数テラバイトのバックアップ・データを収容可能なテープを使用します。このような装置およびテープに書き込む場合は、テープ・コーディネーターが予期しない EOT を検出するようにすることを一般にお勧めします。装置のデータ書き込みが高速なため、新規テープに割り込みボリュームを再度書き込むのはそれほど時間がかかりません。同様にデータ圧縮の効率がよいため、最初のテープで中止された割り込みボリュームのデータは、テープの多くを消費するものではありません。
<P>少量のデータ (たとえば 2 GB 以下) を収容するテープに書き込む場合は、テープ・コーディネーターが予期しない EOT を検出しないようにする方がよいでしょう。
AFS は 2 GB までのサイズのボリュームをサポートするため、割り込まれたボリュームは実際にテープのほとんどを使用してしまいます。このようなテープでは、テープの容量とファイル・マークのサイズを正確に記録しておくと、テープを有効に使用し、ダンプ操作を効率よく行うことができます。
<B>tapeconfig</B> ファイルのフィールドについて、適切な値の決め方を以下に説明します。
<P>磁気テープ・コーディネーターが使用する磁気テープ装置またはバックアップ・データ・ファイルは、テキスト・エディターを使用して、磁気テープ・コーディネーターの <B>tapeconfig</B> ファイルに記述してください。次のような形式で、装置またはファイルごとに 1 行にまとめて記述してください。
<PRE>   [<VAR>capacity</VAR>   <VAR>filemark_size</VAR>]    <VAR>device_name</VAR>    <VAR>port_offset</VAR>
</PRE>
<P>ここで、
<DL>
<P><DT><B><VAR>capacity</VAR>
</B><DD>磁気テープ装置で使用される磁気テープの容量、またはバックアップ・データ・ファイルに書き込まれる総データ量を指定します。整数値の後に単位を示す文字を指定してください。数値と文字の間にはスペースを入れないでください。<B>k</B> または <B>K</B> はキロバイトを、<B>m</B> または <B>M</B> はメガバイトを、<B>g</B> または <B>G</B> はギガバイトを、および <B>t</B> または <B>T</B> はテラバイトを示します。単位を省略すると、デフォルトで K バイトが使用されます。
<P>
<P>通常モード (非圧縮モード) で使用するサイズが 2 GB 以下の磁気テープの容量を計算する場合には、磁気テープの製造元が指定する値 (磁気テープのパッケージに記載されています) を調べるか、あるいは <B>fms</B> コマンドを使用して容量を計算してください。このコマンドについては、この機能グループの後半で説明します。磁気テープ・コーディネーターが予期しない EOT を検出しないように、磁気テープの実際の容量より 10% ほど少ない値を <B>tapeconfig</B> ファイルまたはラベルに記録してください。小容量のテープを圧縮モードで使用する場合の適切な値を計算する方法として、テープ容量 (製造者が記録) に装置の圧縮比率をかける方法があります。
<P>
<P>数ギガバイトまたはテラバイトのデータを収容するテープの場合、あるいはテープ装置の圧縮モードを使用する場合は、テープの最大容量よりも大きい値 (たとえば 2 倍) を記録するような構成が推奨されます。一般に大容量のテープでは、非圧縮モードでも <B>fms</B> コマンドの実行は意味がありません。このコマンドは、圧縮モードの場合、正確な結果を得ることができません。磁気テープ・コーディネーターが予期しない EOT を検出することはまずありませんが、圧縮モードの場合、ボリュームが割り込まれて破棄されたデータもあるので、磁気テープ上のデータ量と磁気テープの使用率が必ずしも一致するわけではありません。
<P>
<P>バックアップ・データ・ファイルの場合、区画で使用可能なスペースよりも少し小さく、オペレーティング・システムの最大ファイル・サイズより小さい値を記録してください。他のプロセスが区画に書き込む量を制限して、区画内のスペースがなくならないようにすることもできます。
<P>
<P>このフィールドが空の場合、テープ・コーディネーターは、最大許容値 (2048 GB または 2 TB) を使用します。このフィールドと <VAR>filemark_size</VAR> フィールドを両方とも空にしておくか、または両方のフィールドに値を入力します。
<P><DT><B><VAR>filemark_size</VAR>
</B><DD>磁気テープ装置のファイル・マーク・サイズを指定します。通常、2KB から 2MB までの値です。
<VAR>capacity</VAR> フィールドと同じ表記を使用しますが、デフォルトの単位は K バイトではなく、バイトです。
<P>
<P>通常 (非圧縮) モードの磁気テープ装置の場合、<B>fms</B> コマンドを使用してファイル・マーク・サイズを計算することができます。また、装置の製造元が指定している値を調べることもできます。磁気テープ・コーディネーターが予期しない EOT を検出しないように、
<B>tapeconfig</B> ファイルに記録するときに、10% ほど多めの値を記録してください。
<P>
<P>磁気テープ装置の圧縮方式における推奨値は、<B>0</B> (ゼロ) です。
<B>fms</B> コマンドは、圧縮方式では実際の結果をもたらさないので、ファイル・マーク・サイズの判別には使用できません。
<P>
<P>バックアップ・データ・ファイルの推奨値も、
<B>0</B> (ゼロ) です。テープ・コーディネーターは、ファイルの書き込み時にファイル・マークを使用しませんが、
<VAR>capacity</VAR> フィールドに値がある場合でも、このフィールドには値がなければいけません。
<P>
<P>このフィールドが空の場合、テープ・コーディネーターは、値 <B>0</B> (zero) を使用します。このフィールドと <VAR>capacity</VAR> フィールドを両方とも空にしておくか、または両方のフィールドに値を入力します。
<P><DT><B><VAR>device_name</VAR>
</B><DD>磁気テープ装置またはバックアップ・データ・ファイルの完全なパス名を指定します。磁気テープ装置名の形式はオペレーティング・システムに依存しますが、
UNIX システムの装置名は一般に
<B>/dev/</B> という文字列で始まります。バックアップ・データ・ファイルの場合、このフィールドには完全なパス名を定義しますが、バックアップ・データ・ファイル名の規則については、<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください。
<P><DT><B><VAR>port_offset</VAR>
</B><DD>特定の磁気テープ装置またはバックアップ・データ・ファイルのポート・オフセット番号を指定します。各テープ装置は、異なる UNIX ポートでバックアップ要求を listen します。このフィールドに値を指定すると、ポートを選択することができます。バックアップ・システムは、ポート・オフセットから内部的に判別するための基本ポート番号を加算することで装置の実際のポートを設定します。
<P>
<P>正式な値は、整数の <B>0</B> から <B>58510</B> までです (バックアップ・システムは、最大 58,511 ポート・オフセット番号を記録できます)。それぞれの値は、セルの磁気テープ・コーディネーターごとに固有でなければなりませんが、連続したポート・オフセット番号を割り当てる必要はなく、
1 つのマシンまたは同じように磁気テープ装置ごとに任意の番号を付けられます。たとえば、磁気テープ装置を圧縮および非圧縮の両方のモードで使用する場合には、2 つの異なるポート・オフセットを割り当て、それぞれのモードに適切な磁気テープ容量およびファイル・マーク・サイズを指定してください。
<P>
<P>バックアップ操作によく使用する磁気テープ装置またはバックアップ・データ・ファイルの磁気テープ・コーディネーターに、ポート・オフセット<B>0</B> (ゼロ) を割り当ててください。これにより、
<B>backup</B> コマンドの可能な最大番号から
<B>-portoffset</B> 引き数を省略することができます。
</DL>
<P>次の例では、<B>tapeconfig</B> ファイルに、2 つの磁気テープ装置
<B>/dev/rmt0h</B> および <B> /dev/rmt1h</B> が記述されています。この 2 つの装置では、容量が 2 GB、ファイル・マーク・サイズが 1 MB の磁気テープを使用しています。これらのポート・オフセット番号は、<TT>0</TT> および <TT>1</TT> になります。
<PRE>   2g 1m /dev/rmt0h 0
   2G 1M /dev/rmt1h 1
</PRE>
<P><B>fms</B> コマンドは、標準出力 (stdout) および現行作業ディレクトリーに書き込む <B>fms.log</B> ファイルの両方に、挿入された磁気テープの容量および磁気テープ装置のファイル・マーク・サイズをレポートします。コマンド・インタープリターは必ず、データをテープ全体へ書き込むので、コマンドは、磁気テープのサイズによりますが、数時間以上から 1 日で完了できます。
<P><H3><A NAME="HDRWQ359" HREF="auagd002.htm#ToC_283">非圧縮テープ装置における fms コマンドの実行</A></H3>
<A NAME="IDX6844"></A>
<A NAME="IDX6845"></A>
<A NAME="IDX6846"></A>
<A NAME="IDX6847"></A>
<A NAME="IDX6848"></A>
<OL TYPE=1>
<LI>既存の <B>fms.log</B> ファイルが現行ディレクトリーにない場合、現行ディレクトリーにファイルを挿入および書き込みが可能であることを検証します。既存のログ・ファイルがある場合、ファイルへ書き込む必要があります。
</LI><LI>磁気テープをドライブに挿入します。実行している完全なコマンドは磁気テープに上書きします。そして、ブランク磁気テープまたはリサイクルを必要とする磁気テープとして使用します。
</LI><LI><B>fms</B> コマンドを発行します。
<P>
<PRE>   % <B>fms</B> &lt;<VAR>tape special file</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>fms
</B><DD>完全な形式でタイプする必要があります。
<P><DT><B><VAR>tape special file</VAR>
</B><DD>磁気テープ装置の UNIX 装置名を、
<B>/dev/rmt0h</B>のよう指定します。
</DL>
</LI></OL>
<P>次の例では、容量が 2136604672 バイト (約 2 GB)、装置のファイル・マーク・サイズが 1910205 バイト (約 2 MB) の 装置 <B>/dev/rmt0h</B> の情報が出力されています。
<PRE>   % <B>fms /dev/rmt0h</B>
   wrote block: 130408
   Finished data capacity test - rewinding
   wrote 1109 blocks, 1109 file marks
   Finished file mark test
   Tape capacity is 2136604672 bytes
   File marks are 1910205 bytes
</PRE>
<HR><H2><A NAME="HDRWQ360" HREF="auagd002.htm#ToC_284">バックアップ操作への管理特権の許可</A></H2>
<P>セル内で <B>backup</B> および <B>butc</B> コマンドを発行するユーザーは、バックアップ・データベースおよびボリューム・ロケーション・データベース (VLDB) を格納している各データベース・サーバー・マシン、およびボリューム・セットのボリュームを所有しているマシンの <B>/usr/afs/etc/UserList</B> ファイルに記述されていなければなりません。規則として、セル内のすべてのサーバー・マシンに、同じ <B>UserList</B> ファイルがあります。本書では、ユーザーのセルが規約に従って構成されていることを前提にしています。
<B>UserList</B> ファイルを編集するには、
<A HREF="auagd021.htm#HDRWQ815">UserList ファイルの管理</A> で説明された <B>bos adduser</B> および <B>bos removeuser</B> コマンドを使用します。
<P><B>UserList</B> ファイル以外に、
<B>butc</B> コマンドを発行するバックアップ操作員は、各磁気テープ・コーディネーター・マシンのローカル <B>/usr/afs/backup</B> ディレクトリーにあるファイルに書き込み操作が許可されていなければなりません。このディレクトリーは、UNIX モード・ビットで保護されています。ユーザーのセルで最初の磁気テープ・コーディネーター・マシンを構成する前に、ディレクトリーとそのファイルの所有者にするローカル・ユーザーおよびグループを決めてください。使用可能な所有権オプションは、次のとおりです。
<UL>
<LI>ローカル・スーパーユーザー <B>root</B>。このオプションを使用すると、
<B>butc</B> コマンドの発行側は、ローカル・ファイル・システムにローカル・スーパーユーザー <B>root</B> としてログオンする必要があります。テープ・コーディネーターがサーバー・マシンでもある場合、
<B>butc</B> コマンドに <B>-localauth</B> フラグを使用し、ローカルの <B>/usr/afs/etc/KeyFile</B> ファイルからサーバー・チケットを構成します。サーバーではないマシンでは、発行者側は <B>klog</B> コマンドを発行して、
<B>root</B> としてログインし AFS 管理者として認証される必要があります。
</LI><LI>通常の AFS 管理者。AFS 修正ログイン・ユーティリティーを使用すると、ログインと認証を 1 回のステップで実行できます。テープ・コーディネーターを開始できるのは、管理者だけです。
</LI><LI>複数の操作員がパスワードを知っている管理アカウント。このオプションを使用すると、誰でも磁気テープ・コーディネーターを開始することができます。
</LI></UL>
<P>この他に、すべてのバックアップ操作員が所属するグループをローカル・グループ・ファイル
(<B> /etc/group</B> または同等のファイル) に定義するオプションがあります。この場合、
<B>/usr/afs/backup</B> ディレクトリーとそのファイルに対するユーザー・モード・ビットではなく、グループ・モード・ビットの <B>w</B> モード・ビット (<B>書き込み</B> 許可) をオンにしてください。他のオプションを比べて、このオプションを使用すると、各操作員が自分の管理アカウントを持つことができるので、細かく監査できるという利点があります。
<P>保護モードの選択方法またはインプリメントについては、
<A HREF="#HDRWQ361">テープ・コーディネーター・マシンおよびテープ装置の構成</A> を参照してください。
<HR><H2><A NAME="HDRWQ361" HREF="auagd002.htm#ToC_285">テープ・コーディネーター・マシンおよびテープ装置の構成</A></H2>
<A NAME="IDX6849"></A>
<A NAME="IDX6850"></A>
<A NAME="IDX6851"></A>
<A NAME="IDX6852"></A>
<P>この機能グループでは、磁気テープ・コーディネーター・マシンの構成方法、単一の磁気テープ装置またはバックアップ・データ・ファイルに関連付けられた磁気テープ・コーディネーターの構成または削除方法について説明します。
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">テープ装置が AIX システムに接続している場合には、テープ装置のテープ・ブロック・サイズを<B> 0</B> (ゼロ) に変更する必要があります。この値は、可変ブロック・サイズを意味します。ゼロに変更しないと、AIX システムで作成した磁気テープが、他のシステム・タイプのマシンに接続している装置で読み取れなくなります。AIX <B>smit</B> プログラムを使用すると、
<A HREF="#LIWQ363">3</A> のステップの説明のように、磁気テープ装置の磁気テープ・ブロック・サイズを調べたり、変更することができます。
</TD></TR></TABLE>
<P><H3><A NAME="HDRWQ362" HREF="auagd002.htm#ToC_286">磁気テープ・コーディネーター・マシンを構成するには</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><A NAME="LIWQ363"></A>装置の取扱説明書に従って、磁気テープ・コーディネーター・マシンに 1 台以上の磁気テープ装置を取り付けます。バックアップ・システムは、セル 1 つにつき、最大 58,511 の磁気テープ装置またはバックアップ・データ・ファイルを記録できます。
<P>
<P>テープ・コーディネーター・マシンが AIX システムの場合、以下のコマンドを発行して、テープ装置のテープ・ブロック・サイズを <B>0</B> (ゼロ) に変更します。それぞれの磁気テープ装置ごとに繰り返します。
<P>
<PRE>   # <B>chdev -l '</B><VAR>device_name</VAR><B>' -a block_size='0'</B>
</PRE>
<P>
<P><VAR>device_name</VAR> はテープ装置の装置名です (たとえば、<B>/dev/rmt0h</B>)。
</LI><LI>ローカルのディスクに、<B>backup</B>、
<B>butc</B>、および <B>fms</B> コマンドのバイナリー・ファイルがあるかどうか調べます。マシンが AFS クライアントの場合、通常の位置は <B>/usr/afsws/etc</B> ディレクトリーとなります。
<P>
<PRE>   # <B>ls /usr/afsws/etc</B>
</PRE>
</LI><LI><B>/usr/afs</B> ディレクトリーを作成します。(磁気テープ・コーディネーター・マシンがファイル・サーバー・マシンとしても構成されている場合には、このディレクトリーは既に作成されています。)
それから、<B>/usr/afs/backup</B> ディレクトリーを作成します。
<P>
<PRE>   # <B>mkdir /usr/afs</B>
   # <B>mkdir /usr/afs/backup</B>
</PRE>
</LI><LI>この <B>/usr/afs/backup/tapeconfig</B> ファイルを作成する場合には、テキスト・エディターを使用してください。磁気テープ装置またはバックアップ・データ・ファイルの情報を 1 行に記述してください。次の情報をこの順番で指定してください。構文の詳細および各フィールドの許容値については、
<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
<UL>
<LI>装置で使用する磁気テープの容量かバックアップ・データ・ファイルのサイズ。
</LI><LI>装置のファイル・マーク・サイズ。
</LI><LI>文字列 <B>/dev/</B> で始まる装置名。
</LI><LI>装置のポート・オフセット番号。
</LI></UL>
<A NAME="IDX6853"></A>
<A NAME="IDX6854"></A>
<A NAME="IDX6855"></A>
<A NAME="IDX6856"></A>
</LI><LI><B>/usr/afs/backup</B> ディレクトリーおよび <B>/usr/afs/backup/tapeconfig</B> ファイルの所有ユーザーおよび所有グループを決めます。
<A HREF="#HDRWQ360">バックアップ操作への管理特権の許可</A> を参照してください。必要であれば、ディレクトリーおよびファイルに対する
UNIX モード・ビットを訂正してください。
<P>
<PRE>   # <B>chown</B> <VAR>admin_owner</VAR> <B>/usr/afs/backup</B>
   # <B>chown</B> <VAR>admin_owner</VAR> <B>/usr/afs/backup/tapeconfig</B>
   # <B>chgrp</B> <VAR>admin_group</VAR> <B>/usr/afs/backup</B>
   # <B>chgrp</B> <VAR>admin_group</VAR> <B>/usr/afs/backup/tapeconfig</B>
   # <B>chmod 774 /usr/afs/backup</B>
   # <B>chmod 664 /usr/afs/backup/tapeconfig</B>
</PRE>
<A NAME="IDX6857"></A>
<A NAME="IDX6858"></A>
<A NAME="IDX6859"></A>
<A NAME="IDX6860"></A>
</LI><LI><A NAME="LICONFTC-ADDHOST"></A>バックアップ・データベースに磁気テープ・コーディネーターの項目を作成する <B>backup addhost</B> コマンドを発行します。それぞれのテープ・コーディネーターごとにコマンドを繰り返します。
<P>
<PRE>   # <B>backup addhost</B> &lt;<VAR>tape machine name</VAR>> [&lt;<VAR>TC port offset</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addh
</B><DD><B>addhost</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>tape machine name</VAR>
</B><DD>テープ・コーディネーター・マシンの完全修飾されたホスト名を指定します。
<P><DT><B><VAR>TC port offset</VAR>
</B><DD>磁気テープ装置のポート・オフセット番号を指定します。
<B>tapeconfig</B> ファイルで装置に指定したものと同じ値を指定してください。デフォルト値の 0 (ゼロ) が適切でない場合には、この引き数を指定しなければなりません。
</DL>
</LI></OL>
<P><H3><A NAME="Header_287" HREF="auagd002.htm#ToC_287">既存のテープ・コーディネーター・マシンにテープ・コーディネーターを追加するには</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>装置の取扱説明書に従って、磁気テープ・コーディネーター・マシンに磁気テープ装置を取り付けます。
<P>
<P>テープ・コーディネーター・マシンが AIX システムの場合、以下のコマンドを発行して、テープ装置のテープ・ブロック・サイズを <B>0</B> (ゼロ) に変更します。
<P>
<PRE>   # <B>chdev -l '</B><VAR>device_name</VAR><B>' -a block_size='0'</B>
</PRE>
</LI><LI>磁気テープ装置に割り当てるポート・オフセット番号を選択します。必要であれば、<B>backup listhosts</B> コマンドを使用して、使用済みのポート・オフセット番号を調べてください。この出力については、<A HREF="#HDRWQ364">構成済みの磁気テープ・コーディネーターのリストを表示するには</A> を参照してください。
<P>
<PRE>   # <B>backup listhosts</B>
</PRE>
<P>
<P><B>listh</B> は、<B>listhosts</B> の受け入れ可能な最も短い省略形です。
</LI><LI>この <B>/usr/afs/backup/tapeconfig</B> ファイルに装置の 1 つ以上の項目を追加する場合には、テキスト・エディターを使用してください。次の情報をこの順番で指定してください。構文の詳細および各フィールドの許容値については、
<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
<UL>
<LI>装置で使用する磁気テープの容量かバックアップ・データ・ファイルのサイズ。
</LI><LI>装置のファイル・マーク・サイズ。
</LI><LI>文字列 <B>/dev/</B> で始まる装置名。
</LI><LI>装置のポート・オフセット番号。
</LI></UL>
</LI><LI><B>backup addhost</B> コマンドを発行して、磁気テープ・コーディネーターのバックアップ・データベースに項目を作成してください。完全な構文については、
<A HREF="#HDRWQ362">磁気テープ・コーディネーター・マシンを構成するには</A> 内の <A HREF="#LICONFTC-ADDHOST">8</A> のステップを参照してください。
<PRE>   # <B>backup addhost</B> &lt;<VAR>tape machine name</VAR>> [&lt;<VAR>TC port offset</VAR>>]
</PRE>
</LI></OL>
<A NAME="IDX6861"></A>
<A NAME="IDX6862"></A>
<A NAME="IDX6863"></A>
<A NAME="IDX6864"></A>
<P><H3><A NAME="Header_288" HREF="auagd002.htm#ToC_288">磁気テープ・コーディネーターの構成を削除するには</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>テキスト・エディターを使用して、
<B>/usr/afs/backup/tapeconfig</B> ファイルから各磁気テープ・コーディネーターの項目を削除します。
</LI><LI><B>backup delhost</B> コマンドを発行して、バックアップ・データベースから磁気テープ・コーディネーターの項目を削除します。
<P>
<PRE>   % <B>backup delhost</B> &lt;<VAR>tape machine name</VAR>> [&lt;<VAR>TC port offset</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>delh
</B><DD>は、<B>delhost</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>tape machine name</VAR>
</B><DD>磁気テープ・コーディネーター・マシンの完全インターネット・ホスト名です。
<P><DT><B><VAR>TC port offset</VAR>
</B><DD><B>tapeconfig</B> ファイルから削除するポート・オフセット番号です。デフォルト値の <B>0</B> (ゼロ) が適切でない場合には、この引き数を指定しなければなりません。
</DL>
</LI></OL>
<A NAME="IDX6865"></A>
<A NAME="IDX6866"></A>
<A NAME="IDX6867"></A>
<A NAME="IDX6868"></A>
<P><H3><A NAME="HDRWQ364" HREF="auagd002.htm#ToC_289">構成済みの磁気テープ・コーディネーターのリストを表示するには</A></H3>
<OL TYPE=1>
<LI><B>backup listhosts</B> コマンドを発行して、現在バックアップ・データベースに構成されている磁気テープ・コーディネーターおよびポート・オフセット番号を表示します。
<P>
<PRE>   % <B>backup listhosts</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listh
</B><DD><B>listhosts</B> の受け入れ可能な最も短い省略形です。
</DL>
</LI></OL>
<P>コマンドの出力には、現在バックアップ・データベースに記録されている磁気テープ・コーディネーターとそのポート・オフセット番号が表示されます。ポート・オフセット番号が表示されても、関連する磁気テープ・コーディネーターが実行されているとは限りません。マシン名は、<B>backup addhost</B> コマンドに指定した形式で表示されます。
<P>次の例は、
Example Corporation セルのバックアップ・データベースに現在定義されている磁気テープ・コーディネーターを表示しています。
<PRE>   % <B>backup listhosts</B>
   Tape hosts:
       Host backup1.example.com, port offset 0
       Host backup1.example.com, port offset 2
       Host backup2.example.com, port offset 1
       Host backup2.example.com, port offset 3
</PRE>
<HR><H2><A NAME="HDRWQ365" HREF="auagd002.htm#ToC_290">ボリューム・セットおよびボリューム項目の定義および表示</A></H2>
<P>バックアップ・システムは、個々のファイル単位ではなく、ボリューム単位でデータを処理します。バックアップ操作を実行する前に、<B>backup addvolset</B> コマンドを使って<I>ボリューム・セット</I> というボリュームのグループを定義する必要があります。ボリューム・セットには、最大 31 文字までの名前を付けることができます。名前には、ピリオド (<B> .</B>) を除くすべての文字を使用することができます。シェルに対して特殊な意味を持つメタ文字は使用しないようにしてください。
<P>ボリューム・セットを作成したら、
<B>backup addvolentry</B> コマンドを使って、
1 つまたは複数の<I>ボリューム項目</I> を、その中に配置します。ボリューム項目は、そのボリューム・セットに属すボリュームの、位置 (ファイル・サーバー・マシンと区画) および名前を定義します。コマンドに必須の <B>-server</B> 引き数を使用して、対象のボリュームを置くファイル・サーバー・マシンを指定し、さらに必須の <B>-partition</B> 引き数を使用して、その区画を指定します。2 種類の値が使用可能です。
<UL>
<LI>マシンの完全修飾ホスト名、または区画の完全名
(<B>/vicepm</B> など)。
</LI><LI>正規表現 <B>.*</B> (ピリオドとアスタリスク )。これは、VLDB のすべてのマシン名または区画名に一致します。
</LI></UL>
<P>ボリューム名 (必須の <B>-volume</B> 引き数) の場合は、英数字と 1 つまたは複数のメタ文字を組み合わせて指定し、ボリューム名の一部またはすべてをワイルドカードで指定します。ボリューム名フィールドでは、次のメタ文字を組み合わせて使用することができます。
<A NAME="IDX6869"></A>
<A NAME="IDX6870"></A>
<DL>
<P><DT><B>.
</B><DD>ピリオドは、単一文字に一致します。
<P><DT><B>*
</B><DD>アスタリスクは、直前の文字の 0 回以上の繰り返しに一致します。これは、他の英数字またはメタ文字を組み合わせて使用することができます。
<P><DT><B>[ ]
</B><DD>文字のリストを大括弧で囲むと、そのいずれかの 1 文字に一致します。たとえば、<B>[abc]</B> は、<B>a</B>、
<B>b</B>、<B>c</B> のいずれか 1 文字に一致し、
<B>d</B> や <B>A</B> には一致しません。この式はアスタリスクと組み合わせることができます。
<P><DT><B>^
</B><DD>大括弧のセットの先頭文字として脱字記号を使用すると、この記号の直後の文字以外の任意の一文字に一致します。たとえば、
<B>[^a]</B> は、<B>a</B> の小文字以外の任意の一文字に一致します。この式はアスタリスクと組み合わせることができます。
<P><DT><B>\
</B><DD>このリストでメタ文字の直前に円記号を付けると、そのメタ文字自身に一致します。たとえば、式 <B>\.</B> (円記号とピリオド) は、ピリオド 1 つに一致し、<B>\*</B> はアスタリスク 1 つ、<B>\\</B> は円記号 1 つにそれぞれ一致します。これらの式はアスタリスクと一緒に使用することができます (たとえば、<B>\.*</B> は、任意の数のピリオドに一致します。)
</DL>
<P>最も一般的な正規表現は、ピリオドの後にアスタリスクが続く式
(<B>.*</B>) です。ピリオドは任意の一文字に一致し、アスタリスクは直前の文字の任意の繰り返しに一致するので、この式は、任意の長さの文字列に一致します。前述のように、ボリューム項目のファイル・サーバー・フィールドおよび区画フィールドで使用できる正規表現はこれだけです。ボリューム名フィールドでは、これらの文字は単独で使用するか (この場合、VLDB にリストされている任意のボリュームに一致します)、あるいは英数字と一緒に使用することができます。たとえば、
<B>user.*\.backup</B> という文字列は、
<B>user</B> で始まり、<B>.backup</B> で終了する任意のボリューム名に一致します。
<P>対話モードで <B>backup addvolentry</B> を発行するのが最も簡単な方法です。シェル・プロンプトで発行する場合には、正規表現を含むすべての文字列を、二重引用符 (<B>" "</B>) で囲む必要があります。そうすることで、シェルは、それらを解決せずに、未解釈のまま <B>backup</B> インタープリターに渡します。
<P>いくつかのボリュームを組み合わせて定義する場合には、
<B>backup addvolentry</B> コマンドの 3 つの引き数に次のタイプの値を指定してください。このリストでは、対話モードでの表記を使用しています。このコマンドをシェル・プロンプトで発行する場合には、正規表現を含む文字列全体を二重引用符で囲んでください。ボリュームの指定方法は次のとおりです。
<UL>
<LI>VLDB にあるすべてのボリュームを指定する場合には、
3 つの引き数すべてに正規表現 <B>.*</B> を使用してください
(<B>-server .* -partition .* -volume .*</B>)。
</LI><LI>特定のファイル・サーバー・マシン上のすべてのボリュームを指定する場合には、
<B>-server</B> 引き数に完全修飾ホスト名を指定し、
<B>-partition</B> および
<B>-volume</B> 引き数には正規表現 <B>.*</B> を使用してください (たとえば、<B>-server fs1.example.com -partition .* -volume .*</B>)。
</LI><LI>いろいろなファイル・サーバー・マシンの同じ名前の区画にあるすべてのボリュームを指定する場合には、
<B> -partition</B> 引き数に区画の完全名を指定し、
<B>-server</B> および
<B>-volume</B> 引き数には正規表現
<B>.*</B> を使用してください (たとえば、
<B>-server .* -partition /vicepd -volume .*</B>)。
</LI><LI>名前に共通の文字列を含むボリュームを指定する場合には、
<B>-server</B> および <B>-partition</B> 引き数に正規表現 <B> .*</B> を使用し、
<B>-volume</B> 引き数には英数字とメタ文字を組み合わせて指定してください。
(たとえば、名前に <B>.backup</B>
という文字列を含むボリュームの場合には、<B>-server .* -partition .* -volume .*\.backup</B> と指定します。)
</LI><LI>1 つの区画にあるすべてのボリュームを指定する場合には、
<B>-server</B> 引き数にマシンの完全修飾ホスト名を、
<B>-partition</B> 引き数に完全な区画名を指定し、
<B>-volume</B> 引き数に正規表現 <B>.*</B> を使用してください (たとえば、<B>-server fs2.example.com -partition /vicepb -volume .*</B>)。
</LI><LI>単一のボリュームを指定する場合には、<B>-volume</B> 引き数に完全なボリューム名を指定してください。VLDB から項目を検索するときの検索時間を短くするために、
<B>-server</B> および <B>-partition</B> 引き数に実際のマシン名と実際の区画名をそれぞれ指定することができます。ただし、後でボリュームを移動する可能性もあるので、マシン名と区画名には正規表現 <B>.*</B> を使用したほうが有効です。
</LI></UL>
<P>ボリューム・セットを作成したら、ボリュームのグループを定義します。このグループのボリュームは、同じ磁気テープ、同じ時間 (たとえば、毎週または毎日)、および同じ方法 (フルまたは増分) でダンプされます。一般に、同じロケーションを共有するボリュームからボリューム・セットを構成するよりも、名前などから内容が類似したボリュームから構成したほうが有効です。負荷分散やスペース上の問題から、ボリュームを頻繁に移動する場合には特にそうです。また、
<B>backup addvolentry</B> コマンドの
<B>-server</B> および <B>-partition</B>
引き数には、正規表現 <B>.*</B> を使用すると有効です。
<P>一般に、ボリューム項目に入れるボリューム数を限定したほうが効果的です。ボリューム数が非常に多いボリューム・セットをダンプすると、完了までに長い時間がかかり、サービス割り込みやシステムの停止などで操作が失敗する可能性が高くなります。
<P>ボリューム・セットからボリューム項目を消去するには、<B>backup delvolentry</B> コマンドを使用します。ボリューム・セットとそのコンポーネント・ボリューム項目のすべてをバックアップ・データベースから消去するには、
<B>backup delvolset</B> コマンドを使用します。ボリューム・セット内のボリューム項目を表示するには、<B>backup
listvolsets</B> コマンドを使用します。
<P>デフォルトでは、新規のボリューム・セット用に、バックアップ・データベース・レコードが作成されます。しかし、ボリューム・セットを、バックアップ・データベースに永続的に記録しないように作成する方がいい場合もあります。たとえば、<B>backup volsetrestore</B> コマンドを使って、一緒にバックアップされたとは限らないボリュームのグループをリストアする場合などです
(詳しくは、<A HREF="auagd012.htm#HDRWQ428">backup volsetrestore コマンドの使用</A> を参照してください)。
<I>一時</I> ボリューム・セットを作成するには、
<B>backup addvolset</B> コマンドに <B>-temporary</B> フラグを指定してください。一時ボリューム・セットは、現行の対話式セッションが存続する間のみ存在します。したがって、このフラグは、
<B>backup (interactive)</B> コマンドによってオープンされた対話式セッションで使用される間のみ有効です。
<B>backup delvolset</B> コマンドを使って対話式セッションが終了する前に一時ボリューム・セットを削除することもできますが、上述のように、セッションの終了時には自動的に削除されます。一時ボリューム・セットの利点の 1 つは、
<B>backup addvolset</B> コマンドです。また、それ以降に使用される <B>backup addvolentry</B> コマンドは、ボリューム項目を追加し、バックアップ・データベース・レコードが作成しないため、通常のボリューム・セットよりも速く完了します。
<A NAME="IDX6871"></A>
<A NAME="IDX6872"></A>
<A NAME="IDX6873"></A>
<A NAME="IDX6874"></A>
<P><H3><A NAME="Header_291" HREF="auagd002.htm#ToC_291">ボリューム・セットの作成</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>(オプション)</B> <B>backup</B> コマンドを発行して、対話モードに入ります。
<B>backup addvolentry</B> コマンドを使ってすぐにボリューム項目を定義する場合には、メタ文字の式を二重引用符で囲む必要はありません。一時ボリューム・セットを作成する場合は、対話モードに入る必要があります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) addvolset</B> コマンドを発行して、ボリューム・セットを作成します。その後、<B>(backup) addvolentry</B> コマンドを発行して、作成したボリューム・セットにボリューム項目を定義します。
<P>
<PRE>   backup>  <B>addvolset</B> &lt;<VAR>volume set name</VAR>> [<B>-temporary</B>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addvols
</B><DD>は、<B>addvolset</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume set name</VAR>
</B><DD>ボリューム・セットの名前を付けます。名前は、31 文字以内で、ピリオドを含むことはできません。また、バックアップ・データベースの中で固有でなければなりません。
(一時ボリューム・セットは、既存の永続ボリューム・セットと同じ名前を持つことができますが、混乱を避けるためにもお勧めできません。)
<P><DT><B>-temporary
</B><DD>現行の対話式セッションの間のみ存在する、一時ボリューム・セットを作成します。
</DL>
</LI></OL>
<A NAME="IDX6875"></A>
<A NAME="IDX6876"></A>
<A NAME="IDX6877"></A>
<A NAME="IDX6878"></A>
<P><H3><A NAME="Header_292" HREF="auagd002.htm#ToC_292">ボリューム項目のボリューム・セットへの追加</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>(オプション)</B> <B>backup</B> コマンドを発行して、対話モードに (まだなっていなければ) 入ります。これによって、メタ文字を二重引用符で囲む必要がなくなりますので、メタ文字の式の使用が簡素化されます。一時ボリューム・セットに項目を追加する場合は、そのボリューム・セットを作成する前に対話モードに入っておく必要があります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) addvolentry</B> コマンドを出して、既存のボリューム・セットにボリューム項目を定義します。バックアップ・システムは、ボリューム・セット内の各ボリューム項目に索引を付けます。最初の索引は 1 から始まります。
<P>
<PRE>   backup> <B>addvolentry  -name</B> &lt;<VAR>volume set name</VAR>>  \
                        <B>-server</B> &lt;<VAR>machine name</VAR>>  \
                        <B>-partition</B> &lt;<VAR>partition name</VAR>>  \
                        <B>-volumes</B> &lt;<VAR>volume name (regular expression)</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addvole
</B><DD>は、<B>addvolentry</B> の受け入れ可能な省略形です。
<P><DT><B>-name
</B><DD>ボリューム項目を追加するボリューム・セットの名前を指定します。このボリューム・セットはすでに存在していなければなりません。
(ボリューム・セットを作成する場合には、<B>backup addvolset</B> コマンドを使用してください。)
<P><DT><B>-server
</B><DD>ボリューム項目のボリュームを格納する 1 つ以上のファイル・サーバー・セットを定義します。完全修飾のホスト名 (たとえば <B>fs1.example.com</B>) を指定するか、メタ文字式 <B>.*</B> (ピリオドとアスタリスク) を使用してください。この式は、VLDB にあるすべてのマシン名に一致します。
<P><DT><B>-partition
</B><DD>ボリューム項目のボリュームを格納する 1 つ以上の区画セットを定義します。完全修飾の区画名 (たとえば <B>/vicepa</B>) を指定するか、メタ文字式 <B>.*</B> (ピリオドとアスタリスク ) を使用してください。この式は、すべての区画名に一致します。
<P><DT><B>-volumes
</B><DD>ボリューム項目に含まれる 1 つ以上のボリュームを定義します。それらは名前で識別します。この機能グループで既に説明したように、この引き数には英数字とメタ文字を 組み合わせて使用することができます。
</DL>
</LI></OL>
<A NAME="IDX6879"></A>
<A NAME="IDX6880"></A>
<A NAME="IDX6881"></A>
<A NAME="IDX6882"></A>
<A NAME="IDX6883"></A>
<A NAME="IDX6884"></A>
<P><H3><A NAME="HDRWQ366" HREF="auagd002.htm#ToC_293">ボリューム・セットおよびボリューム項目の表示</A></H3>
<OL TYPE=1>
<LI><B>backup listvolsets</B> コマンドを発行して、特定のボリューム・セットまたはすべてのボリューム・セットのボリューム項目を表示します。一時ボリューム・セットを表示する場合は、そのボリューム・セットを作成したときと同じ対話式セッションの中にいなければなりません。
<P>
<PRE>   % <B>backup listvolsets</B> [&lt;<VAR>volume set name</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listv
</B><DD>は、<B>listvolsets</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume set name</VAR>
</B><DD>表示するボリューム・セットの名前を指定します。定義されているすべてのボリューム・セットを表示するには、この引き数を省略します。
</DL>
<P>
<P>コマンドからの出力では、ボリューム項目が作成されたときのワイルドカード表記が使用されます。文字列 <TT>(temporary)</TT> は、一時ボリューム・セットにマークを付けます。次の例は、セルのバックアップ・データベースに定義されている 3 つのバックアップ・データベースすべてと、現行の対話式セッション内で作成された一時ボリューム・セット <B>pat+jones</B> を表示します。
<P>
<PRE>   backup> <B>listv</B>
   Volume set pat+jones (temporary):
     Entry 1: server fs1.example.com, partition /vicepe, volumes: user.pat.backup
     Entry 2: server fs5.example.com, partition /viceph, volumes: user.jones.backup
   Volume set user:
     Entry 1: server .*, partition .*, volumes: user.*\.backup
   Volume set sun:
     Entry 1: server .*, partition .*, volumes: sun4x_55\..*
     Entry 2: server .*, partition .*, volumes: sun4x_56\..*
   Volume set rs:
     Entry 1: server .*, partition .*, volumes: rs_aix42\..*
</PRE>
</LI></OL>
<A NAME="IDX6885"></A>
<A NAME="IDX6886"></A>
<A NAME="IDX6887"></A>
<A NAME="IDX6888"></A>
<P><H3><A NAME="Header_294" HREF="auagd002.htm#ToC_294">ボリューム・セットの削除</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>backup delvolset</B> コマンドを発行して、
1 つまたは複数のボリューム・セットとそのボリューム項目を削除します。一時ボリューム・セットを削除する場合は、そのボリューム・セットを作成したときと同じ対話式セッションの中にいなければなりません。
<P>
<PRE>   % <B>backup delvolset</B> &lt;<VAR>volume set name</VAR>><SUP>+</SUP>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>delvols
</B><DD>は、<B>delvolset</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume set name</VAR>
</B><DD>削除するボリューム・セットの名前を指定します。
</DL>
</LI></OL>
<A NAME="IDX6889"></A>
<A NAME="IDX6890"></A>
<A NAME="IDX6891"></A>
<A NAME="IDX6892"></A>
<A NAME="IDX6893"></A>
<P><H3><A NAME="Header_295" HREF="auagd002.htm#ToC_295">ボリューム項目のボリューム・セットからの削除</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>backup</B> コマンドを発行して、対話モードに入ります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI>ボリューム・セットに複数のボリューム項目がある場合には、
<B> (backup) listvolsets</B> コマンドを発行して、ボリューム項目に関連付けられた索引番号を表示してください。
(ボリューム項目が 1 つしかない場合には、その索引は 1 になります。)
コマンドの出力の詳細については、
<A HREF="#HDRWQ366">ボリューム・セットおよびボリューム項目の表示</A> を参照してください。
<P>
<PRE>   backup> <B>listvolsets</B> &lt;<VAR>volume set name</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>listv
</B><DD>は、<B>listvolsets</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume set name</VAR>
</B><DD>ボリューム項目を表示するボリューム・セットの名前を指定します。
</DL>
</LI><LI><B>(backup) delvolentry</B> コマンドを出すと、ボリューム項目が削除されます。
<P>
<PRE>   backup> <B>delvolentry</B> &lt;<VAR>volume set name</VAR>>  &lt;<VAR>volume entry index</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>delvole
</B><DD>は、<B>delvolentry</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>volume set name</VAR>
</B><DD>ボリューム項目を削除するボリューム・セットの名前を指定します。
<P><DT><B><VAR>volume entry index</VAR>
</B><DD>削除するボリューム項目のインデックス番号を指定します。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ367" HREF="auagd002.htm#ToC_296">ダンプ階層の定義および表示</A></H2>
<A NAME="IDX6894"></A>
<A NAME="IDX6895"></A>
<P>ダンプ階層は、フル・ダンプと増分ダンプの関係を定義しているバックアップ・データベースの論理構造です。ここでは、増分ダンプの親となるダンプを定義しています。階層内の個々のコンポーネントをダンプ・レベルといいます。
<P><B>backup adddump</B> コマンドを使用してダンプ・レベルを定義する場合には、次の規則および前提条件に注意してください。
<UL>
<LI>フル・ダンプ・レベルは、階層内で最上位のレベルになります。必要な数の階層を作成し、ボリューム・セットやスケジュールごとに別の階層にダンプすることができます。
</LI><LI>フル・ダンプ・レベルの名前は、スラッシュ (<B>/</B>) で始まり、その後に最大 28 文字までの英数字から構成される文字列が続きます。
</LI><LI>増分ダンプ・レベルの名前はパス名に似ています。フル・ダンプ・レベルの名前で始まり、次に最初の増分レベル、2 番目の増分レベル、というように最後の増分レベルまで続きます。各レベルの名前はスラッシュで始まり、前のレベルと区切られています。フル・レベルと同様に、各レベルには、スラッシュを除いて最大 28 文字までの名前を付けることができます。
</LI><LI>階層には、いくつでもレベルを指定することができますが、完全なダンプ・レベル名の最大長は、スラッシュも入れて 256 文字です。
</LI><LI>増分レベルを定義する場合には、階層内で上位にあるすべてのレベルが定義されていなければなりません。
</LI><LI>ダンプ・レベル名では、ピリオド (<B>.</B>) は使用しないでください。バックアップ・システムは、ダンプ名と AFS 磁気テープ名を作成するときに、ダンプのボリューム・セット名とダンプ・レベル名の区切り文字として、ピリオドを使用しています。他の英数字や句読文字は使用可能ですが、メタ文字は使用しないほうがよいでしょう。メタ文字を使用する場合には、この前に円記号 (<B>\</B>) を付けるか、ダンプ・レベル名全体を二重引用符
(<B> " "</B>) で囲んでください。
</LI><LI>ダンプ・レベルに名前を付けるときに実際の日時を使用すると、ダンプ実行日や、異なるレベルで実行されたダンプ間の関係を簡単に理解することができます。ただし、この名前はバックアップ・システムに何の意味もありません。名前に従って自動的にダンプが作成されるわけはありません。たとえば、火曜日にダンプを作成したときに、<B>/sunday</B> というレベルを作成することができます。
</LI><LI>1 つの階層で同じ名前のレベルが複数存在することは望ましいことではありません。その場合、ダンプ名とダンプ・レベルの同期が取れなくなる可能性があります。たとえば、<B> /full/incr/incr</B> という名前のダンプ・レベルを作成した場合、最初の増分レベルでボリューム・セットをダンプしたときに作成されたダンプ名と AFS 磁気テープ名
(<B>/full/incr</B>) は、
2 番目の増分レベルでのダンプ時に生成された名前 (<B>/full/incr/incr</B>) と類似したものになります。
</LI><LI>異なる階層であれば個々のレベルの名前が一致していてもかまいませんが、完全なパス名は固有でなければいけません。たとえば、<B>/sunday1/monday</B> および <B>/sunday2/monday</B> は、最終レベルの名前は同じですが、レベル全体では異なる名前のため固有のものです
(異なる階層に属しています)。ただし、複数階層で同じ名前を使用する場合、ダンプおよび AFS テープ名によりどの階層を使用するのか明確に示すことにはなりません。
</LI></UL>
<P>以下の例では、3 つの階層を表しています。それぞれの階層は、最上位でフル・ダンプを開始します。最初の階層が<B>sunday1</B>、
2 番目の階層が <B>sunday2</B>、
3 番目の階層が <B> sunday_bin</B> です。この3 つの階層は、お互いがお互いの増分ダンプになっています。
<PRE>   /sunday1
           /monday
           /tuesday
           /wednesday
           /thursday
           /friday
   /sunday2
           /monday
                  /tuesday
                          /wednesday
                                    /thursday
                                             /friday
    /sunday_bin
               /monday
                      /wednesday
                                /friday
</PRE>
<P>最初の階層では、各増分ダンプ・ダンプは、フル・レベルの　
<B>/sunday1</B> を親として参照します。ボリューム・セットを <B>/sunday1/wednesday</B> レベルでダンプすると、ボリューム・セットが<B>/sunday1</B> レベルで作成されてから変更されたデータが入ります。
<P>逆に、2 番目階層での増分ダンプ・レベルは、直前のレベルを親として認識します。ボリューム・セットを 2 番目の階層で対応するレベル (<B>/sunday2/monday/tuesday/wednesday</B>) にダンプすると、ダンプには、このボリューム・セットが <B>/sunday2/monday/tuesday</B> レベルで (おそらくは一日前に) ダンプされてから変更されたデータだけが入ります。特定の日にダンプを作成した場合、この階層で作成された増分ダンプには、最初の階層で対応するレベルで作成された増分ダンプよりも少ないデータが入ります。
<P>データの変更回数が頻繁でないため (たとえば、システム・バイナリー)、毎日バックアップする必要がないボリュームをダンプする場合に、
3 番目の階層は最適です。
<P><H3><A NAME="HDRWQ368" HREF="auagd002.htm#ToC_297">テープ再利用スケジュールの作成</A></H3>
<A NAME="IDX6896"></A>
<A NAME="IDX6897"></A>
<A NAME="IDX6898"></A>
<A NAME="IDX6899"></A>
<A NAME="IDX6900"></A>
<A NAME="IDX6901"></A>
<A NAME="IDX6902"></A>
<A NAME="IDX6903"></A>
<P>多くのセルでは、バックアップ磁気テープを格納する場所や、磁気テープを購入する予算にも制限があります。この問題は、不要になった磁気テープを上書きして、データのバックアップに使用するなど、磁気テープを再利用すると解決することができます。バックアップ・システムは、各ダンプ・レベルに有効期限を設定することができるので、再利用のスケジュールを作成することができます。有効期限には、そのレベルで作成されたダンプの有効期限を定義します。有効期限が切れるまで、バックアップ・システムは、ダンプを含むテープの上書きを拒否します。したがって、有効期限を割り当てると、自動的に磁気テープの再利用方法が決まります。
<P>磁気テープの再利用を計画するときには、バックアップされたデータの保存期間とバックアップ方法について考えなければなりません。たとえば、ユーザーのホーム・ボリュームを過去 2 週間の特定の日の状態に復元したい場合には、ダンプを毎日作成し、少なくとも 2 週間はそのダンプが入った磁気テープは再利用することができません。同様に、ユーザーのホーム・ボリュームを過去 1 か月の特定の週の初めの状態に復元したい場合には、毎週ダンプを作成して、少なくとも 4 週間はそのダンプが入った磁気テープを再利用することができません。次の例では、このスケジュールに従って磁気テープを再利用しています。ここでは、毎日実行する増分ダンプの有効期限を 13 日に、毎週実行するフル・ダンプの有効期限を 27 日に設定しています。
<P><B>/sunday1</B> には、毎日の増分ダンプで作成されたダンプが保管されます。有効期限が切れると、このボリュームは、
<B>/sunday3</B> での毎日のダンプ用に再利用され、このサイクルが繰り返されます。<B>/sunday2</B> と
<B>/sunday4</B> 階層との間にも同じような関係があります。同様に、磁気テープに <B>/sunday1</B> レベルで作成されたフル・ダンプがあり、この有効期限が切れると、翌月の最初の日曜日に実行されるフル・ダンプに使用されます。
<PRE>
   /sunday1   expires in 27d
          /monday1  expires in  13d
          /tuesday1  expires in  13d
          /wednesday1  expires in  13d
          /thursday1  expires in  13d
          /friday1  expires in  13d
   /sunday2   expires in 27d
          /monday2  expires in  13d
          /tuesday2  expires in  13d
          /wednesday2  expires in  13d
          /thursday2  expires in  13d
          /friday2  expires in  13d
   /sunday3   expires in 27d
          /monday1  expires in  13d
          /tuesday1  expires in  13d
          /wednesday1  expires in  13d
          /thursday1  expires in  13d
          /friday1  expires in  13d
   /sunday4   expires in 27d
          /monday2  expires in  13d
          /tuesday2  expires in  13d
          /wednesday2  expires in  13d
          /thursday2  expires in  13d
          /friday2  expires in  13d
</PRE>
<P>セルで付加ダンプを使用する場合には、ダンプ・セットのすべてのダンプは、その構成しているダンプに関連した最新の有効期限が適用されるので注意してください。すべてのダンプの有効期限が切れるまで、ダンプ・セットを含む磁気テープは再利用することができません。
<A HREF="auagd012.htm#HDRWQ415">ダンプを既存のダンプ・セットに追加するには</A> も参照してください。
<P>磁気テープの製造元は、多くの場合、特定の回数以上は書き込み操作をおこなわないように推奨しています。磁気テープを再利用するときには、この回数を超えないように注意する必要があります。テープの使用状況が分かるように、バックアップ・システムは、磁気テープのラベルに <TT>useCount</TT> カウンターを記録しています。磁気テープのラベルが更新されるたびに (<B>backup
labeltape</B> または <B>backup dump</B> コマンドを使用するたびに)、このカウンターは 1 つ加算されます
<TT> useCount</TT> カウンターを表示する場合には、
<B>backup readlabel</B> または <B>backup
scantape</B> コマンドを使用してください。<B>backup
dumpinfo</B> コマンドを発行するときには、<B> -id</B>
および <B>-verbose</B> オプションを使用してください。説明については、<A HREF="#HDRWQ372">テープ・ラベルの書き込みおよび読み取り</A>、または <A HREF="auagd012.htm#HDRWQ418">バックアップ・ダンプ・レコードの表示</A> を参照してください。
<A NAME="IDX6904"></A>
<A NAME="IDX6905"></A>
<A NAME="IDX6906"></A>
<A NAME="IDX6907"></A>
<P><H3><A NAME="HDRWQ369" HREF="auagd002.htm#ToC_298">テープの保存</A></H3>
<A NAME="IDX6908"></A>
<A NAME="IDX6909"></A>
<P>磁気テープを効率よく再利用しようとすると、バックアップ・データの中に長期間保存しなければならないデータが見つかることがあります。バックアップ・システムを使用すると、一定のスケジュールでデータを保存することができます。また、以前に再利用の対象になった磁気テープを選択して、データを保存することができます。
<P>一定の間隔でデータを保存する場合には、ダンプ階層内に日付別のダンプ・レベルを作成することができます。たとえば、
2000 年の四半期の開始ごとにセルに作成したすべてのデータのフル・ダンプを保存する場合には、ダンプ階層内に次のレベルを作成することができます。
<PRE>   /1Q2000
   /2Q2000
   /3Q2000
   /4Q2000
</PRE>
<P>以前に再利用を考えた磁気テープにあるデータを保存する場合には、関連するダンプ (フルおよび増分) を含む磁気テープをすべて用意しなければなりません。偶発的な事故でデータが消去されないように、スイッチを設定して磁気テープを書き込み不可にしてから、磁気テープの保管場所に移してください。磁気テープの中に、大量の不要なデータがある場合には、まず、関連するデータだけを新しい一時ボリュームに復元し、そのボリュームを最も少ない数の磁気テープに戻してください。ダンプ・セットのサイズを小さくするのは、保存することになるダンプ・セット内の関係のないデータの量を最小にするためです。
<P>保存されたデータをファイル・システムに復元しない場合には、
<B>backup deletedump</B> コマンドを使用して、関連するダンプ・レコードをバックアップ・データベースから削除することを考えてみてください。これにより、常に効率のよいサイズに保つことができます。データの復元が必要になれば、<B>backup scantape</B> コマンドに
<B>-dbadd</B> フラグを付けて発行すると、データベースにダンプ・レコードを再挿入することができます。説明については、
<A HREF="auagd012.htm#HDRWQ421">テープ内容をスキャンするには</A> を参照してください。
<P><H3><A NAME="HDRWQ370" HREF="auagd002.htm#ToC_299">有効期限の定義</A></H3>
<P>作成したダンプ・レベルに有効期限を設定するには、
<B>backup adddump</B> コマンドで <B>-expires</B> 引き数を使用してください。既存のダンプ・レベルの有効期限を変更する場合には、
<B>backup setexp</B> コマンドに <B>-expires</B> 引き数を指定してください。
(このレベルですでに作成されているダンプの有効期限は変更できません。)
両方のコマンドで、有効期限は、絶対値 (たとえば、2000 年 1月 13 日)
で設定することも、相対値 (たとえば、ダンプ作成後 30 日) で設定することもできます。
<UL>
<LI>絶対的な有効期限を定義するには、以下のような形式で
<B>-expires</B> 引き数に値を指定します。
<P>
<PRE>   [<B>at</B>] <VAR>mm</VAR><B>/</B><VAR>dd</VAR><B>/</B><VAR>yyyy</VAR> [<VAR>hh</VAR><B>:</B><VAR>MM</VAR>]
</PRE>
<P>
<P>ここで、<VAR>mm</VAR> は月、
<VAR>dd</VAR> は日、<VAR>yyyy</VAR> は年を表します。年に指定可能な値は、<B>1970</B> から
<B>2037</B> までです。(UNIX 時間可能な最新の日付は、
2038 年の初期までです。) 時間を指定する場合には、24 時間形式で入力してください。指定する形式は、<VAR>hh</VAR> <VAR>MM</VAR> です
(たとえば <B>21:50</B> は 9:50 p.m. を表します)。.
時間を省略すると、デフォルトは指定された日付の 00:00 時 (午前 12:00) になります。
</LI><LI>相対的な有効期限を定義するには、以下のような形式で <B> -expires</B> 引き数に値を指定します。
<P>
<PRE>   [<B>in</B>] [<VAR>years</VAR><B>y</B>] [<VAR>months</VAR><B>m</B>] [<VAR>days</VAR><B>d</B>]
</PRE>
<P>
<P>この <VAR>years</VAR>、<VAR>months</VAR>、および <VAR>days</VAR> はそれぞれ整数です。それらのうち少なくとも 1 つは、それと対応する文字
(<B>y</B>、<B>m</B>、または <B>d</B>)と一緒に使用します。間にスペースは入れません。この 3 つのうち 2 つ以上を指定する場合には、上の順番どおり指定してください。
<P>
<P>バックアップ・システムは、ダンプ操作の開始時間に、指定された相対的な時間を加えて、ダンプの実際の有効期限を計算します。たとえば、有効期限 <B>in 1y 6m 2d</B> のダンプ・レベルで作成されたダンプには、有効期限を 1 年 6 か月と 2 日に割り当てます。
</LI><LI>該当するダンプ・レベルでバックアップされたダンプに有効期限がないことを示すには、日時の代わり、次の文字列を <B>NEVER</B> 指定してください。このようなレベルで作成したダンプを含む磁気テープを再利用する場合には、
<B>backup readlabel</B> コマンドを使用して、磁気テープのラベルをはがしてください。
</LI></UL>
<P><B>backup adddump</B> コマンドに <B>-expires</B>引き数を省略すると、有効期限は UNIX 時間のゼロ (1970 年 1 月 1 日の午前 12 時 00 分) に設定されます。バックアップ・システムはこのようなダンプ・レベルで作成されたダンプを、その作成時刻に有効期限が切れるものとみなします。ダンプ・セット内に有効期限をもつダンプがなければ、そのダンプ・セットがある磁気テープの再利用について、バックアップ・システムによる制限はありません。ダンプ・セットのある磁気テープを早まって再利用してしまわないようにするには、手動追跡システムを使用しなければなりません。
<A NAME="IDX6910"></A>
<A NAME="IDX6911"></A>
<A NAME="IDX6912"></A>
<A NAME="IDX6913"></A>
<A NAME="IDX6914"></A>
<A NAME="IDX6915"></A>
<A NAME="IDX6916"></A>
<A NAME="IDX6917"></A>
<A NAME="IDX6918"></A>
<P><H3><A NAME="Header_300" HREF="auagd002.htm#ToC_300">ダンプ・レベルのダンプ階層への追加</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>オプション</B>。
<B>backup</B> コマンドを発行して、対話モードに入ります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>backup adddump</B> コマンドを出すと、
1 つまたは複数のダンプ・レベルを指定することができます。増分ダンプを定義している場合には、そのパス名に含まれるすべての親レベルが存在しているか、コマンド行で前になければなりません。
<P>
<PRE>   backup> <B>adddump -dump</B> &lt;<VAR>dump level name</VAR>><SUP>+</SUP> [<B>-expires</B> &lt;<VAR>expiration date</VAR>><SUP>+</SUP>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addd
</B><DD>は、<B>adddump</B> の受け入れ可能な省略形です。
<P><DT><B>-dump
</B><DD>追加する各ダンプ・レベルの名前を指定します。複数のダンプ・レベル名を指定する場合には、
<B>-dump</B> スイッチを組み込まなければなりません。
<P>
<P>ダンプ・レベルの完全なパス名を指定する場合には、パス名の各レベルの先頭にスラッシュ (<B>/</B>)。コンポーネント・レベルの長さはそれぞれ 28 文字までですが、パス名はスラッシュを含めて最高 256 文字まですることができます。
<P><DT><B>-expires
</B><DD>各ダンプ・レベルに関連して有効期限を設定します。
<A HREF="#HDRWQ370">有効期限の定義</A> で説明しているように、相対的または絶対的な有効期限を指定するか、またはこの引き数を省略して、ダンプ・レベルに有効期限を割り当てません。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">コマンドの構文ステートメントの中で、この引き数の後にはプラス記号が付きますが、これは二重引用符またはその他の区切り文字で囲む必要のない複数文字の値を受け入れるためで、複数の日付を受け入れるためではありません。
<B>-dump</B> 引き数で指定された各ダンプ・レベルに関連する日付 (およびオプションで時刻) 定義を、1 つだけ指定します。
</TD></TR></TABLE>
</DL>
</LI></OL>
<A NAME="IDX6919"></A>
<A NAME="IDX6920"></A>
<A NAME="IDX6921"></A>
<A NAME="IDX6922"></A>
<A NAME="IDX6923"></A>
<A NAME="IDX6924"></A>
<P><H3><A NAME="Header_301" HREF="auagd002.htm#ToC_301">ダンプ・レベルの有効期限を変更する</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>オプション</B>。
<B>backup</B> コマンドを発行して、対話モードに入ります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) setexp</B> コマンドを出すと、
1 つまたは複数のダンプ・レベルと関連した有効期限を変更することができます。
<P>
<PRE>   backup> <B>setexp -dump</B> &lt;<VAR>dump level name</VAR>><SUP>+</SUP> [<B>-expires</B> &lt;<VAR>expiration date</VAR>><SUP>+</SUP>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>se
</B><DD>は、<B>setexp</B> の受け入れ可能な省略形です。
<P><DT><B>-dump
</B><DD>有効期限を変更する既存のダンプ・レベルの名前をそれぞれ指定します。
<P><DT><B>-expires
</B><DD>各ダンプ・レベルに関連して有効期限を設定します。
<A HREF="#HDRWQ370">有効期限の定義</A> で説明しているように、相対的または絶対的な有効期限を指定するか、またはこの引き数を省略して、各ダンプ・レベルと現在関連している有効期限を消去します。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">コマンドの構文ステートメントの中で、この引き数の後にはプラス記号が付きますが、これは二重引用符またはその他の区切り文字で囲む必要のない複数文字の値を受け入れるためで、複数の日付を受け入れるためではありません。
<B>-dump</B> 引き数で指定された各ダンプ・レベルに関連する日付 (およびオプションで時刻) 定義を、1 つだけ提供します。
</TD></TR></TABLE>
</DL>
</LI></OL>
<A NAME="IDX6925"></A>
<A NAME="IDX6926"></A>
<A NAME="IDX6927"></A>
<A NAME="IDX6928"></A>
<A NAME="IDX6929"></A>
<P><H3><A NAME="Header_302" HREF="auagd002.htm#ToC_302">ダンプ・レベルのダンプ階層からの削除</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI><B>オプション</B>。
<B>backup</B> コマンドを発行して、対話モードに入ります。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) deldump</B> コマンドを出すと、ダンプ・レベルが削除されます。このコマンドは、指定のレベルが親となる増分ダンプ・レベルのすべてを自動的に直接か間接的に消去するので注意してください。
<P>
<PRE>   backup> <B>deldump</B> &lt;<VAR>dump level name</VAR>>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>deld
</B><DD>は、<B>deldump</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>dump level name</VAR>
</B><DD>削除するダンプ・レベルをフルパス名で指定します。
</DL>
</LI></OL>
<A NAME="IDX6930"></A>
<A NAME="IDX6931"></A>
<A NAME="IDX6932"></A>
<A NAME="IDX6933"></A>
<A NAME="IDX6934"></A>
<A NAME="IDX6935"></A>
<P><H3><A NAME="HDRWQ371" HREF="auagd002.htm#ToC_303">ダンプ階層の表示</A></H3>
<OL TYPE=1>
<LI><B>backup listdumps</B> コマンドを出すと、ダンプ階層が表示されます。
<P>
<PRE>    % <B>backup listdumps</B>
</PRE>
<P>
<P><B>listd</B> は、<B>listdumps</B> の最も短い受け入れ可能な省略形です。
<P>
<P>このコマンドからの出力にダンプ階層が表示されます。それには、各ダンプ・レベルと関連した有効期限が報告されます。以下に例を示します。
<P>
<PRE>    % <B>backup listdumps</B>
   /week1  expires in  27d
         /tuesday  expires in  13d
                 /thursday  expires in  13d
         /sunday  expires in  13d
                /tuesday expires in  13d
                        /thursday  expires in  13d
   /week3  expires in  27d
         /tuesday  expires in  13d
                 /thursday  expires in  13d
         /sunday  expires in  13d
                /tuesday  expires in  13d
                        /thursday  expires in  13d
   sunday1   expires in  27d
          /monday1  expires in  13d
          /tuesday1  expires in  13d
          /wednesday1  expires in  13d
          /thursday1  expires in  13d
          /friday1  expires in  13d
   sunday2   expires in  27d
          /monday2  expires in  13d
          /tuesday2  expires in  13d
          /wednesday2  expires in  13d
          /thursday2  expires in  13d
          /friday2  expires in  13d
   sunday3   expires in  27d
          /monday1  expires in  13d
          /tuesday1  expires in  13d
          /wednesday1  expires in  13d
          /thursday1  expires in  13d
          /friday1  expires in  13d
   sunday4   expires in  27d
          /monday2  expires in  13d
          /tuesday2  expires in  13d
          /wednesday2  expires in  13d
          /thursday2  expires in  13d
          /friday2  expires in  13d
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ372" HREF="auagd002.htm#ToC_304">テープ・ラベルの書き込みおよび読み取り</A></H2>
<A NAME="IDX6936"></A>
<A NAME="IDX6937"></A>
<A NAME="IDX6938"></A>
<A NAME="IDX6939"></A>
<A NAME="IDX6940"></A>
<A NAME="IDX6941"></A>
<P><A HREF="#HDRWQ353">ダンプ名および磁気テープ名</A> および <A HREF="#HDRWQ354">磁気テープ・ラベル、ダンプ・ラベル、および EOF マーカー</A> で説明するとおり、バックアップ・システムで使用する磁気テープに永続名または AFS 磁気テープ名のいずれかを指定することができます。名前は磁気テープの磁気ラベルに磁気テープの容量 (サイズ) と一緒に記録されます。
<P>指定できるのは永続名か AFS 磁気テープ名のいずれかであり、両方は指定できません。バックアップ・システムは永続名の形式を必要としないので、一般に、
AFS 磁気テープ名よりも永続名を指定する方がバックアップ処理が単純化されます。磁気テープに永続名が付いていないと、バックアップ・システムはデフォルトによって AFS 磁気テープ名フィールドで直接定義された 3 つの値だけを受け入れて、適合しない AFS 磁気テープ名のものにはダンプの書き込みを拒否します。このフィールドには、初期ダンプのボリューム・セットおよびダンプ・レベルに一致する名前、または値 <TT>&lt;NULL></TT> を指定するか、あるいは値をまったく指定しません。
<P>磁気テープに永続名が付いていると、バックアップ・システムは AFS 磁気テープ名を検査せず、ダンプ操作の一部として、該当する AFS 磁気テープ名自体を構成して、それをラベルに記録します。これは、ユーザーが永続名を指定した場合には、バックアップ・システムが AFS 磁気テープ名を指定して、磁気テープは両方のタイプの名前をもつことを意味します。反対に、
AFS 磁気テープ名を指定して永続名を指定しないと、永続名を指定するには、最初に AFS 磁気テープ名を消去しなければなりません。
<P>(永続名を指定していなくても、バックアップ・システムによる磁気テープの AFS
磁気テープ名の検査を行わないようにすることもできます。そうするには、装置構成ファイルで <B>NAME_CHECK</B> 命令に値 <B> NO</B> を指定します。<A HREF="#HDRWQ380">AFS テープ名検査の除去</A> を参照してください。)
<P>バックアップ・システムはラベルなし磁気テープを受け入れるので、それを最初に使用する前にラベルを付ける必要はありません。最初に使用した後で、そこにダンプを書き込むためにラベルを再度付けなければならない場合があります。それは以下の場合です。
<UL>
<LI>磁気テープに永続名が指定されておらず、その AFS 磁気テープ名が、作成したい新規の初期ダンプ・セットと一致していない場合。
(ボリューム・セットとダンプ・レベル名が異なっているか、索引が間違っている。)
</LI><LI>そこにあるダンプのすべてが満了するまえに磁気テープを再利用したい場合。バックアップ・システムは有効期限に達していないダンプを磁気テープに上書きしません。磁気テープにラベルを付け直して再利用できるようにするには、その磁気テープのダンプ・レコードをすべてバックアップ・データベースから消去して、磁気テープからいかなるデータも復元できないようにしなければならないので注意してください。
</LI></UL>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">ダンプ・データを含むテープにラベルを付けると、ラベル付けによりバックアップ・データベースからダンプ・レコードが除去されるため、そのデータは復元操作で使用できなくなります。テープ・ラベルに永続名を記録するのであれば、テープにデータをダンプする前に行わなければなりません。
</TD></TR></TABLE>
<P><H3><A NAME="Header_305" HREF="auagd002.htm#ToC_305">名前のレベルへの記録</A></H3>
<P>磁気テープのラベルに永続名を書き込む場合には、
<B>-pname</B> 引き数に 32 文字までの文字列を指定してください。セルのバックアップ・システムで使用されているもので、すでに指定済みの永続名を持っている磁気テープがほかにないかどうか調べてください。バックアップ・システムでは複数の磁気テープに同じ名前を指定してしまうのを防ぐ機能がありません。バックアップ・システムは既存の AFS テープ名がある場合は、これを <TT>&lt;NULL></TT> 値で上書きします。磁気テープに永続名があると、バックアップ・システムは、プロンプトや <B>backup</B> コマンドの出力で AFS 磁気テープ名ではなく永続名を使用します。
<B>-pname</B> 引き数を <B>backup labeltape</B> コマンドに再び指定しない限り、永続名は変更されません。磁気テープの内容や磁気テープの再利用回数、または <B>-pname</B> 引き数のない <B>backup labeltape</B> コマンドの使用回数には関係ありません。
<P>AFS 磁気テープ名をラベルに書き込むには、
<B> -name</B> 引き数に、ボリューム・セット名、および磁気テープに書き込む計画のある初期ダンプのダンプ・レベル・パス名と一致する値、ならびに、ダンプ・セットの磁気テープの順番に磁気テープの場所を示す索引を指定します。これらの形式は次のとおりです。
<PRE>   <VAR>volume_set_name</VAR><B>.</B><VAR>dump_level_name</VAR><B>.</B><VAR>tape_index</VAR>
</PRE>
<P><B>-name</B> 引き数を省略すると、バックアップ・システムは AFS テープ名を <TT>&lt;NULL></TT> に設定します。バックアップ・システムは、ユーザーが後で <B>backup dump</B> または
<B>backup savedb</B> コマンドを使用して初期ダンプを磁気テープに書き込むときに適切な名前を作成して記録します。
<P>磁気テープに永続名がすでにあると、
<B>-name</B> 引き数を使用することはできません。磁気テープの永続名を削除する場合には、<B>-pname</B> 引き数にヌル値を指定して、次のコマンドを発行してください。
<PRE>   % <B>backup labeltape -pname ""</B>
</PRE>
<P><H3><A NAME="Header_306" HREF="auagd002.htm#ToC_306">容量のラベルへの記録</A></H3>
<P>ラベルに磁気テープの容量を記録する場合には、
<B>-size</B> 引き数に数値を KB 単位で指定してください。磁気テープに最初にラベルを作成するときに、この引き数を省略すると、バックアップ・システムは、磁気テープ・コーディネーター・マシンの <B>/usr/afs/backup/tapeconfig</B> ファイルに指定されているポート・オフセットの設定されているデフォルトの磁気テープ容量を記録します。磁気テープの容量が <B>tapeconfig</B> ファイルに記録されているものと異なる (特に大きい) 場合には、磁気テープを使用する前にラベルに容量を記録するようにしてください。一度設定したら、ラベルの容量フィールドに指定された値は、
<B>-size</B> 引き数を再度 <B> backup labeltape</B> コマンドで使用するまで有効です。テープに記録するための適切な容量については、
<A HREF="#HDRWQ358">tapeconfig ファイルの構成</A> を参照してください。
<P>磁気テープのラベルを読み取るには、
<B>backup readlabel</B> コマンドを使用してください。
<P>ほとんどの磁気テープは、外部ケースにも使用することができる粘着性のラベルが付いてきます。簡単に磁気テープを識別できるようにするために、少なくとも磁気テープの永続名と AFS 磁気テープ名を粘着ラベルに記録しておいてください。再利用のスキームによっては、ダンプ dump ID、ダンプ作成日、磁気テープに書き込む各ダンプの有効期限などの、その他の情報を記録しておくと便利な場合があります。
<A NAME="IDX6942"></A>
<A NAME="IDX6943"></A>
<P><H3><A NAME="HDRWQ373" HREF="auagd002.htm#ToC_307">磁気テープのラベル付け</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>磁気テープ装置に操作を行う磁気テープ・コーディネーターが実行されていない場合には、該当する磁気テープ・コーディネーター・マシンとの接続をオープンにし、<B>butc</B> コマンドを発行してください。詳細については、
<A HREF="auagd012.htm#HDRWQ408">テープ・コーディネーター・プロセスを開始するには</A> を参照してください。
<P>
<PRE>   % <B>butc</B> [&lt;<VAR>port offset</VAR>>] [<B>-noautoquery</B>]
</PRE>
</LI><LI>テープを装置に装てんします。
</LI><LI><B>オプション</B>。複数の磁気テープにラベルを付けたり、磁気テープにラベルを付けた後にコマンドをさらに出したい場合には、
<B>backup</B> コマンドを出して対話モードに入ります。以下のように対話式でプロンプトが表示されます。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) labeltape</B> コマンドを出すと、磁気テープにラベルが付きます。
<P>
<PRE>   backup> <B>labeltape</B> [<B>-name</B> &lt;<VAR>tape name, defaults to NULL</VAR>>]  \
      [<B>-size</B> &lt;<VAR>tape size in Kbytes, defaults to size in tapeconfig</VAR>>]  \
      [<B>-portoffset</B> &lt;<VAR>TC port offset</VAR>>] [<B>-pname</B> &lt;<VAR>permanent tape name</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>la
</B><DD>は、<B>labeltape</B> の受け入れ可能な省略形です。
<P><DT><B>-name
</B><DD>ラベルに記録する AFS 磁気テープ名を指定します。この引き数は、<B>-pname</B> 引き数と一緒に使用できません。この引き数を省略すると、
AFS テープ名は <TT>&lt;NULL></TT> に設定されます。指定する場合には、以下のような形式にしなければなりません。
<P>
<PRE>   <VAR>volume_set_name</VAR><B>.</B><VAR>dump_level_name</VAR><B>.</B><VAR>tape_index</VAR>
</PRE>
<P>
<P>
<P><B>backup dump</B> 操作で将来使用可能な磁気テープの場合、<VAR>volume_set_name</VAR> は、テープに書き込まれる初期ダンプのボリューム・セット名に一致、<VAR>dump_level_name</VAR> は、ボリューム・セットがダンプされたダンプ・レベルのパス名の最後の要素と一致、
<VAR>tape_index</VAR> は、ダンプ・セットが置かれる一連のテープの中のテープの位置を正確に示していなければなりません
(索引は 1 から始まります)。
<P><DT><B>-size
</B><DD>ラベルに記録する磁気テープの容量を指定します。この引き数を指定するのは、初めて磁気テープにラベルを付けるときに、磁気テープの容量が、磁気テープ・コーディネーター・マシンの
<B>/usr/afs/backup/tapeconfig</B> ファイルに指定されているポート・オフセットの設定されている容量と異なる場合に限ります。
<P>
<P>値を指定する場合、整数の後に単位を表す文字を指定します。間にスペースは入れないでください。<B>k</B> または <B>K</B> はキロバイトで、
<B>m</B> または <B>M</B> はメガバイト、
<B>g</B> または <B>G</B> ギガバイトです。単位の文字を省略すると、デフォルトで K バイトが使用されます。
<P><DT><B>-portoffset
</B><DD>この操作で磁気テープを処理する磁気テープ・コーディネーターのポート・オフセット番号を指定します。デフォルト値の <B>0</B> (ゼロ) が適切でない場合には、この引き数を指定しなければなりません。
<P><DT><B>-pname
</B><DD>ラベルに記録する永続名を指定します。最大 32 文字までの名前が指定できます。名前には英数字を使用することができます。シェルで特別な意味を持つメタ文字や、シェル・プロンプトのコマンドでリテラルに解釈されるマークは使用しないでください。
<P>この引き数は、<B>-name</B> 引き数とは一緒に使用できません。この引き数を指定すると、
AFS テープ名は <TT>&lt;NULL></TT> に設定されます。この引き数を省略すると、既存の永続名が保存されます。
</DL>
</LI><LI><B>butc</B> コマンドを出したときに <B>-noautoquery</B> フラグを付けなかったか、装置の装置構成ファイルに <B>AUTOQUERY YES</B> 命令を記述している場合には、磁気テープ・コーディネーターから装置のドライブにテープを装てんするようにプロンプトが出されます。すでにこれを行っていても、
<B> &lt;Return></B> を押して、テープがラベル付けの準備ができていることを示さなければなりません。
</LI></OL>
<A NAME="IDX6944"></A>
<A NAME="IDX6945"></A>
<P><H3><A NAME="HDRWQ374" HREF="auagd002.htm#ToC_308">磁気テープのラベルの読み取り</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>磁気テープ装置に操作を行う磁気テープ・コーディネーターが実行されていない場合には、該当する磁気テープ・コーディネーター・マシンとの接続をオープンにし、<B>butc</B> コマンドを発行してください。詳細については、
<A HREF="auagd012.htm#HDRWQ408">テープ・コーディネーター・プロセスを開始するには</A> を参照してください。
<P>
<PRE>   % <B>butc</B> [&lt;<VAR>port offset</VAR>>] [<B>-noautoquery</B>]
</PRE>
</LI><LI>テープを装置に装てんします。
</LI><LI><B>オプション</B>。複数の磁気テープにラベルを付けたり、磁気テープにラベルを付けた後にコマンドをさらに出したい場合には、
<B>backup</B> コマンドを出して対話モードに入ります。以下のように対話式でプロンプトが表示されます。
<P>
<PRE>   % <B>backup</B>
</PRE>
</LI><LI><B>(backup) readlabel</B> コマンドを出すと、磁気テープのラベルを読み取ります。
<P>
<PRE>   backup> <B>readlabel</B> [&lt;<VAR>TC port offset</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>rea
</B><DD>は、<B>readlabel</B> の受け入れ可能な省略形です。
<P><DT><B><VAR>TC port offset</VAR>
</B><DD>この操作で磁気テープを処理する磁気テープ・コーディネーターのポート・オフセット番号を指定します。デフォルト値の <B>0</B> (ゼロ) が適切でない場合には、この引き数を指定しなければなりません。
</DL>
</LI><LI><B>butc</B> コマンドを出したときに <B>-noautoquery</B> フラグを付けなかったか、装置の装置構成ファイルに <B>AUTOQUERY YES</B> 命令を記述している場合には、磁気テープ・コーディネーターから装置のドライブにテープを装てんするようにプロンプトが出されます。すでにこれを行っていても、
<B> &lt;Return></B> を押して、テープが読み取りの準備ができていることを示さなければなりません。
</LI></OL>
<P>磁気テープ・ラベルからの情報は、
<B>backup</B> コマンド・ウィンドウと磁気テープ・コーディネーター・ウィンドウの両方に表示されます。コマンド・ウィンドウの出力形式は、以下のとおりです。
<PRE>   Tape read was labelled: <VAR>tape_name</VAR> (<VAR>initial_dump_ID</VAR>)
        size: <VAR>size</VAR> KBytes
</PRE>
<P>この <VAR>tape_name</VAR> は、磁気テープの永続名 (指定されている場合) または AFS磁気テープ名で、
<VAR>initial_dump_ID</VAR> は磁気テープにある初期ダンプのダンプ ID が、<VAR>size</VAR> には、ラベルに記録されている容量が k バイト単位で表示されます。
<P>「磁気テープ・コーディネーター」ウィンドウの情報は、より広範囲です。磁気テープの永続名は <TT>tape name</TT> フィールドに、
AFS 磁気テープ名は <TT>AFS tape name</TT> フィールドに表示されます。いずれかの名前が未定義の場合には、フィールドにはその代わりに <TT>&lt;NULL></TT> の値が表示されます。ラベルに記録された容量は、<TT>size</TT> フィールドに表示されます。それ以外の出力フィールドには、時期テープの作成時刻、ダンプ・レベル名、および初期ダンプのダンプ ID
(それぞれ <TT>creationTime</TT>、<TT>dump path</TT>、および <TT> dump id</TT>) が表示されます。
<TT>cell</TT> フィールドには、ダンプ操作が行われたセルが表示され、
<TT>useCount</TT> フィールドには、
<B> backup labeltape</B> コマンドまたはダンプ操作のいずれかによる磁気テープのラベル付けが再度行われた回数が表示されます。詳細については、<I>AFS Administration Reference</I> のコマンドの解説ページを参照してください。
<P>磁気テープにラベルがない場合、またはドライブが空の場合には、以下のメッセージがコマンド・シェルに表示されます。
<PRE>   Failed to read tape label.
</PRE>
<P>次の例は、ポート・オフセット 1 の装置にあるテープのコマンド・シェル出力を示しています。
<PRE>   % <B>backup readlabel 1</B>
   Tape read was labelled: monthly_guest (917860000)
        size: 2150000 KBytes
</PRE>
<P>同時に磁気テープ・コーディネーター・ウィンドウには以下の出力が表示されます。
<PRE>   Tape label
   ----------
   tape name = monthly_guest
   AFS tape name = guests.monthly.3
   creationTime =  Mon Feb  1 04:06:40 1999
   cell = example.com
   size = 2150000 Kbytes
   dump path = /monthly
   dump id = 917860000
   useCount = 44
   -- End of tape label --
</PRE>
<HR><H2><A NAME="HDRWQ375" HREF="auagd002.htm#ToC_309">バックアップ処理の自動化およびその効率化</A></H2>
<A NAME="IDX6946"></A>
<A NAME="IDX6947"></A>
<P>バックアップ・システムにはいくつかの任意選択機能があり、セルでのバックアップ処理の自動化や効率化に役立ちます。それらの機能を組み合わせることによって、ほとんどの場合で最小限の人的介入でボリューム・データを磁気テープにダンプすることができます。多くの機能を利用するには、自動化する操作にかかわる各磁気テープ装置ごとに、<B>/usr/afs/backup</B> ディレクトリーに <I>device configuration file</I> を作成します。入出力装置構成ファイルの作成に関する一般的な説明については、
<A HREF="#HDRWQ376">装置構成ファイルの作成</A> を参照してください。以下のリストは、各機能の詳細を記述した機能グループを示しています。
<UL>
<LI>バックアップ操作を実行するには、磁気テープ・スタッカーとジュークボックスを使用することができます。磁気テープ・ドライブには、複数の磁気テープを保管し、操作員が行わなくても実際に磁気テープ読取装置 (磁気テープ・ドライブ) 間で挿入/除去を行うことができる接続装置が付属しています。これによって、複数の磁気テープを必要とするバックアップ操作でも操作員が不要になります。バックアップ・システムでジュークボックスまたはジュークボックスを使用するには、その入出力装置構成ファイルに <B>MOUNT</B> および <B>UNMOUNT</B> 命令を記述します。<A HREF="#HDRWQ377">装置のテープ取り付けおよび取り外しルーチンの呼び出し</A> を参照してください。
</LI><LI>バックアップ操作に必要な初期テープの磁気テープ・コーディネーターのデフォルト・プロンプトを抑制することができます。これによって、バックアップ操作の開始時に操作員がいる必要がまたなくなります。(それでも、操作が開始する前には、ユーザーが正しい磁気テープをドライブに挿入しなければなりません。)
初期のプロンプトを抑制するには、
<B>butc</B> コマンドで <B>-noautoquery</B> フラグを立てるか、または入出力装置構成ファイルで <B>AUTOQUERY</B> 命令に値 <B>NO</B> を割り当てます。<A HREF="#HDRWQ378">最初のテープの検索またはプロンプトの除去</A> を参照してください。
</LI><LI>磁気テープ・コーディネーターが数種類のエラーを検出しても生成するというプロンプトを抑制することができます。この機能を使用すると、磁気テープ・コーディネーターは通常、デフォルトの方法でエラーに応答し、操作は人的介入を行わずに継続することができます。エラー条件に関するプロンプトを抑制するには、入出力装置構成ファイルで <B>ASK</B> 命令に <B> NO</B> を割り当てます。
<A HREF="#HDRWQ379">エラー条件に対するデフォルトの応答の使用可能化</A> を参照してください。
</LI><LI>永続名を持たない磁気テープ上の AFS 磁気テープ名が、ボリュームから派生した名前および磁気テープに書き込まれる初期ダンプのダンプ・レベル名と一致するかどうかの、バックアップ・システムのデフォルトの検査を抑制することができます。これによって、そこにあるすべてのダンプが満了するまでには、最初にラベルの再作成をしなくても磁気テープを再利用することができます。名前の検査を抑制するには、入出力装置構成ファイルで <B>NAME_CHECK</B> 命令に <B>NO</B> を割り当てます。<A HREF="#HDRWQ380">AFS テープ名検査の除去</A> を参照してください。
</LI><LI>ファイル・システムと装置の間でボリューム・データを転送するときに磁気テープ・コーディネーターが使用するメモリー・バッファーのサイズを設定することによって、磁気テープのストリーミングをプロモートする (磁気テープ装置が操作するのにもっとも効果的な方法) ことができます。バッファー・サイズを設定するには、入出力装置構成ファイルで <B>BUFFERSIZE</B> 命令を記述します。<A HREF="#HDRWQ381">テープ・ストリーミングをプロモートするためのメモリー・バッファーの設定</A> を参照してください。
</LI><LI>ダンプを、磁気テープではなく、磁気テープ・コーディネーター・マシンのローカル・ディスク上の <I>バックアップ・データ・ファイル</I> に書き出すことができます。それからユーザーは、バックアップ・データを階層記憶管理 (HSM) システムなどのデータ保存システムに転送することができます。このシステムは AFS およびバックアップ・システムと一緒に使用します。通常、ダンプをファイルへ書き込む方が、同等の <B>vos dump</B> コマンドを個々に発行するよりも効果的です。ダンプをファイルに書き出すには、入出力装置構成ファイルで <B>FILE</B> 命令を記述します。<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください。
</LI></UL>
<P>入出力装置構成ファイルを使用しないバックアップの自動化および効率を高めるには、ほかに 2 つの方法があります。
<UL>
<LI>1 つまたは複数の <B>backup  dump</B> コマンドをスケジュールして、指定の時期に実行することができます。これによって、人的介入を必要とせずに、システムの使用量が低いときにバックアップを作成することができます。以後のある時期にダンプ操作を 1 つスケジュールしたり、いろいろなときに複数の操作を実行するようスケジュールしたりすることができます。<A HREF="auagd012.htm#HDRWQ416">ダンプのスケジューリング</A> を参照してください。
</LI><LI>すでにほかのダンプが存在する磁気テープにダンプを追加することもできます。これによって、磁気テープの容量をできるだけ多く使用することができます。付加ダンプを磁気テープ上の初期ダンプや別の付加ダンプに関連させる必要はありませんが、ダンプをグループ化しておくと、復元操作での磁気テープの交換回数を減らすことができます。ダンプを追加するには、
<B>backup dump</B> コマンドに <B>-append</B> 引き数を組み込みます。<A HREF="auagd012.htm#HDRWQ415">ダンプを既存のダンプ・セットに追加するには</A> を参照してください。
</LI></UL>
<P><H3><A NAME="HDRWQ376" HREF="auagd002.htm#ToC_310">装置構成ファイルの作成</A></H3>
<A NAME="IDX6948"></A>
<A NAME="IDX6949"></A>
<A NAME="IDX6950"></A>
<A NAME="IDX6951"></A>
<P>バックアップ操作の自動化を行う多くの機能を使用するには、装置を起動する磁気テープ・コーディネーター・マシンのローカル・ディスクの <B>/usr/afs/backup</B> ディレクトリーにある各磁気テープ装置ごとに構成ファイルを作成します。ファイル名の形式は、次の通りです。
<P><B>CFG_</B><VAR>device_name</VAR>
<P>ここで、<VAR>device_name</VAR> は、磁気テープ装置またはバックアップ・データ・ファイルを表します
(ダンプを磁気テープではなくファイルに書き出す方法については、<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください)。
<P>テープ装置の場合、すべての UNIX 装置名の始めの部分にある <B>/dev/</B> 文字列を削除して、名前の中のスラッシュを下線に置換して、名前の <VAR>device_name</VAR> 部分を構成してください。たとえば、<B>CFG_rmt_4m</B> は、
<B>/dev/rmt/4m</B> という名前のファイル名を表しています。
<P>バックアップ・データ・ファイルの場合、最初のスラッシュ (<B>/</B>) を削除し、名前の中のスラッシュ (<B>/</B>) を下線で置換して、<VAR>device_name</VAR> 部分を構成してください。たとえば、
<B>CFG_var_tmp_FILE</B> は、
<B>/var/tmp/FILE</B> という名前のバックアップ・データ・ファイルのファイル名です。
<P>入出力装置構成ファイルの作成は任意選択です。ファイルによる機能を必要としない場合は、作成する必要はありません。
<P>以下の命令のどれでも任意の順序で入出力装置構成ファイルに記述することができます。すべて任意選択です。命令ごとに改行しますが、
1 つの命令の中に改行 (<B>&lt;Return></B>) 文字を入れてはなりません。
<DL>
<P><DT><B>MOUNT および UNMOUNT
</B><DD>磁気テープ・スタッカーまたはジュークボックスのドライブに必要に応じて磁気テープを取り付けたり取り外したりするためのルーチンのスクリプトを識別します。
<A HREF="#HDRWQ377">装置のテープ取り付けおよび取り外しルーチンの呼び出し</A> を参照してください。
<P><DT><B>AUTOQUERY
</B><DD>バックアップ操作のために必要な最初の磁気テープを要求するために、磁気テープ・コーディネー ターがプロンプトを出すかどうかを制御します。
<A HREF="#HDRWQ378">最初のテープの検索またはプロンプトの除去</A> を参照してください。
<P><DT><B>ASK
</B><DD>ある種のエラー条件に対する応答方法について、テープ・コーディネーターがユーザーに尋ねるかどうかを制御します。
<A HREF="#HDRWQ379">エラー条件に対するデフォルトの応答の使用可能化</A> を参照してください。
<P><DT><B>NAME_CHECK
</B><DD>AFS テープ名と、テープに書き込む初期ダンプが一致するかどうか、テープ・コーディネーターが検査を行うかどうかを制御します。<A HREF="#HDRWQ380">AFS テープ名検査の除去</A> を参照してください。
<P><DT><B>BUFFERSIZE
</B><DD>磁気テープ装置およびボリューム間のデータ転送時に磁気テープ・コーディネーターが使用するメモリー・バッファーのサイズを設定します。
<A HREF="#HDRWQ381">テープ・ストリーミングをプロモートするためのメモリー・バッファーの設定</A> を参照してください。
<P><DT><B>FILE
</B><DD>磁気テープ・コーディネーターが、バックアップ・データ・ファイルにダンプを書き出すか、そこから復元するかを制御します。<A HREF="#HDRWQ382">データのバックアップ・データ・ファイルへのダンプ</A> を参照してください。
</DL>
<A NAME="IDX6952"></A>
<A NAME="IDX6953"></A>
<A NAME="IDX6954"></A>
<A NAME="IDX6955"></A>
<A NAME="IDX6956"></A>
<A NAME="IDX6957"></A>
<P><H3><A NAME="HDRWQ377" HREF="auagd002.htm#ToC_311">装置のテープ取り付けおよび取り外しルーチンの呼び出し</A></H3>
<P>磁気テープ・スタッカーまたはジュークボックスを使用すると、人的介入を行わずに操作中でも複数の磁気テープを切り換えることができるため、バックアップ操作を自動化することができます。この機能を利用するためには、スタッカーまたはジュークボックスについて、入出力装置構成ファイルに <B>MOUNT</B> および任意で <B>UNMOUNT</B> 命令を記述してください。これら命令の構文は同じになります。
<PRE>   <B>MOUNT</B> <VAR>filename</VAR>
   <B>UNMOUNT</B> <VAR>filename</VAR>
</PRE>
<P>この <VAR>filename</VAR> は、装置の磁気テープ・ドライブに磁気テープをマウントするかまたはアンマウントするために装置の製造者が定義したルーチンを呼び出すようにユーザーが作成したスクリプトまたはプログラムのローカル・ディスク上のパス名です。
(以降、
<I>スクリプト</I> という用語はスクリプトとプログラムの両方を指します。)
スクリプトには通常、エラー条件を処理したり、実行中のバックアップ操作に従ってスクリプトの働きを修正したりする、追加ロジックが含まれています。
<P><B>MOUNT</B> または <B>UNMOUNT</B> 命令が記述された別個のスクリプトを参照することもできれば、マウントとアンマウントのルーチンを呼び出す単一のスクリプトを参照したりすることもできます。スクリプトは、
<B> butc</B> コマンド発行側のローカル ID と AFS トークンを継承します。
<P><B>MOUNT</B> 命令はすべての磁気テープ装置について入出力装置構成ファイルに記述する必要がありますが、
<B> UNMOUNT</B> 命令を記述するかどうかは、装置の製造者が作成した磁気テープ処理ルーチンによって異なります。装置によっては(たいていはスタッカー)、磁気テープのマウントに必要なルーチンは 1つだけで、これで磁気テープのアンマウントも自動的に行えるものもあります。テープがある場合は、必要な新しい磁気テープを挿入することはできません。この場合、
<B>UNMOUNT</B> 命令は不要です。マウントおよびアンマウント・ルーチンを別個にもつ装置の場合には、<B> UNMOUNT</B> 命令を記述して、磁気テープ・コーディネーターがこれで終わった時に磁気テープをアンマウントするようにしなければなりません。そうしないと、それ以降に <B>MOUNT</B>命令を実行しようとすると、エラーになって失敗します。
<P>入出力装置構成ファイルに <B>MOUNT</B> 命令が記述されている場合には、バックアップ操作を実行する前に、必要な磁気テープをスタッカーまたはジュークボックスに備えておかなければなりません。ジュークボックスの多くは、磁気テープ上の外部ラベル (バーコードなど)を読み取って必要な磁気テープを検索することができますが、スタッカーの多くは、テープを順番に、ときには一方向にしか切り換えることができません。後者の場合、磁気テープを正しい順序で備えておかなければなりません。
<P>磁気テープ装置に磁気テープをあらかじめ備えておけるように復元操作に必要な磁気テープのリストを獲得するには、該当する <B>backup</B> コマンドに <B>-n</B> フラグを立ててください。
(<B> backup diskrestore</B>、<B>backup volrestore</B>、または <B> backup volsetrestore</B>)。ダンプ操作では、たいていは、操作に必要であると考えられる以上の数の磁気テープを装置に備えておけば十分です。磁気テープの事前ラベル付けには、永続名か AFS 磁気テープ名を使用したり、あるいはまったく使用しないこともできます。ダンプ操作用の磁気テープに AFS 磁気テープ名で事前ラベル付けを行う場合、磁気テープ索引に従ってそれらを順次にスタッカーにロードするのがもっとも簡単です。永続磁気テープ名でラベルを付けるか、ラベルなし磁気テープを使用しても簡単ですが、この場合、バックアップ・システムがダンプ操作時に索引付きの AFS 磁気テープ名を生成し適用します。
<P><H4><A NAME="Header_312">テープ・コーディネーターが MOUNT および UNMOUNT 命令を使用する方法</A></H4>
<P><B>butc</B> コマンドを出して指定の磁気テープ装置用に磁気テープ・コーディネーターを初期設定すると、磁気テープ・コーディネーターはローカル・ディスク上の <B>/usr/afs/backup/CFG_</B><VAR>device_name</VAR> という装置構成ファイルを検索します。この <VAR> device_name</VAR> の形式については、
<A HREF="#HDRWQ376">装置構成ファイルの作成</A> で説明しています。ファイルが存在して <B>MOUNT</B> 命令を記述している場合には、磁気テープ・コーディネーターが磁気テープを必要とする時はいつでも、命令の <VAR>filename</VAR> 引き数で指定したスクリプトを実行します。
<P>入出力装置構成ファイルが存在しないか、または <B>MOUNT</B> 命令が記述されていない場合には、磁気テープ・コーディネーターが磁気テープを必要とする時にはいつでも、必要な磁気テープを操作員が挿入するように要求するプロンプトがウィンドウに表示されます。操作員は、磁気テープ・コーディネーターがバックアップ操作を継続する前に、磁気テープをドライブに挿入して、<B>&lt;Return></B> を押さなければなりません。
<P>しかし、操作に必要な最初の磁気テープに関して磁気テープ・コーディネーターの振る舞いを修正するには、装置構成ファイルで <B> AUTOQUERY</B> 命令を <B> NO</B> に設定するか、
<B>-noautoquery</B> フラグを <B>butc</B> コマンドに立てます。この場合、磁気テープ・コーディネーターは <B>MOUNT</B> 命令を実行せず、操作の開始時に磁気テープのプロンプトを出します。これは、ドライブ内で必要な最初の磁気テープを探したいためです。<A HREF="#HDRWQ378">最初のテープの検索またはプロンプトの除去</A> を参照してください。
<P>装置構成ファイルに <B>UNMOUNT</B> 命令が記述されている場合に磁気テープ・コーディネーターが磁気テープをクローズする時はいつでも、命令の<VAR>filename</VAR> 引き数で指定したスクリプトを実行します。装置での<B>クローズ</B> 操作が成功したか、しないかに関係なく、スクリプトを一度だけ実行します。入出力装置構成ファイルに <B>UNMOUNT</B> 命令が記述されていない場合には、磁気テープ・コーディネーターは処置を取りません。
<P><H4><A NAME="Header_313">使用可能なパラメーターおよび必須終了コード</A></H4>
<P>磁気テープ・コーディネーターが <B>MOUNT</B> スクリプトを実行するときには、
5 つのパラメーターで以下の順序で渡されます。スクリプトでパラメーターを使用すると、バックアップ操作時に生じる可能性のある環境の変化に対する応答を改良することができます。
<OL TYPE=1>
<LI><B>/usr/afs/backup/tapeconfig</B> ファイルには、磁気テープ装置またはバックアップ・データ・ファイルのパス名が記録されています。
</LI><LI>操作の開始に使用された <B>backup</B> コマンドの操作コードに対応する、磁気テープ操作 (次のリストに示す例外を除きます)。
<UL>
<LI><B>appenddump</B> (<B>backup dump</B> コマンドに <B>-append</B> フラグがある場合)
</LI><LI><B>dump</B>(<B>backup dump</B> コマンドに <B>-append</B> フラグがない場合)
</LI><LI><B>labeltape</B>
</LI><LI><B>readlabel</B>
</LI><LI><B>restore</B> (<B>backup diskrestore</B>、<B>backup volrestore</B>、または <B>backup volsetrestore</B> コマンドに対して)
</LI><LI><B>restoredb</B>
</LI><LI><B>savedb</B>
</LI><LI><B>scantape</B>
</LI></UL>
</LI><LI>磁気テープ・コーディネーターが磁気テープ装置またはバックアップ・データ・ファイルをオープンしようとした回数。オープン試行でエラーが戻されると、磁気テープ・コーディネーターは値を増やして、再度<B>MOUNT</B> 命令を呼び出します。
</LI><LI>磁気テープの名前。操作によっては、磁気テープ・コーディネーターは、磁気テープ名を識別できない場合
(<B>backup scantape</B> コマンドや、
<B>backup readlabel</B> コマンドの実行中など)、あるいは磁気テープに名前が必要ない場合
(<B>backup labeltape</B> コマンドの実行中など) に、
<TT>none</TT> という文字列を渡します。
</LI><LI>バックアップ・データベースに記録されている磁気テープ ID。磁気テープ名と同様に、バックアップ・システムは、磁気テープ ID が識別できない場合または必要な ID がない場合に、操作に対して <TT>none</TT> という文字列を渡します。
</LI></OL>
<P><B>MOUNT</B> スクリプトでは、以下の終了コードのいずれか 1 つを戻して、磁気テープが正しくマウントされたかどうかを磁気テープ・コーディネーターに通知しなければなりません。
<UL>
<LI>コード <B>0</B> (ゼロ) は、正しくマウントしたことを示し、テープ・コーディネーターは、バックアップ操作を継続します。
<B>MOUNT</B> 命令が呼び出したスクリプトまたはプログラムからこの終了コードを受信しないと、磁気テープ・コーディネーターは、<B>UNMOUNT</B> 命令を呼び出すことができません。
</LI><LI>コード <B>1</B> は、マウント試行に失敗したことを示しています。磁気テープ・コーディネーターは、バックアップ操作を終了します。
</LI><LI>これ以外のコードは、スクリプトが正しいテープにアクセスできなかったことを示しています。磁気テープ・コーディネーターは、操作員にプロンプトを出し、正しい磁気テープを挿入するように要求します。
</LI></UL>
<P>磁気テープ・コーディネーターが <B>UNMOUNT</B> スクリプトを実行するときには、
2 つのパラメーターで以下の順序で渡されます。
<OL TYPE=1>
<LI>磁気テープ装置のパス名 (<B>/usr/afs/backup/tapeconfig</B>ファイルに指定されています)
</LI><LI>磁気テープ操作 (これは常に <B>unmount</B> です)
</LI></OL>
<P>以下のスクリプト例では、バックアップ・システムにより渡される 2 つのパラメーター
<TT>tries</TT> および <TT>operation</TT> を使用しています。これは推奨される方法に従い、
<TT>tries</TT> パラメーターの値が 1 を超えた (スタッカーのテープが不足) 場合に終了します。
<P><B>backup dump</B> または <B>backup savedb</B> 操作の場合、ルーチンにより、例にある <B>stackerCmd_NextTape</B> ファンクション (スタッカーの製造元が提供) が呼び出されます。ファイルの最終行が終了コードを戻し、操作員にテープの挿入を指示しています。これらの行は、スタッカーがテープをロードできない、または実行中の操作がファイルに明示的に記述された操作ではない場合のいずれかの際に呼び出されます
(たとえば復元操作中)。
<PRE>   #! /bin/csh -f

   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5
   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2
   #--------------------------------------------
   if (${tries} > 1) then
      echo "Too many tries"
      exit ${exit_interactive}
   endif
   if (${operation} == "unmount") then
      echo "UnMount: Will leave tape in drive"
      exit ${exit_continue}
   endif
   if ((${operation} == "dump")   |\
       (${operation} == "appenddump")     |\
       (${operation} == "savedb"))  then
       stackerCmd_NextTape ${devicefile}
       if (${status} != 0)exit${exit_interactive}
       echo "Will continue"
       exit ${exit_continue}
   endif

   if ((${operation} == "labeltape")    |\
       (${operation} == "readlabel")) then
      echo "Will continue"
      exit ${exit_continue}
   endif

   echo "Prompt for tape"
   exit ${exit_interactive}
</PRE>
<A NAME="IDX6958"></A>
<A NAME="IDX6959"></A>
<A NAME="IDX6960"></A>
<A NAME="IDX6961"></A>
<P><H3><A NAME="HDRWQ378" HREF="auagd002.htm#ToC_314">最初のテープの検索またはプロンプトの除去</A></H3>
<P>デフォルトによって、磁気テープ・コーディネーターがバックアップ操作に必要な最初の磁気テープを獲得するには、入出力構成ファイルを読み取って適切な磁気テープ装置がないかどうか調べます。
<B>MOUNT</B> 命令がある場合には、磁気テープ・コーディネーターは、参照されたスクリプトを実行します。入出力装置構成ファイルが存在していないか、そのファイルに <B>MOUNT</B> 命令がなければ、磁気テープ・コーディネーターはプロンプトを出して、正しい磁気テープを挿入してから <B>&lt;Return></B> を押すように要求します。
<P>操作に磁気テープが必要であることを前もって分かっている場合には、必要な磁気テープをドライブに入れてから <B>backup</B> コマンドを出し、磁気テープ・コーディネーターにその最初の磁気テープの獲得ステップをスキップするように通知すると、効率を高めることができます。この両方を行うことによって、操作の開始を素早く行うことができるようになり、磁気テープを挿入する人員が必要なくなります。
<P>磁気テープ・コーディネーターの最初の磁気テープ獲得ステップをう回する方法は、2 通りあります。
<OL TYPE=1>
<LI>命令 <B>AUTOQUERY NO</B> を入出力装置構成ファイルに記述します。
</LI><LI><B>-noautoquery</B> フラグを <B>butc</B> コマンドに立てます。
</LI></OL>
<P>操作員アテンションを必要とするエラー条件を避けるためには、ドライブに入れている磁気テープに有効期限切れのダンプが入っていないこと、および書き込み保護されていないことを確認してください。テープのラベルに永続名がなく、最初のダンプを作成している場合には、AFS テープ名がボリューム・セットとダンプ・セットの名前に一致しているか、または <TT>&lt;NULL></TT> であるかを確認してください。または、<A HREF="#HDRWQ380">AFS テープ名検査の除去</A> で説明するとおり、入出力装置構成ファイルで <B>NAME_CHECK</B> 命令に値 <B>NO</B> を割り当てることによって、テープ・コーディネーターの名前検査ステップを抑制してください。
<A NAME="IDX6962"></A>
<A NAME="IDX6963"></A>
<A NAME="IDX6964"></A>
<P><H3><A NAME="HDRWQ379" HREF="auagd002.htm#ToC_315">エラー条件に対するデフォルトの応答の使用可能化</A></H3>
<P>デフォルトでは、磁気テープ・コーディネーターからある種のエラー条件を検出した時の応答方法について尋ねられます。プロンプトを抑制して、あらかじめ指定された方法で磁気テープ・コーディネーターにエラーを処理させるには、入出力装置構成ファイルで命令 <B> ASK NO</B> を記述します。値 <B>YES</B> を割り当てるか、または <B>ASK</B> 命令を完全に省略する場合には、磁気テープ・コーディネーターからプロンプトが出されて、エラーの 1 つを検出したときの指示について尋ねられます。
<P>以下のリストは、エラー条件と、それに対する磁気テープ・コーディネーターの応答について説明しています。
<UL>
<LI><B>backup dump</B> コマンドの実行中、バックアップ・システムはボリュームのダンプを使用できません。値に <B>NO</B> を割り当てた場合、磁気テープ・コーディネーターはダンプからボリュームを省略して操作を続行します。値 <B>YES</B> を割り当てると、ボリュームの再ダンプを即時に試行する、ダンプからボリュームを省略するが操作は続行する、あるいは操作を終了させる、のプロンプトが出されます。
</LI><LI><B>backup diskrestore</B>、
<B>backup volrestore</B>、または
<B>backup volsetrestore</B> コマンドの実行中、バックアップ・システムはボリュームの復元を使用できません。値に <B>NO</B> を割り当てた時、磁気テープ・コーディネーターは、問題のあるボリュームを省略しますが、それ以外のボリュームの復元操作を継続します。値
<B>YES</B> を割り当てると、ボリュームを省略して操作を続行するか、または操作を終了させる、のプロンプトが出されます。
</LI><LI><B>backup scantape</B> コマンドの実行中、バックアップ・システムは、ダンプ・セットが複数の磁気テープに書き込まれているかどうか判別できません。(この問題の原因については、<I>AFS Administration Reference</I> にあるこのコマンドの解説ページを参照してください。)
値 <B>NO</B> を割り当てると、磁気テープ・コーディネーターは、複数の磁気テープがあることを前提に処理を進めて、入出力装置構成ファイルで指定された <B>MOUNT</B> スクリプトを呼び出すか、またはプロンプトを出して、操作員に次の磁気テープの挿入を要求します。値に <B>YES</B> を割り当てた時、磁気テープ・コーディネーターは、プロンプトを出して、走査する磁気テープが複数あるどうか確認します。
</LI><LI>バックアップ・システムは、<B>backup labeltape</B> コマンドの実行中に、磁気テープに有効期限切れのダンプがないかどうか判別します。値に <B>NO</B> を割り当てた時、操作を終了し、磁気テープのラベルは再作成しません。
<B>YES</B> 値の場合、磁気テープ・コーディネーターはプロンプトを出して、いずれにしても磁気テープのラベルの再作成を行うかを確認します。
</LI></UL>
<A NAME="IDX6965"></A>
<A NAME="IDX6966"></A>
<A NAME="IDX6967"></A>
<A NAME="IDX6968"></A>
<P><H3><A NAME="HDRWQ380" HREF="auagd002.htm#ToC_316">AFS テープ名検査の除去</A></H3>
<P>永続名を持たない磁気テープに最初のダンプを書き出している場合には、デフォルトによって、バックアップ・システムは、磁気テープの AFS 磁気テープ名が受け入れ可能であるかどうかを検査します。3 種類の値が受け入れられます。
<UL>
<LI>最初のダンプのボリューム・セットおよびダンプ・レベル、ならびにそのダンプ・セットの一連の磁気テープ内における磁気テープの位置を表す名前。
<A HREF="#HDRWQ353">ダンプ名および磁気テープ名</A> に説明があります。磁気テープがまだ永続名を指定されていない場合には、
<B>-name</B> 引き数を <B>backup labeltape</B> コマンドに使用して、
AFS 磁気テープ名を割り当てることができます。
</LI><LI><TT>&lt;NULL></TT> 値。これは、永続名を割り当てる、または <B>backup labeltape</B> コマンドの
<B>-name</B> 引き数へ値が与えられない時の結果です。
</LI><LI>AFS 磁気テープ名がまったくない。これは、テープにラベルを付けていなかったり、そこにダンプを書き込んでいないことを示しています。
</LI></UL>
<P>名前の検査をう回するには、入出力装置構成ファイルに <B>NAME_CHECK NO</B>
命令を記述してください。これによって、そこにあるすべてのダンプが満了するまでには、最初にラベルの再作成をしなくても磁気テープを再利用することができます。
(磁気テープに有効期限切れのダンプがあるが、それを再利用したい場合には、
<B>backup labeltape</B> コマンドを使用して、そのラベルの再作成を最初に行わなければなりません。これを行うには、
<B>ASK NO</B> 命令は入出力装置構成ファイルには記述されていないはずです。)
<P><H3><A NAME="HDRWQ381" HREF="auagd002.htm#ToC_317">テープ・ストリーミングをプロモートするためのメモリー・バッファーの設定</A></H3>
<P>デフォルトでは、磁気テープ・コーディネーターは、ダンプ操作で 16 KB のメモリー・バッファーを使用します。ボリューム・サーバーからボリューム・データを受信するときに、磁気テープ・コーディネーターは、16 KB のデータをバッファーに収集してから、16
KB すべてを磁気テープ装置に転送します。同様に復元操作では、磁気テープ・コーディネーターは、デフォルトで 32
KB のデータを磁気テープ装置からバッファーに入れてから、32 KB すべてのボリューム・サーバーに転送し、ファイル・システムに復元します。バッファリングによってボリューム・データの流れが均一になり、磁気テープをストリームかすることができます。これにより、磁気テープ装置を効率よく操作することができます。
<P>通常のネットワーク構成では、デフォルトのバッファー・サイズで、磁気テープのストリーム化を行うことができます。磁気テープ・コーディネーター・マシンおよびファイル・サーバー・マシン間のネットワークが遅い場合には、バッファー・サイズを増加してください。
<P>バッファー・サイズを変更した方が構成のために役立つかどうか判別するには、操作中の磁気テープ装置を調べてそれがストリーミングであるか調べるか、または製造者に相談してください。バッファー・サイズを設定するには、入出力装置構成ファイルで <B>BUFFERSIZE</B> 命令を記述します。これは、引き数として次の形式の整数値を必要とします。
<PRE>      <B>BUFFERSIZE</B> <VAR>size</VAR>[{<B>k</B> | <B>K</B> | <B>m</B> | <B>M</B> | <B>g</B> | <B>G</B>}]
</PRE>
<P><VAR>size</VAR> には、ダンプおよび復元操作時にバッファーとして磁気テープ・コーディネーターが使用するメモリーの量を指定します。デフォルトはバイト単位ですが、K バイト単位で指定する場合には
<B>k</B> または <B> K</B> を、M バイト単位で指定する場合には <B>m</B> または
<B> M</B> を、G バイト単位で指定する場合には、
<B>g</B> または <B>G</B> を使用してください。
<VAR>size</VAR> に指定する値と単位の間にスペースは不要です。
<P><H3><A NAME="HDRWQ382" HREF="auagd002.htm#ToC_318">データのバックアップ・データ・ファイルへのダンプ</A></H3>
<P>ダンプを、磁気テープではなく、
<I>バックアップ・データ・ファイル</I> に書き出すことができます。たとえば、データを階層記憶管理 (HSM) システムなどのデータ保存システムに転送したい場合に便利です。このシステムは AFS およびバックアップ・システムと一緒に使用します。データをバックアップ・データ・ファイルからファイル・システムにも同様に復元することができます。バックアップ・データ・ファイルの使用は、同等の <B>vos dump</B> および <B>vos
restore</B> コマンドを複数のボリュームに対して個々に出すよりも効率的です。
<P>磁気テープ・コーディネーター・マシンのローカル・ディスク上にあれば、バックアップ・データ・ファイルへの書き込みが最も単純ですが、リモート・マシンに常駐する NFS がマウントされた区画へファイルを書き込むこともできます。親ディレクトリーのアクセス制御リスト (ACL) で必要なアクセス権を付与されていれば、
AFS にファイルを書き込むこともできますが、これは AFS データを AFS 自身にバックアップすることになります。
<P>磁気テープ・コーディネーターは、ダンプを書き込むバックアップ・ファイルが存在しないと、バックアップ・ファイルを作成します。復元操作を完了するには、このファイルが存在して、<B>backup dump</B>
操作の間にボリューム・データが書き込まれている必要があります。
<P>バックアップ・データ・ファイルの書き込み時に、磁気テープ・コーディネーターは、
16 KB オフセットでデータを書き込みます。特定のデータ・ブロック (ボリュームの開始または終了を通知するマーカーなど) が 16 KB に満たない場合、磁気テープ・コーディネーターは、次のオフセットまでスキップし、次のブロックの書き込みを開始します。
<B>-id</B> オプションを付けて <B>backup
dumpinfo</B> コマンドを発行すると、出力の <TT>Pos</TT> 列にボリューム・データが始まる
16-KB オフセットの位置が表示されます。磁気テープへのダンプの場合のように、この値は、前の行の位置番号に 1 を加えた値にはなりません。
<P>バックアップ・データ・ファイルに書き込む前に、そのファイルを磁気テープ装置であるかのように構成する必要があります。
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">装置の構成ファイルに <B>FILE YES</B> 命令があれば、
<B> /usr/afs/backup/tapeconfig</B> ファイルの 3 番目のフィールドには磁気テープ装置名ではなく、ファイルのパス名が表示されていなくてはなりません
(なければ必要はありません)。この <B>tapeconfig</B> ファイルに磁気テープ装置が指定されていると、ダンプ操作は成功したようにみえますが、操作不能になります。
<B>FILE</B> 命令が <B>YES</B> に設定されている間、磁気テープに装置に間違ってダンプされたデータは復元することができません。同様に、<B>FILE</B> 命令が <B>NO</B> に設定されている場合には、
<B>tapeconfig</B> 項目に実際の磁気テープ装置が指定されていなければなりません。
</TD></TR></TABLE>
<P><H3><A NAME="Header_319" HREF="auagd002.htm#ToC_319">バックアップ・データ・ファイルの構成</A></H3>
<OL TYPE=1>
<LI><B>/usr/afs/etc/UserList</B> ファイルにリストされているユーザーとして認証されていることを検証します。必要な場合には、<B>bos listusers</B> コマンドを発行します。このコマンドについては、<A HREF="auagd021.htm#HDRWQ816">UserList ファイルのユーザーの表示</A>で詳しく説明しています。
<P>
<PRE>   % <B>bos listusers</B> &lt;<VAR>machine name</VAR>>
</PRE>
</LI><LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>オプション</B>。
<B>backup</B> コマンドを発行して、対話モードに入ります。
<P>
<PRE>   # <B>backup</B>
</PRE>
</LI><LI>ファイルに割り当てるポート・オフセット番号を選択します。必要であれば、<B>(backup) listhosts</B> コマンドを発行して、すでに割り当てられているポート・オフセットを表示してください。詳細については、<A HREF="#HDRWQ364">構成済みの磁気テープ・コーディネーターのリストを表示するには</A> を参照してください。
<P>
<PRE>   backup> <B>listhosts</B>
</PRE>
<P>
<P>テープ装置に対して、指定できる値は、整数の <B>0</B> (ゼロ) から
<B>58510</B> (バックアップ・システムは、最大 58,511 ポート・オフセット番号を記録できます)。ポート・オフセットは、セル内で固有でなければなりませんが、
1 つの磁気テープ・コーディネーターに複数のポートを割り当てることができます。ポート・オフセット番号は、順番に割り当てる必要はありません。
</LI><LI><B>(backup) addhost</B> コマンドを発行して、バックアップ・データベースにバックアップ・データ・ファイルのポート・オフセットを登録します。
<P>
<PRE>   backup> <B>addhost</B> &lt;<VAR>tape machine name</VAR>> [&lt;<VAR>TC port offset</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>addh
</B><DD><B>addhost</B> の受け入れ可能な最も短い省略形です。
<P><DT><B><VAR>tape machine name</VAR>
</B><DD>バックアップ・データ・ファイルに書き込むために呼び出す磁気テープ・コーディネーターの完全修飾ホスト名を指定します。
<P><DT><B><VAR>TC port offset</VAR>
</B><DD>ファイルのポート・オフセット番号を指定します。デフォルト値の <B>0</B> (ゼロ) が適切でない場合には、この引き数を指定しなければなりません。
</DL>
</LI><LI><A NAME="LITAPECONFIG-FILE"></A>テキスト・エディターを使用して、バックアップ・データ・ファイルの項目をローカルの
<B>/usr/afs/backup/tapeconfig</B> ファイルに作成します。標準の構文は、次のとおりです。
<P>
<PRE>   [<VAR>capacity</VAR>  <VAR>filemark_size</VAR>]  <VAR>device_name</VAR>   <VAR>port_offset</VAR>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><VAR>capacity</VAR>
</B><DD>バックアップ・データ・ファイルのある区画で、ファイルに使用したいスペースの容量を指定します。使用可能なスペースがなくならないようにするには、ダンプ操作時に実際に使用可能なスペースより少ない値を指定してください。オペレーティング・システムが許可している最大ファイル・サイズよりも大きい値を指定してはなりません。
<P>
<P>数値の後に単位を示す文字を指定しください。数値と文字の間にはスペースを入れないでください。<B>k</B> または
<B>K</B> は、キロバイトを、<B>m</B> または <B>M</B> は、メガバイトを、および
<B>g</B> または <B>G</B> は、ギガバイトを示します。単位の文字を省略すると、デフォルトで K バイトが使用されます。このフィールドを空にしておくと、テープ・コーディネーターは、最大許容値 (2048 GB または 2 TB) を使用します。また、この場合 <VAR>filemark_size</VAR> フィールドも空にしておきます。
<P><DT><B><VAR>filemark_size</VAR>
</B><DD>値 <B>0</B> (ゼロ) を指定するか、このフィールドと <VAR>capacity</VAR> フィールドを両方とも空にしておきます。後者の場合、テープ・コーディネーターは値ゼロを使用します。
<P><DT><B><VAR>device_name</VAR>
</B><DD>バックアップ・データ・ファイルの完全なパス名を指定します。実際のファイルのパス名を指定しない場合には、
<B>/dev</B> ディレクトリーに実際のファイルのパス名を指す記号リンクを作成し、その記号リンクをこのフィールドに指定してください。この構成には、以下の利点があります。
<UL>
<LI><B>CFG_</B><VAR>device_name</VAR>、<B>TE_</B><VAR>device_name</VAR>、および <B>TL_</B><VAR>device_name</VAR> ファイル名の <VAR>device_name</VAR> 部分をできるだけ短くすることができます。テープ装置として記号リンクが <B>/dev</B> ディレクトリーにあるので、ファイル名から最初のスラッシュ (<B>/</B>) だけでなく、
<B>/dev/</B> 接頭部全体を削除することができます。たとえば、記号リンクが <B>/dev/FILE</B>の場合、装置構成ファイルの名前は <B>CFG_FILE</B> になります。
<B>tapeconfig</B> ファイルに実際のパス名
<B>var/tmp/FILE</B> はある場合には、ファイルの名前は、
<B>CFG_var_tmp_FILE</B> になります。
</LI><LI>このようにすると、磁気テープ・コーディネーターがバックアップ・データ・ファイルに完全なダンプを書き込めない場合
(バックアップ・データ・ファイルのある区画がいっぱいになった場合) でも、効果的な回復 (自動的な) 回復を行うことができます。この問題が起きると、磁気テープ・コーディネーターは <B>MOUNT</B> スクリプトを起動するか、構成ファイルに
<B>MOUNT</B> 命令がない場合には、プロンプトを出します。
<UL>
<LI><B>MOUNT</B> スクリプトがある場合、スペースが利用可能な区画にある別のバックアップ・データ・ファイルを指すように記号リンクを変更するサブルーチンをスクリプトに追加すると、この状況に対応することができます。
</LI><LI><B>MOUNT</B> 命令がない場合には、プロンプトによって、別のバックアップ・データ・ファイルを指すように記号リンクを手操作で変更することができます。変更後、&lt;<B>Return</B>>
を押すと、磁気テープ・コーディネーターは操作を継続します。
</LI></UL>
<P>
<P>
<P>このフィールドに実際のファイル名が指定されている場合、区画にスペースがなくなると、回復することができません。操作の途中で、
<B>tapeconfig</B> ファイルを変更することはできません。
</LI></UL>
<P><DT><B><VAR>port_offset</VAR>
</B><DD>選択されたバックアップ・データ・ファイルのポート・オフセット番号を指定します。
</DL>
</LI><LI>テープ・コーディネーター・マシンの <B>/usr/afs/backup</B> ディレクトリーに、入出力装置構成ファイル <B>CFG_</B><VAR>device_name</VAR> を作成します。そのファイルに <B>FILE YES</B> 命令を記述します。
<P>
<P><A HREF="#LITAPECONFIG-FILE">6</A> のステップの <B>tapeconfig</B> ファイルに記録した装置名に基づいて、名前の <VAR>device_name</VAR> 部分を構成します。お勧めしたとおり、記号リンク名を記録した場合には、
<B>/dev/</B> ストリングを削除して、名前の中のスラッシュ (<B>/</B>) を下線 (<B>_</B>) に置換してください。たとえば、記号リンクが<B>/dev/FILE</B> である場合の名前は
<B>CFG_FILE</B> です。実際のファイル名を記録した場合には、最初のスラッシュのみを削除し、他のスラッシュは下線に置換してください。
<B>/var/tmp/FILE</B> というバックアップ・データ・ファイルの場合、入出力装置構成ファイル名は
<B>CFG_var_tmp_FILE</B> になります。
</LI><LI><A HREF="#LITAPECONFIG-FILE">6</A> のステップで、<B>tapeconfig</B> 項目の <VAR>device_name</VAR> フィールドに記号リンク名を記録することを選択した場合、次のいずれかを行わなければなりません。
<UL>
<LI><B>ln -s</B> コマンドを使用して、適切な記号リンクを <B>/dev</B> ディレクトリーに作成する。
</LI><LI>この方法でバックアップ・データ・ファイルを初期化するスクリプトを作成し、
<B>MOUNT</B> 命令を入出力装置構成ファイルに記述してスクリプトを呼び出す。これらの命令の後にスクリプトの例が表示されます。
</LI></UL>
</LI></OL>
<P>ダンプ操作が始まる時にファイルが存在していない場合には、磁気テープ・コーディネーターがバックアップ・データ・ファイルを作成するので、ユーザーが作成する必要はありません。
<P>以下のスクリプトの例は、ファイルへの書き込みの準備段階でバックアップ・データ・ファイルへの記号リンクを自動的に作成する方法を示しています。テープ・コーディネーターが <B>backup
dump</B>、<B>backup restore</B>、<B>backup savedb</B>、または <B>backup restoredb</B> 操作を実行している場合、ルーチンにより UNIX <B>ln -s</B> コマンドが呼び出され、
<B>tapeconfig</B> ファイルに名前のあるバックアップ・データ・ファイルから、実際に使用するファイルへの記号リンクが作成されます (これが推奨される方法です)。ファイル名の構成には、バックアップ・システムから渡される <TT>tapename</TT> および <TT>tapeid</TT> パラメーターの値が使用されます。
<P>ルーチンは、他の 2 つのパラメーター (<TT>tries</TT>
および <TT>operation</TT>) も同様に使用します。<TT>tries</TT> パラメーターは、テープ・コーディネーターによるファイル・アクセスの試行回数をトラックします。
1 より大きい値は、テープ・コーディネーターがこれにアクセスできず、ルーチンが終了コード 2 (<TT>exit_interactive</TT>) を戻し操作員にテープのロードを要求したことを示しています。操作員はこの機会を利用して、
<B>tapeconfig</B> ファイルに指定されているバックアップ・データ・ファイルの名前を変更することができます。
<PRE>   #! /bin/csh -f
   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5
   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2
   #--------------------------------------------
   if (${tries} > 1) then
      echo "Too many tries"
      exit ${exit_interactive}
   endif
   if (${operation} == "labeltape") then
      echo "Won't label a tape/file"
      exit ${exit_abort}
   endif
   if ((${operation} == "dump")   |\
       (${operation} == "appenddump")   |\
       (${operation} == "restore")   |\
       (${operation} == "savedb")    |\
       (${operation} == "restoredb")) then
      /bin/rm -f ${devicefile}
      /bin/ln -s /hsm/${tapename}_${tapeid} ${devicefile}
      if (${status} != 0) exit ${exit_abort}
   endif

   exit ${exit_continue}
</PRE>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd010.htm">前ページ</A> &#124; <A HREF="auagd012.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 -->
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
